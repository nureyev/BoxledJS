var astar={init:function(c){for(var b=0,a=c.length;b<a;b++)for(var g=0,e=c[b].length;g<e;g++){var d=c[b][g];d.f=0;d.g=0;d.h=0;d.cost=d.type;d.visited=!1;d.closed=!1;d.parent=null}},heap:function(){return new BinaryHeap(function(c){return c.f})},search:function(c,b,a,g,e){astar.init(c);e=e||astar.manhattan;g=!!g;var d=astar.heap();for(d.push(b);0<d.size();){b=d.pop();if(b===a){c=b;for(a=[];c.parent;)a.push(c),c=c.parent;return a.reverse()}b.closed=!0;for(var j=astar.neighbors(c,b,g),n=0,f=j.length;n<
f;n++){var h=j[n];if(!h.closed&&!h.isWall()){var k=b.g+h.cost,m=h.visited;if(!m||k<h.g)h.visited=!0,h.parent=b,h.h=h.h||e(h.pos,a.pos),h.g=k,h.f=h.g+h.h,m?d.rescoreElement(h):d.push(h)}}}return[]},manhattan:function(c,b){var a=Math.abs(b.x-c.x),g=Math.abs(b.y-c.y);return a+g},neighbors:function(c,b,a){var g=[],e=b.x;b=b.y;c[e-1]&&c[e-1][b]&&g.push(c[e-1][b]);c[e+1]&&c[e+1][b]&&g.push(c[e+1][b]);c[e]&&c[e][b-1]&&g.push(c[e][b-1]);c[e]&&c[e][b+1]&&g.push(c[e][b+1]);a&&(c[e-1]&&c[e-1][b-1]&&g.push(c[e-
1][b-1]),c[e+1]&&c[e+1][b-1]&&g.push(c[e+1][b-1]),c[e-1]&&c[e-1][b+1]&&g.push(c[e-1][b+1]),c[e+1]&&c[e+1][b+1]&&g.push(c[e+1][b+1]));return g}};var GraphNodeType={OPEN:1,WALL:0};function Graph(c){for(var b=[],a=0;a<c.length;a++){b[a]=[];for(var g=0,e=c[a];g<e.length;g++)b[a][g]=new GraphNode(a,g,e[g])}this.input=c;this.nodes=b}Graph.prototype.toString=function(){for(var c="\n",b=this.nodes,a,g,e,d,j=0,n=b.length;j<n;j++){a="";g=b[j];e=0;for(d=g.length;e<d;e++)a+=g[e].type+" ";c=c+a+"\n"}return c};function GraphNode(c,b,a){this.data={};this.x=c;this.y=b;this.pos={x:c,y:b};this.type=a}
GraphNode.prototype.toString=function(){return"["+this.x+" "+this.y+"]"};GraphNode.prototype.isWall=function(){return this.type==GraphNodeType.WALL};function BinaryHeap(c){this.content=[];this.scoreFunction=c}
BinaryHeap.prototype={push:function(c){this.content.push(c);this.sinkDown(this.content.length-1)},pop:function(){var c=this.content[0],b=this.content.pop();0<this.content.length&&(this.content[0]=b,this.bubbleUp(0));return c},remove:function(c){var b=this.content.indexOf(c),a=this.content.pop();b!==this.content.length-1&&(this.content[b]=a,this.scoreFunction(a)<this.scoreFunction(c)?this.sinkDown(b):this.bubbleUp(b))},size:function(){return this.content.length},rescoreElement:function(c){this.sinkDown(this.content.indexOf(c))},
sinkDown:function(c){for(var b=this.content[c];0<c;){var a=(c+1>>1)-1,g=this.content[a];if(this.scoreFunction(b)<this.scoreFunction(g))this.content[a]=b,this.content[c]=g,c=a;else break}},bubbleUp:function(c){for(var b=this.content.length,a=this.content[c],g=this.scoreFunction(a);;){var e=c+1<<1,d=e-1,j=null;if(d<b){var n=this.scoreFunction(this.content[d]);n<g&&(j=d)}if(e<b&&this.scoreFunction(this.content[e])<(null===j?g:n))j=e;if(null!==j)this.content[c]=this.content[j],this.content[j]=a,c=j;else break}}};var boxledjs=boxledjs||{};
(function(c){Utils={getScreenWidth:function(){if("number"==typeof window.innerWidth)return window.innerWidth;if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight))return document.documentElement.clientWidth;if(document.body&&(document.body.clientWidth||document.body.clientHeight))return document.body.clientWidth},getScreenHeight:function(){if("number"==typeof window.innerWidth)return window.innerHeight;if(document.documentElement&&(document.documentElement.clientWidth||
document.documentElement.clientHeight))return document.documentElement.clientHeight;if(document.body&&(document.body.clientHeight||document.body.clientHeight))return document.body.clientHeight},getStage:function(b){return b.canvas?b:b.parent?b.parent.canvas?b.parent:c.getStage(b.parent):null},getDefinitionByName:function(b,a,g){a=a||window;g=g||b;b=b.split(".");var e=b.shift();if(a=a[e])return b.length?c.getDefinitionByName(b.join("."),a,g):a;throw Error("Could not find '"+e+"' of '"+g+"'");},applyConstruct:function(b,
a){function g(){function a(){}a.prototype=b.prototype;return new a}var e,d;"function"===typeof Object.create?e=Object.create(b.prototype):{}.__proto__?(e={},e.__proto__=b.prototype,e.__proto__!==b.prototype&&(e=g())):e=g();e.constructor=b;d=b.apply(e,a);"object"===typeof d&&(e=d);return e}};c.Utils=Utils})(boxledjs);boxledjs=boxledjs||{};
(function(c){function b(a,g){a=a.split(",");return{x:parseFloat(a[0])*g.width,y:parseFloat(a[1])*g.height}}Box2DUtils={RECT:"rect",CIRCLE:"circle",makeB2DBodyFromData:function(a,g){boxledjs.Const.scale=boxledjs.Const.scale||32;var e=a.properties,d=new Box2D.Dynamics.b2FixtureDef;d.density=void 0==e.density?1:parseFloat(e.density);d.friction=void 0==e.friction?0.5:parseFloat(e.friction);d.restitution=void 0==e.restitution?0.05:parseFloat(e.restitution);d.isSensor=!Box2DUtils.isTileCollideable(e);var j=
new Box2D.Dynamics.b2BodyDef;j.type=e.dynamic?Box2D.Dynamics.b2Body.b2_dynamicBody:Box2D.Dynamics.b2Body.b2_staticBody;var j=g.CreateBody(j),n=a.width/boxledjs.Const.scale/2,f=a.height/boxledjs.Const.scale/2;if(e.topLeft||e.topRight||e.bottomRight||e.bottomLeft)a.polygon=[],"none"!=e.topLeft&&a.polygon.push(b(e.topLeft||"0,0",a)),"none"!=e.topRight&&a.polygon.push(b(e.topRight||"1,0",a)),"none"!=e.bottomRight&&a.polygon.push(b(e.bottomRight||"1,1",a)),"none"!=e.bottomLeft&&a.polygon.push(b(e.bottomLeft||
"0,1",a));if(!0==a.ellipse)d.shape=new Box2D.Collision.Shapes.b2CircleShape(n),j.CreateFixture(d),a.x+=a.width/2,a.y+=a.height/2;else if(a.polygon&&1<a.polygon.length)Box2D.Ext.b2Separator.Separate(j,d,a.polygon,boxledjs.Const.scale);else if(a.polyline&&1<a.polyline.length)for(var c,n=0,f=a.polyline.length;n<f-1;n++)d.shape=new Box2D.Collision.Shapes.b2PolygonShape,c=a.polyline[n],e=new Box2D.Common.Math.b2Vec2(c.x/boxledjs.Const.scale,c.y/boxledjs.Const.scale),c=a.polyline[n+1],c=new Box2D.Common.Math.b2Vec2(c.x/
boxledjs.Const.scale,c.y/boxledjs.Const.scale),d.shape.SetAsEdge(e,c),j.CreateFixture(d);else d.shape=new Box2D.Collision.Shapes.b2PolygonShape,d.shape.SetAsBox(n,f),j.CreateFixture(d),a.x+=a.width/2,a.y+=a.height/2;j.SetPositionAndAngle(new Box2D.Common.Math.b2Vec2(a.x/boxledjs.Const.scale,a.y/boxledjs.Const.scale),(a.rotation||0)*Math.PI/180);j.SetUserData(a);return j},isTileCollideable:function(a,g){return 0!=g&&(!a||!(a.isSensor&&"false"!=a.isSensor||a.noCollision&&"false"!=a.noCollision||a.force||
a.forceX||a.forceY||void 0!=a.gravityFactor))},injectBox2d:function(a,g,e,d,j,b,f,c,k,m){void 0==c&&(c=!0);void 0==k&&(k=!1);m=m||"borders";var l=boxledjs.Const.scale=boxledjs.Const.scale||32;a.bxd={};e*=0.5;d*=0.5;var p=new Box2D.Dynamics.b2FixtureDef;p.density=void 0==j?1:j;p.friction=void 0==b?0.5:b;p.restitution=void 0==f?0.05:f;p.isSensor=k;if(g==Box2DUtils.RECT){if(p.shape=new Box2D.Collision.Shapes.b2PolygonShape,p.shape.SetAsBox(e/l,d/l),!k){sensorsDef={};if("borders"==m||"both"==m)sensorsDef.bottom=
Box2DUtils.makeSensorDef((e+2)/l,2/l,0,d/l),sensorsDef.top=Box2DUtils.makeSensorDef((e+2)/l,2/l,0,-d/l),sensorsDef.right=Box2DUtils.makeSensorDef(2/l,(d-1)/l,e/l,0),sensorsDef.left=Box2DUtils.makeSensorDef(2/l,(d-1)/l,-e/l,0);if("corners"==m||"both"==m)sensorsDef.tr=Box2DUtils.makeSensorDef(2/l,2/l,(e+2)/l,-d/l),sensorsDef.br=Box2DUtils.makeSensorDef(2/l,2/l,(e+2)/l,(d+4)/l),sensorsDef.bl=Box2DUtils.makeSensorDef(2/l,2/l,-(e+2)/l,(d+4)/l),sensorsDef.tl=Box2DUtils.makeSensorDef(2/l,2/l,-(e+2)/l,-d/
l)}}else if(g==Box2DUtils.CIRCLE)p.shape=new Box2D.Collision.Shapes.b2CircleShape(2*e/l);else throw Error("Cannot resolve shape-type: "+g);a.bxd.fixDef=p;k||(a.bxd.sensors={bottom:0,top:0,right:0,left:0,tr:0,br:0,bl:0,tl:0},a.bxd.sensorsDef=sensorsDef);g=new Box2D.Dynamics.b2BodyDef;g.type=!c?Box2D.Dynamics.b2Body.b2_staticBody:Box2D.Dynamics.b2Body.b2_dynamicBody;a.bxd.bodyDef=g;a.onTick&&(a.__onTick=a.onTick);a.onTick=function(a){this.__onTick&&this.__onTick(a);this.bxd.body&&(a=this.bxd.body.GetPosition(),
this.x=a.x*l,this.y=a.y*l,this.rotation=180*(this.bxd.body.GetAngle()/Math.PI))}},makeSensorDef:function(a,g,e,d){var j=new Box2D.Dynamics.b2FixtureDef;j.isSensor=!0;var b=new Box2D.Collision.Shapes.b2PolygonShape;b.SetAsOrientedBox(a,g,new Box2D.Common.Math.b2Vec2(e,d),0);j.shape=b;return j}};c.Box2DUtils=Box2DUtils})(boxledjs);
Object.equals=function(c,b){if(c===b)return!0;if(!(c instanceof Object)||!(b instanceof Object)||c.constructor!==b.constructor)return!1;for(var a in c)if(c.hasOwnProperty(a)&&(!b.hasOwnProperty(a)||c[a]!==b[a]&&("object"!==typeof c[a]||!Object.equals(c[a],b[a]))))return!1;for(a in b)if(b.hasOwnProperty(a)&&!c.hasOwnProperty(a))return!1;return!0};var Box2D=Box2D||{};Box2D.Ext=Box2D.Ext||{};
(function(c){function b(a,d,g,b,f,c){var k;if(k=(g+0.1>=a&&a>=f-0.1||g-0.1<=a&&a<=f+0.1)&&(b+0.1>=d&&d>=c-0.1||b-0.1<=d&&d<=c+0.1))0.1<f-g||0.1<g-f?(a=(c-b)/(f-g)*(a-g)+b,k=0.1>(a>d?a-d:d-a)):k=0.1>a-g||0.1>g-a;return k}function a(a,d,g,b){return 0.1>(g>=a?g-a:a-g)&&0.1>(b>=d?b-d:d-b)}function g(){throw Error("A problem has occurred. Use the Validate() method to see where the problem is.");}c.b2Separator={Separate:function(e,d,j,c){c=c||32;var f,h=j.length,k,m,l=[];for(f=0;f<h;f++)l.push(new Box2D.Common.Math.b2Vec2(j[f].x/
c,j[f].y/c));var p,s,q,t,z,x,B,y,u,r,v,w,A,E;c=[];j=[];for(j.push(l);j.length;){f=j[0];h=f.length;E=!0;for(p=0;p<h;p++)if(l=p,B=p<h-1?p+1:p+1-h,q=p<h-2?p+2:p+2-h,y=f[l],u=f[B],q=f[q],q=y.x*u.y+u.x*q.y+q.x*y.y-y.y*u.x-u.y*q.x-q.y*y.x,0>q){E=!1;x=Number.MAX_VALUE;for(s=0;s<h;s++)if(s!=l&&s!=B){p=s;q=s<h-1?s+1:0;r=f[p];v=f[q];t=y.x;z=y.y;var G=u.x,H=u.y;w=r.x;r=r.y;var I=v.x;v=v.y;var C=G-t,D=H-z,J=I-w,K=v-r,F=void 0,F=(J*(r-z)-K*(w-t))/(D*J-C*K),C=t+F*C,D=z+F*D;t=b(G,H,t,z,C,D);w=b(C,D,w,r,I,v);if(w=
t&&w?new Box2D.Common.Math.b2Vec2(C,D):null)t=u.x-w.x,z=u.y-w.y,t=t*t+z*z,t<x&&(m=p,k=q,A=w,x=t)}x==Number.MAX_VALUE&&g();s=[];x=[];p=m;q=k;r=f[p];v=f[q];a(A.x,A.y,v.x,v.y)||s.push(A);a(A.x,A.y,r.x,r.y)||x.push(A);m=-1;for(k=l;;){if(k!=q)s.push(f[k]);else{(0>m||m>=h)&&g();b(v.x,v.y,f[m].x,f[m].y,y.x,y.y)||s.push(f[k]);break}m=k;0>k-1?k=h-1:k--}s=s.reverse();m=-1;for(k=B;;){if(k!=p)x.push(f[k]);else{(0>m||m>=h)&&g();k==p&&!b(r.x,r.y,f[m].x,f[m].y,u.x,u.y)&&x.push(f[k]);break}m=k;k+1>h-1?k=0:k++}j.push(s,
x);j.shift();break}E&&c.push(j.shift())}h=c.length;for(f=0;f<h;f++){j=[];l=c[f];m=l.length;for(k=0;k<m;k++)j.push(new Box2D.Common.Math.b2Vec2(l[k].x,l[k].y));k=new Box2D.Collision.Shapes.b2PolygonShape;k.SetAsArray(j);d.shape=k;e.CreateFixture(d)}},Validate:function(a){var d,g=a.length,c,f,h,k,m,l=0,p,s=!1;for(d=0;d<g;d++){h=d<g-1?d+1:0;k=0<d?d-1:g-1;p=!1;for(c=0;c<g;c++)if(c!=d&&c!=h&&(p||(m=a[d].x*a[h].y+a[h].x*a[c].y+a[c].x*a[d].y-a[d].y*a[h].x-a[h].y*a[c].x-a[c].y*a[d].x,0<m&&(p=!0)),c!=k)){f=
c<g-1?c+1:0;var q=a[d].x,t=a[d].y,z=a[h].x,x=a[h].y;m=a[c].x;var B=a[c].y,y=a[f].x;f=a[f].y;var u=z-q,r=x-t,v=y-m,w=f-B,A=void 0,A=(v*(B-t)-w*(m-q))/(r*v-u*w),u=q+A*u,r=t+A*r,q=b(u,r,q,t,z,x);m=b(u,r,m,B,y,f);m=q&&m?new Box2D.Common.Math.b2Vec2(u,r):null;m&&(l=1)}p||(s=!0)}s&&(l=1==l?3:2);return l}}})(Box2D.Ext);boxledjs=boxledjs||{};
(function(c){function b(){}b.prototype=new Box2D.Dynamics.b2ContactListener;var a=b.prototype;a.BeginContact=function(a){var e=a.GetFixtureA(),d=a.GetFixtureB();this.__BeginContactOrdered(e,d,a);this.__BeginContactOrdered(d,e,a)};a.__BeginContactOrdered=function(a,e,d){var b=a.GetBody().GetUserData(),c=e.GetBody().GetUserData();b&&b.objectData&&(b=objectData);c&&c.objectData&&(c=objectData);this.__applyForceField(a,e,b,c,1,1,d);this.__applyImpulse(a,e,b,c,d);this.__handleCustomEvents(a,e,b,c,d,"beginContact")};
a.EndContact=function(a){var e=a.GetFixtureA();a=a.GetFixtureB();this.__EndContactOrdered(e,a);this.__EndContactOrdered(a,e)};a.__EndContactOrdered=function(a,e,d){var b=a.GetBody().GetUserData(),c=e.GetBody().GetUserData();b&&b.objectData&&(b=objectData);c&&c.objectData&&(c=objectData);this.__applyForceField(a,e,b,c,-1,0,d);this.__handleCustomEvents(a,e,b,c,d,"endContact")};a.__applyForceField=function(a,e,d,b,c,f){if(d&&d.properties&&(d.properties.forceX||d.properties.forceY))if((d.properties.forceX||
d.properties.forceY)&&!e.IsSensor()){b=parseFloat(d.properties.forceX)||0;var h=parseFloat(d.properties.forceY)||0,k=e.GetBody();k.o_fieldForceX=k.o_fieldForceX+b*c||b*(f||0);k.o_fieldForceY=k.o_fieldForceY+h*c||h*(f||0)}if(d&&d.properties&&(d.properties.force||void 0!=d.properties.gravityFactor)&&!e.IsSensor())k=e.GetBody(),k.o_dynamicForceFields=k.o_dynamicForceFields||[],1==c?k.o_dynamicForceFields.push(a.GetBody()):k.o_dynamicForceFields.splice(k.o_dynamicForceFields.indexOf(a.GetBody()),1)};
a.__applyImpulse=function(a,e,d,b,c){if(d&&d.properties&&(d.properties.impulseX||d.properties.impulseY||d.properties.impulse)){if((d.properties.impulseX||d.properties.impulseY)&&!e.IsSensor()){b=parseFloat(d.properties.impulseX)||0;var f=parseFloat(d.properties.impulseY)||0,h=e.GetBody();h.ApplyImpulse(new Box2D.Common.Math.b2Vec2(b||0,f||0),h.GetWorldCenter())}d.properties.impulse&&!e.IsSensor()&&(d=parseFloat(d.properties.impulse)||0,a=a.GetBody(),e=e.GetBody(),b=new Box2D.Common.Math.b2Vec2(e.GetWorldCenter().x,
e.GetWorldCenter().y),b.Subtract(a.GetWorldCenter()),b.Normalize(),b.Multiply(d),e.ApplyImpulse(b,e.GetWorldPoint(c.GetManifold().m_localPoint)))}};a.__handleCustomEvents=function(a,e,d,b,c,f){d&&(d.properties&&d.properties.event)&&(a={type:d.properties.event,detail:{status:f,targetFixture:a,triggeringFixture:e}},d.eventsToDispatch=d.eventsToDispatch||[],d.eventsToDispatch.push(a))};a.PreSolve=function(){};c.BoxledJSContactListener=b})(boxledjs);boxledjs=boxledjs||{};
(function(c){function b(){}b.prototype=new boxledjs.BoxledJSContactListener;var a=b.prototype;a.super_BeginContact=a.BeginContact;a.BeginContact=function(a){this.super_BeginContact(a);this.__HandleContact(a,1)};a.super_EndContact=a.EndContact;a.EndContact=function(a){this.super_EndContact(a);this.__HandleContact(a,-1)};a.__HandleContact=function(a,e){var d=a.GetFixtureA(),b=a.GetFixtureB(),c=d.IsSensor()?d:b.IsSensor()?b:null;if(c){var d=d!=c?d:b,f;if((b=f=d.GetBody().GetUserData())&&b.objectData)b=
b.objectData;var h=c.GetUserData();h&&h.object&&(h=h.object);f&&f.object&&(f=f.object);if(c.GetUserData()&&c.GetUserData().sensorPosition){var k=d.GetBody().GetUserData();if(k&&k.onContact)k.onContact(l);var m=c.GetUserData().sensorPosition;if(!(b&&b.properties&&b.properties.noBottomCollision&&("left"==m||"right"==m)||d.IsSensor()||h.ignoreCollisionsWith&&0<=h.ignoreCollisionsWith.indexOf(f.type)||f.ignoreCollisionsWith&&0<=f.ignoreCollisionsWith.indexOf(h.type))){var l=c.GetBody().GetUserData();
l&&l.bxd&&l.bxd.sensors&&!1!==l.visible&&!1!==k.visible&&(l.bxd.sensors[m]+=e)}}}};a.super_PreSolve=a.PreSolve;a.PreSolve=function(a,e){this.super_PreSolve(a,e);var d=a.GetFixtureA(),b=a.GetFixtureB(),c,f,h;c=d.GetBody().GetUserData();f=b.GetBody().GetUserData();c&&c.objectData&&(c=objectData);f&&f.objectData&&(f=objectData);if(!1===c.visible||!1===f.visible||c.ignoreCollisionsWith&&0<=c.ignoreCollisionsWith.indexOf(f.type)||f.ignoreCollisionsWith&&0<=f.ignoreCollisionsWith.indexOf(c.type))a.SetEnabled(!1);
else if(c&&c.properties&&c.properties.noBottomCollision||f&&f.properties&&f.properties.noBottomCollision)d.GetBody().GetDefinition().type==Box2D.Dynamics.b2Body.b2_staticBody?(f=b.GetBody().m_linearVelocity.y,h=b.GetBody().m_invMass,c=b.GetAABB(),d=d.GetAABB()):(f=d.GetBody().m_linearVelocity.y,h=d.GetBody().m_invMass,c=d.GetAABB(),d=b.GetAABB()),b=Math.abs(d.lowerBound.y-d.upperBound.y),f=f*h/Box2D.Dynamics.b2World.s_timestep2.velocityIterations,(c.upperBound.y-f>d.upperBound.y&&c.upperBound.y>d.upperBound.y||
c.upperBound.y-f>d.lowerBound.y+b/25&&c.upperBound.y>d.lowerBound.y+b/25)&&a.SetEnabled(!1)};c.PlatformerContactListener=b})(boxledjs);boxledjs=boxledjs||{};
(function(c){function b(a,b){this.initialize(a,b)}b.prototype=new createjs.Container;b.prototype.Container_init=b.prototype.initialize;b.prototype.initialize=function(a,b){this.Container_init();this.data=a;this.properties=a.properties;this.objects={};this.map=b;this.reset()};b.prototype.reset=function(){this.initObjects()};b.prototype.onTick=function(){!1!==this.zSorting&&this.sortChildren(this.compareChildY)};b.prototype.compareChildY=function(a,b){return a.y<b.y?-1:a.y>b.y?1:0};b.prototype.initObjects=
function(){var a,c,e,d;a=0;for(c=this.data.objects.length;a<c;a++){e=this.data.objects[a];if(e.type&&""!=e.type)d=b.makeObjectFromData(e);else if(this.map.b2dWorld)d=boxledjs.Box2DUtils.makeB2DBodyFromData(e,this.map.b2dWorld);else{d="Couldn't create b2Body from objectData, because map.b2dWorld is "+this.map.b2dWorld;console.warn&&console.warn(d,e);continue}this.initObject(d,e)}};b.prototype.initObject=function(a,b){try{a.isVisible&&this.addChild(a)}catch(e){}try{if(a.bxd){var d=this.map.b2dWorld.CreateBody(a.bxd.bodyDef);
d.CreateFixture(a.bxd.fixDef);a.bxd.sensorsDef&&(a.bxd.sensorsDef.bottom&&d.CreateFixture(a.bxd.sensorsDef.bottom).SetUserData({object:a,sensorPosition:"bottom"}),a.bxd.sensorsDef.top&&d.CreateFixture(a.bxd.sensorsDef.top).SetUserData({object:a,sensorPosition:"top"}),a.bxd.sensorsDef.right&&d.CreateFixture(a.bxd.sensorsDef.right).SetUserData({object:a,sensorPosition:"right"}),a.bxd.sensorsDef.left&&d.CreateFixture(a.bxd.sensorsDef.left).SetUserData({object:a,sensorPosition:"left"}),a.bxd.sensorsDef.tr&&
d.CreateFixture(a.bxd.sensorsDef.tr).SetUserData({object:a,sensorPosition:"tr"}),a.bxd.sensorsDef.br&&d.CreateFixture(a.bxd.sensorsDef.br).SetUserData({object:a,sensorPosition:"br"}),a.bxd.sensorsDef.bl&&d.CreateFixture(a.bxd.sensorsDef.bl).SetUserData({object:a,sensorPosition:"bl"}),a.bxd.sensorsDef.tl&&d.CreateFixture(a.bxd.sensorsDef.tl).SetUserData({object:a,sensorPosition:"tl"}));d.SetPositionAndAngle(new Box2D.Common.Math.b2Vec2(a.x/boxledjs.Const.scale,a.y/boxledjs.Const.scale),a.rotation*
Math.PI/180);a.bxd.sensorsDef=void 0;a.bxd.body=d;d.SetUserData(a);if(a.bxd.onBodyCreated)a.bxd.onBodyCreated(d)}}catch(c){}a.layer=this;b&&(b.name&&""!=b.name)&&(this.objects[b.name]=a,this.map.objects[b.name]=a)};b.makeObjectFromData=function(a){var b,e,d,c=a.properties;b=boxledjs.Utils.getDefinitionByName(a.type||c.type||c.classDefinition);c.parameter&&""!=c.parameter&&(e=JSON.parse(c.parameter),"object"==typeof e&&(d=boxledjs.Utils.applyConstruct(b,e)));d=d||new b;for(var n in c)"classDefinition"!=
n&&"parameter"!=n&&(d[n]=c[n]);d.x=a.x;d.y=a.y;if(void 0!=a.scaleX||void 0!=c.scaleX)d.scaleX=a.scaleX||c.scaleX;if(void 0!=a.scaleY||void 0!=c.scaleY)d.scaleY=a.scaleY||c.scaleY;d.rotation=a.rotation;return d};c.ObjectLayer=b})(boxledjs);boxledjs=boxledjs||{};
(function(c){function b(a,b){this.initialize(a,b)}b.prototype=new createjs.Container;b.prototype.Container_init=b.prototype.initialize;b.prototype.initialize=function(a,b){this.Container_init();this.data=a;this.properties=a.properties;this.map=b;this.reset()};b.prototype.reset=function(){this.x=this.data.x;this.y=this.data.y;this.visible=this.data.visible;this.alpha=void 0!=this.data.opacity?parseFloat(this.data.opacity):1;this.numTilesX=this.data.width;this.numTilesY=this.data.height;if(this.isCollisionLayer=
this.properties&&this.properties.collisionLayer&&"false"!=this.properties.collisionLayer)this.colTilesToCheck=[],this.colTileGroups=[];this.pathfinding={};this.drawTiles();"false"!==this.data.properties.cached&&this.cache(0,0,this.map.data.tilewidth*this.numTilesX,this.map.data.tileheight*this.numTilesY);this.isCollisionLayer&&this.map.b2dWorld&&this.calculateCollisionShapes()};b.prototype.drawTiles=function(){var a=this.data.data,b,e,d,c,n,f,h,k=[],m;this.tileObjects=[];for(b=0;b<this.numTilesY;b++){m=
[];for(e=0;e<this.numTilesX;e++)d=e*this.numTilesX+b,c=a[d],h=this.map.getTileProperties(c),0!=c&&(h.type&&""!=h.type?(n={},n.properties=h,n.x=b,n.y=e,f=boxledjs.ObjectLayer.makeObjectFromData(n)):(n=this.map.getTileById(c),f=new createjs.Bitmap(n.image),f.sourceRect=n.rect),f.x=b*this.map.data.tilewidth,f.y=e*this.map.data.tileheight,this.addChild(f),this.tileObjects[d]=f),this.isCollisionLayer?(this.colTilesToCheck[d]=c,d=!Box2DUtils.isTileCollideable(h,c)):d=!h||"false"!=h.passable,m.push(d?GraphNodeType.OPEN:
GraphNodeType.WALL);k.push(m)}this.pathfinding.graph=new Graph(k)};b.prototype.calculateCollisionShapes=function(){var a,b,c,d,j=this.map.data.tilewidth,n=this.map.data.tileheight;for(c=0;c<this.numTilesY;c++)for(b=0;b<this.numTilesX;b++)a=c*this.numTilesX+b,a=this.colTilesToCheck[a],void 0!=a&&0!=a&&(this.colTileGroups.push({tiles:[]}),this.findNextCollisionShapeTile(b,c));a=0;for(d=this.colTileGroups.length;a<d;a++){var f=this.colTileGroups[a],h=f.tiles;b=h[0].x;c=h[0].y;h=h[h.length-1].x-b+1;f=
this.map.getTileProperties(f.tileid)||{};boxledjs.Box2DUtils.makeB2DBodyFromData({x:b*j,y:c*n,width:h*j,height:1*n,properties:f},this.map.b2dWorld).SetUserData(this.tileObjects[c*this.numTilesX+b])}};b.prototype.findNextCollisionShapeTile=function(a,b){a=a||0;b=b||0;var c,d,j;c=b*this.numTilesX+a;d=this.colTilesToCheck[c];void 0!=d&&0!=d&&(j=this.colTileGroups[this.colTileGroups.length-1],j.tileid=j.tileid||d,Object.equals(this.map.getTileProperties(d),this.map.getTileProperties(j.tileid))&&(j.tiles.push({x:a,
y:b,tileid:d}),this.colTilesToCheck[c]=void 0,this.findNextCollisionShapeTile(a+1,b)))};c.TileLayer=b})(boxledjs);boxledjs=boxledjs||{};boxledjs.Const={};boxledjs.Const.scale=32;
(function(c){function b(a,b){this.initialize(a,b)}b.prototype=new createjs.Container;b.prototype.Container_init=b.prototype.initialize;b.prototype.initialize=function(a,b){this.Container_init();this.b2dWorld=b;this.data=a;this.reset()};b.prototype.reset=function(){this.viewPort={};this.layers={};this.objects={};if(!1!==this.b2dWorld&&void 0===this.b2dWorld){boxledjs.Const.scale=parseFloat(this.data.properties.box2dScale)||boxledjs.Const.scale;this.b2dWorld=new Box2D.Dynamics.b2World(new Box2D.Common.Math.b2Vec2(parseFloat(this.data.properties.forceX)||
0,parseFloat(this.data.properties.forceY)||20),!0);var a=new boxledjs.PlatformerContactListener;this.b2dWorld.SetContactListener(a)}this.firstTick=!1;this.generateTileSets();this.pathfinding={};this.setupLayers()};b.prototype.onTick=function(){!this._firstTick&&this._onFirstTick();this.centerObject&&this.centerTo(this.centerObject)};b.prototype._onFirstTick=function(){var a=boxledjs.Utils.getStage(this).canvas;void 0==this.viewPort.width&&(this.viewPort.width=a.width);void 0==this.viewPort.height&&
(this.viewPort.height=a.height);!this.b2dDebugDraw&&this.setupDebugDraw(a);this._firstTick=!0};b.prototype.update=function(a){if(!1!==this.b2dWorld&&void 0!==this.b2dWorld){for(var b=this.b2dWorld.GetBodyList();b;){var c=b.GetUserData(),d=c?c.properties:{};if(c&&c.eventsToDispatch)for(;c.eventsToDispatch.length;){var j=c.eventsToDispatch.pop();this.dispatchEvent(j)}if(!d||!0!=d.ignoreForces){if(b.o_fieldForceX||b.o_fieldForceY)b.ApplyForce(new Box2D.Common.Math.b2Vec2((b.o_fieldForceX||0)*b.GetMass(),
(b.o_fieldForceY||0)*b.GetMass()),b.GetWorldCenter());if(b.o_dynamicForceFields&&b.o_dynamicForceFields.length){for(var c=[],n,d=0,j=b.o_dynamicForceFields.length;d<j;d++){var f=b.o_dynamicForceFields[d],h=parseFloat(f.GetUserData().properties.force)||0,k=new Box2D.Common.Math.b2Vec2(b.GetWorldCenter().x,b.GetWorldCenter().y);k.Subtract(f.GetWorldCenter());k.Normalize();k.Multiply(h);k.Multiply(b.GetMass());!isNaN(k.x)&&!isNaN(k.y)&&b.ApplyForce(k,b.GetWorldCenter());void 0!=f.GetUserData().properties.gravityFactor&&
c.push(parseFloat(f.GetUserData().properties.gravityFactor))}d=0;for(j=c.length;d<j;d++)n=n+c[d]||c[d];isNaN(n)||(d=this.b2dWorld.GetGravity().GetNegative(),d.Multiply(1-n/c.length),d.Multiply(b.GetMass()),b.ApplyForce(d,b.GetWorldCenter()))}}b=b.GetNext()}this.b2dWorld.Step((a||30)/1E3,10,10);this.b2dWorld.ClearForces()}};b.prototype.setupDebugDraw=function(a){if(!this.b2dWorld)return null;this.b2dDebugDraw=new Box2D.Dynamics.b2DebugDraw;this.b2dDebugDraw.SetSprite(a.getContext("2d"));this.b2dDebugDraw.SetDrawScale(boxledjs.Const.scale);
this.b2dDebugDraw.SetFillAlpha(0.35);this.b2dDebugDraw.SetFlags(Box2D.Dynamics.b2DebugDraw.e_shapeBit|Box2D.Dynamics.b2DebugDraw.e_jointBit);this.b2dWorld.SetDebugDraw(this.b2dDebugDraw);return this.b2dDebugDraw};b.prototype.drawDebugData=function(a){this.b2dWorld&&(a=a||1,this.b2dDebugDraw.SetFillAlpha(0.35*a),this.b2dDebugDraw.SetAlpha(1*a),this.b2dDebugDraw.GetSprite().save(),this.b2dDebugDraw.GetSprite().scale(this.scaleX,this.scaleY),this.b2dDebugDraw.GetSprite().translate(-this.regX+this.x/
this.scaleX,-this.regY+this.y/this.scaleY),this.b2dWorld.DrawDebugData(),this.b2dDebugDraw.GetSprite().restore())};b.prototype.setupLayers=function(){var a,b,c,d,j=[];a=0;for(b=this.data.layers.length;a<b;a++){c=this.data.layers[a];if("tilelayer"==c.type){d=new boxledjs.TileLayer(c,this);this.addChild(d);for(var n=d.pathfinding.graph.input,f=0,h=n.length;f<h;f++){var k=n[f],m=j[f]||[];j[f]=m;for(var l=0,p=k.length;l<p;l++)m[l]=(m[l]||1)&k[l]}}else"objectgroup"==c.type&&(d=new boxledjs.ObjectLayer(c,
this),this.addChild(d));c.name&&""!=c.name&&(this.layers[c.name]=d)}this.pathfinding.graph=new Graph(j)};b.prototype.centerTo=function(a){"string"==typeof a&&(a=this.objects[a]);if(a&&void 0!=a){var b,c;a.GetPosition?(c=a.GetPosition(),b=c.x*boxledjs.Const.scale,c=c.y*boxledjs.Const.scale):void 0!=a.x&&void 0!=a.y&&(b=a.x,c=a.y);if(!(void 0==b||void 0==c)){a=this.viewPort.width||0;var d=this.viewPort.height||0;this.regX=b;this.regY=c;this.x=a/2;this.y=d/2}}};b.prototype.calculatePath=function(a,b,
c,d){var j=this.pathfinding.graph.nodes;a=j[a.x][a.y];b=j[b.x][b.y];if((a=astar.search(j,a,b,c))&&a.length&&!0===d){d=!1;for(var n,f=0;f<a.length-2;f++)for(d=!1;!d&&a[f+2];)b=a[f].x-a[f+1].x,c=a[f].y-a[f+1].y,j=a[f].x-a[f+2].x,n=a[f].y-a[f+2].y,0==j&&0==b||0==n&&0==c?a.splice(f+1,1):d=!0}return a};b.prototype.generateTileSets=function(){this.tilesets=[];this.tileproperties={};for(var a=0,c=this.data.tilesets.length;a<c;a++){var e=b.convertTileSetToSpriteSheet(this.data.tilesets[a]);this.tilesets.push(e);
for(var d in e.tileproperties)this.tileproperties[d]=e.tileproperties[d]}};b.prototype.getTileById=function(a){a-=1;return this.getSpriteSheetByTileId(a).getFrame(a)};b.prototype.getSpriteSheetByTileId=function(a){a=a||1;var b=this.tilesets,c,d,j,n;c=0;for(d=b.length;c<d;c++)j=b[c],j.firstgid<=a&&0<j.firstgid&&(n=j);return n};b.prototype.getTileProperties=function(a){return this.tileproperties[a-1]};b.convertTileSetToSpriteSheet=function(a){var b={};b.images=[a.image];b.frames={width:a.tilewidth,
height:a.tileheight};b=new createjs.SpriteSheet(b);b.firstgid=a.firstgid;b.tileproperties=a.tileproperties;return b};c.Map=b})(boxledjs);
