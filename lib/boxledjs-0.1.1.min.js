var astar={init:function(c){for(var b=0,a=c.length;b<a;b++)for(var d=0,f=c[b].length;d<f;d++){var e=c[b][d];e.f=0;e.g=0;e.h=0;e.cost=e.type;e.visited=!1;e.closed=!1;e.parent=null}},heap:function(){return new BinaryHeap(function(c){return c.f})},search:function(c,b,a,d,f){astar.init(c);f=f||astar.manhattan;d=!!d;var e=astar.heap();for(e.push(b);0<e.size();){b=e.pop();if(b===a){c=b;for(a=[];c.parent;)a.push(c),c=c.parent;return a.reverse()}b.closed=!0;for(var h=astar.neighbors(c,b,d),l=0,g=h.length;l<
g;l++){var j=h[l];if(!j.closed&&!j.isWall()){var k=b.g+j.cost,n=j.visited;if(!n||k<j.g)j.visited=!0,j.parent=b,j.h=j.h||f(j.pos,a.pos),j.g=k,j.f=j.g+j.h,n?e.rescoreElement(j):e.push(j)}}}return[]},manhattan:function(c,b){var a=Math.abs(b.x-c.x),d=Math.abs(b.y-c.y);return a+d},neighbors:function(c,b,a){var d=[],f=b.x;b=b.y;c[f-1]&&c[f-1][b]&&d.push(c[f-1][b]);c[f+1]&&c[f+1][b]&&d.push(c[f+1][b]);c[f]&&c[f][b-1]&&d.push(c[f][b-1]);c[f]&&c[f][b+1]&&d.push(c[f][b+1]);a&&(c[f-1]&&c[f-1][b-1]&&d.push(c[f-
1][b-1]),c[f+1]&&c[f+1][b-1]&&d.push(c[f+1][b-1]),c[f-1]&&c[f-1][b+1]&&d.push(c[f-1][b+1]),c[f+1]&&c[f+1][b+1]&&d.push(c[f+1][b+1]));return d}};var GraphNodeType={OPEN:1,WALL:0};function Graph(c){for(var b=[],a=0;a<c.length;a++){b[a]=[];for(var d=0,f=c[a];d<f.length;d++)b[a][d]=new GraphNode(a,d,f[d])}this.input=c;this.nodes=b}Graph.prototype.destroy=function(){delete this.input;delete this.nodes};Graph.prototype.toString=function(){for(var c="\n",b=this.nodes,a,d,f,e,h=0,l=b.length;h<l;h++){a="";d=b[h];f=0;for(e=d.length;f<e;f++)a+=d[f].type+" ";c=c+a+"\n"}return c};
function GraphNode(c,b,a){this.data={};this.x=c;this.y=b;this.pos={x:c,y:b};this.type=a}GraphNode.prototype.toString=function(){return"["+this.x+" "+this.y+"]"};GraphNode.prototype.isWall=function(){return this.type==GraphNodeType.WALL};function BinaryHeap(c){this.content=[];this.scoreFunction=c}
BinaryHeap.prototype={push:function(c){this.content.push(c);this.sinkDown(this.content.length-1)},pop:function(){var c=this.content[0],b=this.content.pop();0<this.content.length&&(this.content[0]=b,this.bubbleUp(0));return c},remove:function(c){var b=this.content.indexOf(c),a=this.content.pop();b!==this.content.length-1&&(this.content[b]=a,this.scoreFunction(a)<this.scoreFunction(c)?this.sinkDown(b):this.bubbleUp(b))},size:function(){return this.content.length},rescoreElement:function(c){this.sinkDown(this.content.indexOf(c))},
sinkDown:function(c){for(var b=this.content[c];0<c;){var a=(c+1>>1)-1,d=this.content[a];if(this.scoreFunction(b)<this.scoreFunction(d))this.content[a]=b,this.content[c]=d,c=a;else break}},bubbleUp:function(c){for(var b=this.content.length,a=this.content[c],d=this.scoreFunction(a);;){var f=c+1<<1,e=f-1,h=null;if(e<b){var l=this.scoreFunction(this.content[e]);l<d&&(h=e)}if(f<b&&this.scoreFunction(this.content[f])<(null===h?d:l))h=f;if(null!==h)this.content[c]=this.content[h],this.content[h]=a,c=h;else break}}};var boxledjs=boxledjs||{};
(function(c){Utils={getScreenWidth:function(){if("number"==typeof window.innerWidth)return window.innerWidth;if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight))return document.documentElement.clientWidth;if(document.body&&(document.body.clientWidth||document.body.clientHeight))return document.body.clientWidth},getScreenHeight:function(){if("number"==typeof window.innerWidth)return window.innerHeight;if(document.documentElement&&(document.documentElement.clientWidth||
document.documentElement.clientHeight))return document.documentElement.clientHeight;if(document.body&&(document.body.clientHeight||document.body.clientHeight))return document.body.clientHeight},getStage:function(b){return b.canvas?b:b.parent?b.parent.canvas?b.parent:c.getStage(b.parent):null},getDefinitionByName:function(b,a,d){a=a||window;d=d||b;b=b.split(".");var f=b.shift();if(a=a[f])return b.length?c.getDefinitionByName(b.join("."),a,d):a;throw Error("Could not find '"+f+"' of '"+d+"'");},applyConstruct:function(b,
a){function d(){function a(){}a.prototype=b.prototype;return new a}var f,e;"function"===typeof Object.create?f=Object.create(b.prototype):{}.__proto__?(f={},f.__proto__=b.prototype,f.__proto__!==b.prototype&&(f=d())):f=d();f.constructor=b;e=b.apply(f,a);"object"===typeof e&&(f=e);return f}};c.Utils=Utils})(boxledjs);boxledjs=boxledjs||{};
(function(c){function b(a,d){a=a.split(",");return{x:parseFloat(a[0])*d.width,y:parseFloat(a[1])*d.height}}Box2DUtils={RECT:"rect",CIRCLE:"circle",makeB2DBodyFromData:function(a,d){boxledjs.Const.scale=boxledjs.Const.scale||32;var f=a.properties,e=new Box2D.Dynamics.b2FixtureDef;e.density=void 0==f.density?1:parseFloat(f.density);e.friction=void 0==f.friction?0.5:parseFloat(f.friction);e.restitution=void 0==f.restitution?0.05:parseFloat(f.restitution);e.isSensor=!Box2DUtils.isTileCollideable(f);var h=
new Box2D.Dynamics.b2BodyDef;h.type=f.dynamic?Box2D.Dynamics.b2Body.b2_dynamicBody:Box2D.Dynamics.b2Body.b2_staticBody;var h=d.CreateBody(h),l=a.width/boxledjs.Const.scale/2,g=a.height/boxledjs.Const.scale/2;if(f.topLeft||f.topRight||f.bottomRight||f.bottomLeft)a.polygon=[],"none"!=f.topLeft&&a.polygon.push(b(f.topLeft||"0,0",a)),"none"!=f.topRight&&a.polygon.push(b(f.topRight||"1,0",a)),"none"!=f.bottomRight&&a.polygon.push(b(f.bottomRight||"1,1",a)),"none"!=f.bottomLeft&&a.polygon.push(b(f.bottomLeft||
"0,1",a));if(!0==a.ellipse)e.shape=new Box2D.Collision.Shapes.b2CircleShape(l),h.CreateFixture(e),a.x+=a.width/2,a.y+=a.height/2;else if(a.polygon&&1<a.polygon.length)Box2D.Ext.b2Separator.Separate(h,e,a.polygon,boxledjs.Const.scale);else if(a.polyline&&1<a.polyline.length)for(var j,l=0,g=a.polyline.length;l<g-1;l++)e.shape=new Box2D.Collision.Shapes.b2PolygonShape,j=a.polyline[l],f=new Box2D.Common.Math.b2Vec2(j.x/boxledjs.Const.scale,j.y/boxledjs.Const.scale),j=a.polyline[l+1],j=new Box2D.Common.Math.b2Vec2(j.x/
boxledjs.Const.scale,j.y/boxledjs.Const.scale),e.shape.SetAsEdge(f,j),h.CreateFixture(e);else e.shape=new Box2D.Collision.Shapes.b2PolygonShape,e.shape.SetAsBox(l,g),h.CreateFixture(e),a.x+=a.width/2,a.y+=a.height/2;h.SetPositionAndAngle(new Box2D.Common.Math.b2Vec2(a.x/boxledjs.Const.scale,a.y/boxledjs.Const.scale),(a.rotation||0)*Math.PI/180);h.SetUserData(a);return h},isTileCollideable:function(a,d){return 0!=d&&(!a||!(a.isSensor&&"false"!=a.isSensor||a.noCollision&&"false"!=a.noCollision||a.force||
a.forceX||a.forceY||void 0!=a.gravityFactor))},injectBox2d:function(a,d,f,e,h,b,g,j,c,n){void 0==j&&(j=!0);void 0==c&&(c=!1);n=n||"borders";var m=boxledjs.Const.scale=boxledjs.Const.scale||32;a.bxd=a.bxd||{};f*=0.5;e*=0.5;var p=new Box2D.Dynamics.b2FixtureDef;p.density=void 0==h?1:h;p.friction=void 0==b?0.5:b;p.restitution=void 0==g?0.05:g;p.isSensor=c;if(d==Box2DUtils.RECT){if(p.shape=new Box2D.Collision.Shapes.b2PolygonShape,p.shape.SetAsBox(f/m,e/m),!c){sensorsDef={};if("borders"==n||"both"==n)sensorsDef.bottom=
Box2DUtils.makeSensorDef((f+2)/m,2/m,0,e/m),sensorsDef.top=Box2DUtils.makeSensorDef((f+2)/m,2/m,0,-e/m),sensorsDef.right=Box2DUtils.makeSensorDef(2/m,(e-1)/m,f/m,0),sensorsDef.left=Box2DUtils.makeSensorDef(2/m,(e-1)/m,-f/m,0);if("corners"==n||"both"==n)sensorsDef.tr=Box2DUtils.makeSensorDef(2/m,2/m,(f+2)/m,-e/m),sensorsDef.br=Box2DUtils.makeSensorDef(2/m,2/m,(f+2)/m,(e+4)/m),sensorsDef.bl=Box2DUtils.makeSensorDef(2/m,2/m,-(f+2)/m,(e+4)/m),sensorsDef.tl=Box2DUtils.makeSensorDef(2/m,2/m,-(f+2)/m,-e/
m)}}else if(d==Box2DUtils.CIRCLE)p.shape=new Box2D.Collision.Shapes.b2CircleShape(2*f/m);else throw Error("Cannot resolve shape-type: "+d);a.bxd.fixDef=p;c||(a.bxd.sensors={bottom:0,top:0,right:0,left:0,tr:0,br:0,bl:0,tl:0},a.bxd.sensorsDef=sensorsDef);d=new Box2D.Dynamics.b2BodyDef;d.type=!j?Box2D.Dynamics.b2Body.b2_staticBody:Box2D.Dynamics.b2Body.b2_dynamicBody;a.bxd.bodyDef=d;Box2DUtils.injectOnTick(a)},injectOnTick:function(a){a.onTick&&(a.__onTick=a.onTick);a.onTick=function(a){this.__onTick&&
this.__onTick(a);if(this.bxd.body){a=this.bxd.body.GetPosition();if(-5E4>=a.x||-5E4>=a.y){var f=this;f.hideTO=setTimeout(function(){f.visible=!1},50)}else this.hideTO&&(clearTimeout(this.hideTO),delete this.hideTO),this.visible=!0;this.x=a.x*(boxledjs.Const.scale||32);this.y=a.y*(boxledjs.Const.scale||32);this.rotation=180*(this.bxd.body.GetAngle()/Math.PI)}}},makeSensorDef:function(a,d,f,e){var h=new Box2D.Dynamics.b2FixtureDef;h.isSensor=!0;var b=new Box2D.Collision.Shapes.b2PolygonShape;b.SetAsOrientedBox(a,
d,new Box2D.Common.Math.b2Vec2(f,e),0);h.shape=b;return h}};c.Box2DUtils=Box2DUtils})(boxledjs);Object.equals=function(c,b){if(c===b)return!0;if(!(c instanceof Object)||!(b instanceof Object)||c.constructor!==b.constructor)return!1;for(var a in c)if(c.hasOwnProperty(a)&&(!b.hasOwnProperty(a)||c[a]!==b[a]&&("object"!==typeof c[a]||!Object.equals(c[a],b[a]))))return!1;for(a in b)if(b.hasOwnProperty(a)&&!c.hasOwnProperty(a))return!1;return!0};var Box2D=Box2D||{};Box2D.Ext=Box2D.Ext||{};
(function(c){function b(a,d,h,b,g,c){var k;if(k=(h+0.1>=a&&a>=g-0.1||h-0.1<=a&&a<=g+0.1)&&(b+0.1>=d&&d>=c-0.1||b-0.1<=d&&d<=c+0.1))0.1<g-h||0.1<h-g?(a=(c-b)/(g-h)*(a-h)+b,k=0.1>(a>d?a-d:d-a)):k=0.1>a-h||0.1>h-a;return k}function a(a,d,b,l){return 0.1>(b>=a?b-a:a-b)&&0.1>(l>=d?l-d:d-l)}function d(){throw Error("A problem has occurred. Use the Validate() method to see where the problem is.");}c.b2Separator={Separate:function(f,e,h,l){l=l||32;var g,c=h.length,k,n,m=[];for(g=0;g<c;g++)m.push(new Box2D.Common.Math.b2Vec2(h[g].x/
l,h[g].y/l));var p,s,q,t,z,x,B,y,u,r,v,w,A,E;l=[];h=[];for(h.push(m);h.length;){g=h[0];c=g.length;E=!0;for(p=0;p<c;p++)if(m=p,B=p<c-1?p+1:p+1-c,q=p<c-2?p+2:p+2-c,y=g[m],u=g[B],q=g[q],q=y.x*u.y+u.x*q.y+q.x*y.y-y.y*u.x-u.y*q.x-q.y*y.x,0>q){E=!1;x=Number.MAX_VALUE;for(s=0;s<c;s++)if(s!=m&&s!=B){p=s;q=s<c-1?s+1:0;r=g[p];v=g[q];t=y.x;z=y.y;var G=u.x,H=u.y;w=r.x;r=r.y;var I=v.x;v=v.y;var C=G-t,D=H-z,J=I-w,K=v-r,F=void 0,F=(J*(r-z)-K*(w-t))/(D*J-C*K),C=t+F*C,D=z+F*D;t=b(G,H,t,z,C,D);w=b(C,D,w,r,I,v);if(w=
t&&w?new Box2D.Common.Math.b2Vec2(C,D):null)t=u.x-w.x,z=u.y-w.y,t=t*t+z*z,t<x&&(n=p,k=q,A=w,x=t)}x==Number.MAX_VALUE&&d();s=[];x=[];p=n;q=k;r=g[p];v=g[q];a(A.x,A.y,v.x,v.y)||s.push(A);a(A.x,A.y,r.x,r.y)||x.push(A);n=-1;for(k=m;;){if(k!=q)s.push(g[k]);else{(0>n||n>=c)&&d();b(v.x,v.y,g[n].x,g[n].y,y.x,y.y)||s.push(g[k]);break}n=k;0>k-1?k=c-1:k--}s=s.reverse();n=-1;for(k=B;;){if(k!=p)x.push(g[k]);else{(0>n||n>=c)&&d();k==p&&!b(r.x,r.y,g[n].x,g[n].y,u.x,u.y)&&x.push(g[k]);break}n=k;k+1>c-1?k=0:k++}h.push(s,
x);h.shift();break}E&&l.push(h.shift())}c=l.length;for(g=0;g<c;g++){h=[];m=l[g];n=m.length;for(k=0;k<n;k++)h.push(new Box2D.Common.Math.b2Vec2(m[k].x,m[k].y));k=new Box2D.Collision.Shapes.b2PolygonShape;k.SetAsArray(h);e.shape=k;f.CreateFixture(e)}},Validate:function(a){var d,h=a.length,l,g,c,k,n,m=0,p,s=!1;for(d=0;d<h;d++){c=d<h-1?d+1:0;k=0<d?d-1:h-1;p=!1;for(l=0;l<h;l++)if(l!=d&&l!=c&&(p||(n=a[d].x*a[c].y+a[c].x*a[l].y+a[l].x*a[d].y-a[d].y*a[c].x-a[c].y*a[l].x-a[l].y*a[d].x,0<n&&(p=!0)),l!=k)){g=
l<h-1?l+1:0;var q=a[d].x,t=a[d].y,z=a[c].x,x=a[c].y;n=a[l].x;var B=a[l].y,y=a[g].x;g=a[g].y;var u=z-q,r=x-t,v=y-n,w=g-B,A=void 0,A=(v*(B-t)-w*(n-q))/(r*v-u*w),u=q+A*u,r=t+A*r,q=b(u,r,q,t,z,x);n=b(u,r,n,B,y,g);n=q&&n?new Box2D.Common.Math.b2Vec2(u,r):null;n&&(m=1)}p||(s=!0)}s&&(m=1==m?3:2);return m}}})(Box2D.Ext);boxledjs=boxledjs||{};
(function(c){function b(){}b.prototype=new Box2D.Dynamics.b2ContactListener;var a=b.prototype;a.BeginContact=function(a){var f=a.GetFixtureA(),e=a.GetFixtureB();this.__BeginContactOrdered(f,e,a);this.__BeginContactOrdered(e,f,a)};a.__BeginContactOrdered=function(a,f,e){var b=a.GetBody().GetUserData(),c=f.GetBody().GetUserData();b&&b.objectData&&(b=b.objectData);c&&c.objectData&&(c=c.objectData);this.__applyForceField(a,f,b,c,1,1,e);this.__applyImpulse(a,f,b,c,e);this.__handleCustomEvents(a,f,b,c,
e,"beginContact")};a.EndContact=function(a){var f=a.GetFixtureA();a=a.GetFixtureB();this.__EndContactOrdered(f,a);this.__EndContactOrdered(a,f)};a.__EndContactOrdered=function(a,f,e){var b=a.GetBody().GetUserData(),c=f.GetBody().GetUserData();b&&b.objectData&&(b=b.objectData);c&&c.objectData&&(c=c.objectData);this.__applyForceField(a,f,b,c,-1,0,e);this.__handleCustomEvents(a,f,b,c,e,"endContact")};a.__applyForceField=function(a,f,e,b,c,g){if(e&&e.properties&&(e.properties.forceX||e.properties.forceY))if((e.properties.forceX||
e.properties.forceY)&&!f.IsSensor()){b=parseFloat(e.properties.forceX)||0;var j=parseFloat(e.properties.forceY)||0,k=f.GetBody();k.o_fieldForceX=k.o_fieldForceX+b*c||b*(g||0);k.o_fieldForceY=k.o_fieldForceY+j*c||j*(g||0)}if(e&&e.properties&&(e.properties.force||void 0!=e.properties.gravityFactor)&&!f.IsSensor())k=f.GetBody(),k.o_dynamicForceFields=k.o_dynamicForceFields||[],1==c?k.o_dynamicForceFields.push(a.GetBody()):k.o_dynamicForceFields.splice(k.o_dynamicForceFields.indexOf(a.GetBody()),1)};
a.__applyImpulse=function(a,f,e,b,c){if(e&&e.properties&&(e.properties.impulseX||e.properties.impulseY||e.properties.impulse)){if((e.properties.impulseX||e.properties.impulseY)&&!f.IsSensor()){b=parseFloat(e.properties.impulseX)||0;var g=parseFloat(e.properties.impulseY)||0,j=f.GetBody();j.ApplyImpulse(new Box2D.Common.Math.b2Vec2(b||0,g||0),j.GetWorldCenter())}e.properties.impulse&&!f.IsSensor()&&(e=parseFloat(e.properties.impulse)||0,a=a.GetBody(),f=f.GetBody(),b=new Box2D.Common.Math.b2Vec2(f.GetWorldCenter().x,
f.GetWorldCenter().y),b.Subtract(a.GetWorldCenter()),b.Normalize(),b.Multiply(e),f.ApplyImpulse(b,f.GetWorldPoint(c.GetManifold().m_localPoint)))}};a.__handleCustomEvents=function(a,f,e,b,c,g){e&&(e.properties&&e.properties.event)&&(a={type:e.properties.event,detail:{status:g,targetFixture:a,triggeringFixture:f}},e.eventsToDispatch=e.eventsToDispatch||[],e.eventsToDispatch.push(a))};a.PreSolve=function(){};c.BoxledJSContactListener=b})(boxledjs);boxledjs=boxledjs||{};
(function(c){function b(){}b.prototype=new boxledjs.BoxledJSContactListener;var a=b.prototype;a.super_BeginContact=a.BeginContact;a.BeginContact=function(a){this.super_BeginContact(a);this.__HandleContact(a,1)};a.super_EndContact=a.EndContact;a.EndContact=function(a){this.super_EndContact(a);this.__HandleContact(a,-1)};a.__HandleContact=function(a,f){var e=a.GetFixtureA(),b=a.GetFixtureB(),c=e.IsSensor()?e:b.IsSensor()?b:null;if(c){var e=e!=c?e:b,g;if((b=g=e.GetBody().GetUserData())&&b.objectData)b=
b.objectData;var j=c.GetUserData();j&&j.object&&(j=j.object);g&&g.object&&(g=g.object);if(c.GetUserData()&&c.GetUserData().sensorPosition){var k=c.GetBody().GetUserData(),n=e.GetBody().GetUserData();if(n&&n.onContact)n.onContact(k);var c=c.GetUserData()&&c.GetUserData().sensorPosition,m=j.ignoreCollisionsWith||(j.properties&&j.properties.ignoreCollisionsWith?j.properties.ignoreCollisionsWith:this._ea),p=g.ignoreCollisionsWith||(g.properties&&g.properties.ignoreCollisionsWith?g.properties.ignoreCollisionsWith:
this._ea);if(!(b&&b.properties&&b.properties.noBottomCollision&&("left"==c||"right"==c)||e.IsSensor()||0<=m.indexOf(g.subType)||0<=m.indexOf(g.type)||0<=p.indexOf(j.subType)||0<=p.indexOf(j.type))&&k&&k.bxd&&k.bxd.sensors&&c&&!1!==k.visible&&!1!==n.visible)k.bxd.sensors[c]+=f,k.bxd.sensors[c]=Math.max(k.bxd.sensors[c],0)}}};a._ea=[];a.super_PreSolve=a.PreSolve;a.PreSolve=function(a,f){this.super_PreSolve(a,f);var e=a.GetFixtureA(),b=a.GetFixtureB(),c,g,j;c=e.GetBody().GetUserData();g=b.GetBody().GetUserData();
c&&c.objectData&&(c=c.objectData);g&&g.objectData&&(g=g.objectData);j=c.ignoreCollisionsWith||c.properties.ignoreCollisionsWith||this._ea;var k=g.ignoreCollisionsWith||g.properties.ignoreCollisionsWith||this._ea;if(!1===c.visible||!1===g.visible||0<=j.indexOf(g.subType)||0<=j.indexOf(g.type)||0<=k.indexOf(c.subType)||0<=k.indexOf(c.type))a.SetEnabled(!1);else if(c&&c.properties&&c.properties.noBottomCollision||g&&g.properties&&g.properties.noBottomCollision)e.GetBody().GetDefinition().type==Box2D.Dynamics.b2Body.b2_staticBody?
(g=b.GetBody().m_linearVelocity.y,j=b.GetBody().m_invMass,c=b.GetAABB(),e=e.GetAABB()):(g=e.GetBody().m_linearVelocity.y,j=e.GetBody().m_invMass,c=e.GetAABB(),e=b.GetAABB()),b=Math.abs(e.lowerBound.y-e.upperBound.y),g=g*j/Box2D.Dynamics.b2World.s_timestep2.velocityIterations,(c.upperBound.y-g>e.upperBound.y&&c.upperBound.y>e.upperBound.y||c.upperBound.y-g>e.lowerBound.y+b/25&&c.upperBound.y>e.lowerBound.y+b/25)&&a.SetEnabled(!1)};c.PlatformerContactListener=b})(boxledjs);boxledjs=boxledjs||{};
(function(c){function b(a,d){this.initialize(a,d)}b.prototype=new createjs.Container;b.prototype.Container_init=b.prototype.initialize;b.prototype.initialize=function(a,d){this.Container_init();this.data=a;this.properties=a.properties;this.objects={};this.map=d;this.reset()};b.prototype.reset=function(){this.initObjects()};b.prototype.destroy=function(){var a,d;this.parent&&this.parent.removeChild(this);for(a in this.objects)d=this.objects[a],d.destroy&&d.destroy(),d.parent&&(d.parent.removeChild(d),
delete this.objects[a]);delete this.objects;for(a in this.children)d=this.children[a],d.destroy&&d.destroy();this.removeAllChildren()};b.prototype.onTick=function(){!1!==this.zSorting&&this.sortChildren(this.compareChildY)};b.prototype.compareChildY=function(a,d){return a.y<d.y?-1:a.y>d.y?1:0};b.prototype.initObjects=function(){var a,d,f,e;a=0;for(d=this.data.objects.length;a<d;a++){f=this.data.objects[a];if(f.type&&""!=f.type)e=b.makeObjectFromData(f);else if(this.map.b2dWorld)e=boxledjs.Box2DUtils.makeB2DBodyFromData(f,
this.map.b2dWorld);else{e="Couldn't create b2Body from objectData, because map.b2dWorld is "+this.map.b2dWorld;console.warn&&console.warn(e,f);continue}this.initObject(e,f)}};b.prototype.initObject=function(a,d){try{a.isVisible&&this.addChild(a)}catch(b){}try{if(a.bxd){var e=this.map.b2dWorld.CreateBody(a.bxd.bodyDef);e.CreateFixture(a.bxd.fixDef);a.bxd.sensorsDef&&(a.bxd.sensorsDef.bottom&&e.CreateFixture(a.bxd.sensorsDef.bottom).SetUserData({object:a,sensorPosition:"bottom"}),a.bxd.sensorsDef.top&&
e.CreateFixture(a.bxd.sensorsDef.top).SetUserData({object:a,sensorPosition:"top"}),a.bxd.sensorsDef.right&&e.CreateFixture(a.bxd.sensorsDef.right).SetUserData({object:a,sensorPosition:"right"}),a.bxd.sensorsDef.left&&e.CreateFixture(a.bxd.sensorsDef.left).SetUserData({object:a,sensorPosition:"left"}),a.bxd.sensorsDef.tr&&e.CreateFixture(a.bxd.sensorsDef.tr).SetUserData({object:a,sensorPosition:"tr"}),a.bxd.sensorsDef.br&&e.CreateFixture(a.bxd.sensorsDef.br).SetUserData({object:a,sensorPosition:"br"}),
a.bxd.sensorsDef.bl&&e.CreateFixture(a.bxd.sensorsDef.bl).SetUserData({object:a,sensorPosition:"bl"}),a.bxd.sensorsDef.tl&&e.CreateFixture(a.bxd.sensorsDef.tl).SetUserData({object:a,sensorPosition:"tl"}));e.SetPositionAndAngle(new Box2D.Common.Math.b2Vec2(a.x/boxledjs.Const.scale,a.y/boxledjs.Const.scale),a.rotation*Math.PI/180);a.bxd.sensorsDef=void 0;a.bxd.body=e;e.SetUserData(a);if(a.onBodyCreated)a.onBodyCreated(e)}}catch(c){}a.layer=this;d&&(d.name&&""!=d.name)&&(this.objects[d.name]=a,this.map.objects[d.name]=
a);d&&(d.group&&""!=d.group)&&(this.map.objectGroups[d.group]=this.map.objectGroups[d.group]||[],this.map.objectGroups[d.group].push(a))};b.makeObjectFromData=function(a){var d,b,e,c=a.properties;d=boxledjs.Utils.getDefinitionByName(a.type||c.type||c.classDefinition);c.parameter&&""!=c.parameter&&(b=JSON.parse(c.parameter),"object"==typeof b&&(e=boxledjs.Utils.applyConstruct(d,b)));e=e||new d;for(var l in c)"classDefinition"!=l&&"parameter"!=l&&(e[l]=c[l]);e.x=a.x;e.y=a.y;if(void 0!=a.scaleX||void 0!=
c.scaleX)e.scaleX=a.scaleX||c.scaleX;if(void 0!=a.scaleY||void 0!=c.scaleY)e.scaleY=a.scaleY||c.scaleY;e.rotation=a.rotation;return e};c.ObjectLayer=b})(boxledjs);boxledjs=boxledjs||{};
(function(c){function b(a,d){this.initialize(a,d)}b.prototype=new createjs.Container;b.prototype.Container_init=b.prototype.initialize;b.prototype.initialize=function(a,d){this.Container_init();this.data=a;this.properties=a.properties;this.map=d;this.reset()};b.prototype.reset=function(){this.x=this.data.x;this.y=this.data.y;this.visible=this.data.visible;this.alpha=void 0!=this.data.opacity?parseFloat(this.data.opacity):1;this.numTilesX=this.data.width;this.numTilesY=this.data.height;if(this.isCollisionLayer=
this.properties&&this.properties.collisionLayer&&"false"!=this.properties.collisionLayer)this.colTilesToCheck=[],this.colTileGroups=[];this.pathfinding={};this.drawTiles();this.data.properties&&"false"!==this.data.properties.cached&&this.cache(0,0,this.map.data.tilewidth*this.numTilesX,this.map.data.tileheight*this.numTilesY);this.isCollisionLayer&&this.map.b2dWorld&&this.calculateCollisionShapes()};b.prototype.destroy=function(){var a,d;this.data.properties&&"false"!==this.data.properties.cached&&
this.uncache();this.parent&&this.parent.removeChild(this);for(a in this.objects)d=this.objects[a],d.destroy&&d.destroy(),d.parent&&(d.parent.removeChild(d),delete this.objects[a]);delete this.objects;for(a in this.children)d=this.children[a],d.destroy&&d.destroy();this.pathfinding&&this.pathfinding.graph&&(this.pathfinding.graph.destroy(),delete this.pathfinding.graph,delete this.pathfinding);this.removeAllChildren()};b.prototype.drawTiles=function(){var a=this.data.data,d,b,e,c,l,g,j,k=[],n;this.tileObjects=
[];for(d=0;d<this.numTilesX;d++){n=[];for(b=0;b<this.numTilesY;b++)e=b*this.numTilesX+d,c=a[e],j=this.map.getTileProperties(c),0!=c&&void 0!=c&&(j&&j.type&&""!=j.type?(l={},l.properties=j,l.x=d,l.y=b,g=boxledjs.ObjectLayer.makeObjectFromData(l),g.regX=this.map.data.tilewidth/2,g.regY=this.map.data.tileheight/2):(l=this.map.getTileById(c),g=new createjs.Bitmap(l.image),g.sourceRect=l.rect),g.x=d*this.map.data.tilewidth,g.y=b*this.map.data.tileheight,g.properties=j,this.addChild(g),this.tileObjects[e]=
g),this.isCollisionLayer?(this.colTilesToCheck[e]=c,e=!Box2DUtils.isTileCollideable(j,c)):e=!j||"false"!=j.passable,n.push(e?GraphNodeType.OPEN:GraphNodeType.WALL);k.push(n)}this.pathfinding.graph=new Graph(k)};b.prototype.calculateCollisionShapes=function(){var a,d,b,c,h=this.map.data.tilewidth,l=this.map.data.tileheight;for(b=0;b<this.numTilesY;b++)for(d=0;d<this.numTilesX;d++)a=b*this.numTilesX+d,a=this.colTilesToCheck[a],void 0!=a&&0!=a&&(this.colTileGroups.push({tiles:[]}),this.findNextCollisionShapeTile(d,
b));a=0;for(c=this.colTileGroups.length;a<c;a++){var g=this.colTileGroups[a],j=g.tiles;d=j[0].x;b=j[0].y;j=j[j.length-1].x-d+1;g=this.map.getTileProperties(g.tileid)||{};g={x:d*h,y:b*l,width:j*h,height:1*l,properties:g};j=boxledjs.Box2DUtils.makeB2DBodyFromData(g,this.map.b2dWorld);if((d=this.tileObjects[b*this.numTilesX+d])&&d.properties&&d.properties.type){if(j.SetUserData(d),d.bxd=d.bxd||{},d.bxd.body=j,Box2DUtils.injectOnTick(d),d.onBodyCreated)d.onBodyCreated(j)}else j.SetUserData(g)}};b.prototype.findNextCollisionShapeTile=
function(a,d){a=a||0;d=d||0;var b,c,h;b=d*this.numTilesX+a;c=this.colTilesToCheck[b];void 0!=c&&0!=c&&(h=this.colTileGroups[this.colTileGroups.length-1],h.tileid=h.tileid||c,Object.equals(this.map.getTileProperties(c),this.map.getTileProperties(h.tileid))&&(h.tiles.push({x:a,y:d,tileid:c}),this.colTilesToCheck[b]=void 0,this.findNextCollisionShapeTile(a+1,d)))};c.TileLayer=b})(boxledjs);boxledjs=boxledjs||{};boxledjs.Const={};boxledjs.Const.scale=32;
(function(c){function b(a,d){this.initialize(a,d)}b.prototype=new createjs.Container;b.prototype.Container_init=b.prototype.initialize;b.prototype.initialize=function(a,d){this.Container_init();this.b2dWorld=d;this.data=a;this.reset()};b.prototype.reset=function(){this.viewPort={};this.layers={};this.objects={};this.objectGroups={};if(!1!==this.b2dWorld&&void 0===this.b2dWorld){boxledjs.Const.scale=parseFloat(this.data.properties.box2dScale)||boxledjs.Const.scale;this.b2dWorld=new Box2D.Dynamics.b2World(new Box2D.Common.Math.b2Vec2(parseFloat(this.data.properties.forceX)||
0,parseFloat(this.data.properties.forceY)||20),!0);var a=new boxledjs.PlatformerContactListener;this.b2dWorld.SetContactListener(a)}this.firstTick=!1;this.generateTileSets();this.pathfinding={};var d=this;setTimeout(function(){d.setupLayers();d.initialized=!0},50)};b.prototype.destroy=function(){var a,d;if(this.b2dWorld){for(d=this.b2dWorld.GetBodyList();d;){var b=d;d=d.GetNext();this.b2dWorld.DestroyBody(b)}delete this.b2dWorld}this.parent&&this.parent.removeChild(this);for(a in this.objects)d=this.objects[a],
d.destroy&&d.destroy(),d.parent&&(d.parent.removeChild(d),delete this.objects[a]);delete this.objects;for(a in this.layers)d=this.layers[a],d.destroy();delete this.layers;this.removeAllChildren();return!0};b.prototype.onTick=function(){!this._firstTick&&this._onFirstTick();this.centerObject&&this.centerTo(this.centerObject)};b.prototype._onFirstTick=function(){var a=boxledjs.Utils.getStage(this).canvas;void 0==this.viewPort.width&&(this.viewPort.width=a.width);void 0==this.viewPort.height&&(this.viewPort.height=
a.height);!this.b2dDebugDraw&&this.setupDebugDraw(a);this._firstTick=!0};b.prototype.update=function(a){if(this.initialized&&!1!==this.b2dWorld&&void 0!==this.b2dWorld){for(var d=this.b2dWorld.GetBodyList();d;){var b=d.GetUserData(),c=b?b.properties:{};if(b&&b.eventsToDispatch)for(;b.eventsToDispatch.length;){var h=b.eventsToDispatch.pop();this.dispatchEvent(h)}if(!c||!0!=c.ignoreForces){if(d.o_fieldForceX||d.o_fieldForceY)d.ApplyForce(new Box2D.Common.Math.b2Vec2((d.o_fieldForceX||0)*d.GetMass(),
(d.o_fieldForceY||0)*d.GetMass()),d.GetWorldCenter());if(d.o_dynamicForceFields&&d.o_dynamicForceFields.length){for(var b=[],l,c=0,h=d.o_dynamicForceFields.length;c<h;c++){var g=d.o_dynamicForceFields[c],j=parseFloat(g.GetUserData().properties.force)||0,k=new Box2D.Common.Math.b2Vec2(d.GetWorldCenter().x,d.GetWorldCenter().y);k.Subtract(g.GetWorldCenter());k.Normalize();k.Multiply(j);k.Multiply(d.GetMass());!isNaN(k.x)&&!isNaN(k.y)&&d.ApplyForce(k,d.GetWorldCenter());void 0!=g.GetUserData().properties.gravityFactor&&
b.push(parseFloat(g.GetUserData().properties.gravityFactor))}c=0;for(h=b.length;c<h;c++)l=l+b[c]||b[c];isNaN(l)||(c=this.b2dWorld.GetGravity().GetNegative(),c.Multiply(1-l/b.length),c.Multiply(d.GetMass()),d.ApplyForce(c,d.GetWorldCenter()))}}d=d.GetNext()}this.b2dWorld&&this.b2dWorld.Step((a||30)/1E3,10,10);this.b2dWorld&&this.b2dWorld.ClearForces()}};b.prototype.setupDebugDraw=function(a){if(!this.b2dWorld)return null;this.b2dDebugDraw=new Box2D.Dynamics.b2DebugDraw;this.b2dDebugDraw.SetSprite(a.getContext("2d"));
this.b2dDebugDraw.SetDrawScale(boxledjs.Const.scale);this.b2dDebugDraw.SetFillAlpha(0.35);this.b2dDebugDraw.SetFlags(Box2D.Dynamics.b2DebugDraw.e_shapeBit|Box2D.Dynamics.b2DebugDraw.e_jointBit);this.b2dWorld.SetDebugDraw(this.b2dDebugDraw);return this.b2dDebugDraw};b.prototype.drawDebugData=function(a){this.b2dWorld&&(a=a||1,this.b2dDebugDraw.SetFillAlpha(0.35*a),this.b2dDebugDraw.SetAlpha(1*a),this.b2dDebugDraw.GetSprite().save(),this.b2dDebugDraw.GetSprite().scale(this.scaleX,this.scaleY),this.b2dDebugDraw.GetSprite().translate(-this.regX+
this.x/this.scaleX,-this.regY+this.y/this.scaleY),this.b2dWorld.DrawDebugData(),this.b2dDebugDraw.GetSprite().restore())};b.prototype.setupLayers=function(){var a,b,c,e,h=[];a=0;for(b=this.data.layers.length;a<b;a++){c=this.data.layers[a];if("tilelayer"==c.type){e=new boxledjs.TileLayer(c,this);this.addChild(e);for(var l=e.pathfinding.graph.input,g=0,j=l.length;g<j;g++){var k=l[g],n=h[g]||[];h[g]=n;for(var m=0,p=k.length;m<p;m++)n[m]=(n[m]||1)&k[m]}}else"objectgroup"==c.type&&(e=new boxledjs.ObjectLayer(c,
this),this.addChild(e));c.name&&""!=c.name&&(this.layers[c.name]=e)}this.pathfinding.graph=new Graph(h)};b.prototype.centerTo=function(a){"string"==typeof a&&(a=this.objects[a]);if(a&&void 0!=a){var b,c;a.GetPosition?(c=a.GetPosition(),b=c.x*boxledjs.Const.scale,c=c.y*boxledjs.Const.scale):void 0!=a.x&&void 0!=a.y&&(b=a.x,c=a.y);if(!(void 0==b||void 0==c)){a=this.viewPort.width||0;var e=this.viewPort.height||0;this.regX=b;this.regY=c;this.x=a/2;this.y=e/2}}};b.prototype.calculatePath=function(a,b,
c,e){var h=this.pathfinding.graph.nodes;a=h[a.x][a.y];b=h[b.x][b.y];if((a=astar.search(h,a,b,c))&&a.length&&!0===e){e=!1;for(var l,g=0;g<a.length-2;g++)for(e=!1;!e&&a[g+2];)b=a[g].x-a[g+1].x,c=a[g].y-a[g+1].y,h=a[g].x-a[g+2].x,l=a[g].y-a[g+2].y,0==h&&0==b||0==l&&0==c?a.splice(g+1,1):e=!0}return a};b.prototype.generateTileSets=function(){this.tilesets=[];this.tileproperties={};for(var a=0,c=this.data.tilesets.length;a<c;a++){var f=b.convertTileSetToSpriteSheet(this.data.tilesets[a]);this.tilesets.push(f);
for(var e in f.tileproperties)this.tileproperties[e]=f.tileproperties[e]}};b.prototype.getTileById=function(a){a-=1;return this.getSpriteSheetByTileId(a).getFrame(a)};b.prototype.getSpriteSheetByTileId=function(a){a=a||1;var b=this.tilesets,c,e,h,l;c=0;for(e=b.length;c<e;c++)h=b[c],h.firstgid<=a&&0<h.firstgid&&(l=h);return l};b.prototype.getTileProperties=function(a){return this.tileproperties[a-1]};b.convertTileSetToSpriteSheet=function(a){var b={};b.images=[a.image];b.frames={width:a.tilewidth,
height:a.tileheight};b=new createjs.SpriteSheet(b);b.firstgid=a.firstgid;b.tileproperties=a.tileproperties;return b};c.Map=b})(boxledjs);
