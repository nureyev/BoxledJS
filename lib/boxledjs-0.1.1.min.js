var boxledjs=boxledjs||{};
(function(l){Utils={getScreenWidth:function(){if("number"==typeof window.innerWidth)return window.innerWidth;if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight))return document.documentElement.clientWidth;if(document.body&&(document.body.clientWidth||document.body.clientHeight))return document.body.clientWidth},getScreenHeight:function(){if("number"==typeof window.innerWidth)return window.innerHeight;if(document.documentElement&&(document.documentElement.clientWidth||
document.documentElement.clientHeight))return document.documentElement.clientHeight;if(document.body&&(document.body.clientHeight||document.body.clientHeight))return document.body.clientHeight},getStage:function(a){return a.canvas?a:a.parent?a.parent.canvas?a.parent:l.getStage(a.parent):null},getDefinitionByName:function(a,d,b){d=d||window;b=b||a;a=a.split(".");var f=a.shift();if(d=d[f])return a.length?l.getDefinitionByName(a.join("."),d,b):d;throw Error("Could not find '"+f+"' of '"+b+"'");},applyConstruct:function(a,
d){function b(){function c(){}c.prototype=a.prototype;return new c}var f,c;"function"===typeof Object.create?f=Object.create(a.prototype):{}.__proto__?(f={},f.__proto__=a.prototype,f.__proto__!==a.prototype&&(f=b())):f=b();f.constructor=a;c=a.apply(f,d);"object"===typeof c&&(f=c);return f}};l.Utils=Utils})(boxledjs);boxledjs=boxledjs||{};
(function(l){Box2DUtils={RECT:"rect",CIRCLE:"circle",makeB2DBodyFromData:function(a,d){boxledjs.Const.scale=boxledjs.Const.scale||32;var b=a.properties,f=new Box2D.Dynamics.b2FixtureDef;f.density=void 0==b.density?1:parseFloat(b.density);f.friction=void 0==b.friction?0.5:parseFloat(b.friction);f.restitution=void 0==b.restitution?0.05:parseFloat(b.restitution);f.isSensor=b.isSensor&&"false"!=b.isSensor||b.noCollision&&"false"!=b.noCollision||b.force||b.forceX||b.forceY||void 0!=b.gravityFactor;var c=
new Box2D.Dynamics.b2BodyDef;c.type=b.dynamic?Box2D.Dynamics.b2Body.b2_dynamicBody:Box2D.Dynamics.b2Body.b2_staticBody;var b=d.CreateBody(c),c=a.width/boxledjs.Const.scale/2,k=a.height/boxledjs.Const.scale/2;if(!0==a.ellipse)f.shape=new Box2D.Collision.Shapes.b2CircleShape(c),b.CreateFixture(f),a.x+=a.width/2,a.y+=a.height/2;else if(a.polygon&&1<a.polygon.length)Box2D.Ext.b2Separator.Separate(b,f,a.polygon,boxledjs.Const.scale);else if(a.polyline&&1<a.polyline.length){var e,g,k=0;for(g=a.polyline.length;k<
g-1;k++)f.shape=new Box2D.Collision.Shapes.b2PolygonShape,e=a.polyline[k],c=new Box2D.Common.Math.b2Vec2(e.x/boxledjs.Const.scale,e.y/boxledjs.Const.scale),e=a.polyline[k+1],e=new Box2D.Common.Math.b2Vec2(e.x/boxledjs.Const.scale,e.y/boxledjs.Const.scale),f.shape.SetAsEdge(c,e),b.CreateFixture(f)}else f.shape=new Box2D.Collision.Shapes.b2PolygonShape,f.shape.SetAsBox(c,k),b.CreateFixture(f),a.x+=a.width/2,a.y+=a.height/2;b.SetPositionAndAngle(new Box2D.Common.Math.b2Vec2(a.x/boxledjs.Const.scale,
a.y/boxledjs.Const.scale),(a.rotation||0)*Math.PI/180);b.SetUserData(a);return b},injectBox2d:function(a,d,b,f,c,k,e,g){void 0==g&&(g=!0);var h=boxledjs.Const.scale=boxledjs.Const.scale||32;a.bxd={};b*=0.5;f*=0.5;var j=new Box2D.Dynamics.b2FixtureDef;j.density=void 0==c?1:c;j.friction=void 0==k?0.5:k;j.restitution=void 0==e?0.05:e;if(d==Box2DUtils.RECT)j.shape=new Box2D.Collision.Shapes.b2PolygonShape,j.shape.SetAsBox(b/h,f/h),sensorsDef={},sensorsDef.bottom=Box2DUtils.makeSensorDef((b-1)/h,2/h,0,
f/h),sensorsDef.top=Box2DUtils.makeSensorDef((b-1)/h,2/h,0,-f/h),sensorsDef.right=Box2DUtils.makeSensorDef(2/h,(f-1)/h,b/h,0),sensorsDef.left=Box2DUtils.makeSensorDef(2/h,(f-1)/h,-b/h,0);else if(d==Box2DUtils.CIRCLE)j.shape=new Box2D.Collision.Shapes.b2CircleShape(2*b/h);else throw Error("Cannot resolve shape-type: "+d);a.bxd.fixDef=j;a.bxd.sensors={bottom:0,top:0,right:0,left:0};a.bxd.sensorsDef=sensorsDef;d=new Box2D.Dynamics.b2BodyDef;d.type=!g?Box2D.Dynamics.b2Body.b2_staticBody:Box2D.Dynamics.b2Body.b2_dynamicBody;
a.bxd.bodyDef=d;a.onTick&&(a.__onTick=a.onTick);a.onTick=function(c){this.__onTick&&this.__onTick(c);this.bxd.body&&(c=this.bxd.body.GetPosition(),this.x=c.x*h,this.y=c.y*h,this.rotation=180*(this.bxd.body.GetAngle()/Math.PI))}},makeSensorDef:function(a,d,b,f){var c=new Box2D.Dynamics.b2FixtureDef;c.isSensor=!0;var k=new Box2D.Collision.Shapes.b2PolygonShape;k.SetAsOrientedBox(a,d,new Box2D.Common.Math.b2Vec2(b,f),0);c.shape=k;return c}};l.Box2DUtils=Box2DUtils})(boxledjs);
Object.equals=function(l,a){if(l===a)return!0;if(!(l instanceof Object)||!(a instanceof Object)||l.constructor!==a.constructor)return!1;for(var d in l)if(l.hasOwnProperty(d)&&(!a.hasOwnProperty(d)||l[d]!==a[d]&&("object"!==typeof l[d]||!Object.equals(l[d],a[d]))))return!1;for(d in a)if(a.hasOwnProperty(d)&&!l.hasOwnProperty(d))return!1;return!0};var Box2D=Box2D||{};Box2D.Ext=Box2D.Ext||{};
(function(l){function a(f,c,b,d,a,h){var j;if(j=(b+0.1>=f&&f>=a-0.1||b-0.1<=f&&f<=a+0.1)&&(d+0.1>=c&&c>=h-0.1||d-0.1<=c&&c<=h+0.1))0.1<a-b||0.1<b-a?(f=(h-d)/(a-b)*(f-b)+d,j=0.1>(f>c?f-c:c-f)):j=0.1>f-b||0.1>b-f;return j}function d(b,c,d,a){return 0.1>(d>=b?d-b:b-d)&&0.1>(a>=c?a-c:c-a)}function b(){throw Error("A problem has occurred. Use the Validate() method to see where the problem is.");}l.b2Separator={Separate:function(f,c,k,e){e=e||32;var g,h=k.length,j,l,t=[];for(g=0;g<h;g++)t.push(new Box2D.Common.Math.b2Vec2(k[g].x/
e,k[g].y/e));var m,q,n,r,y,w,A,x,s,p,u,v,z,D;e=[];k=[];for(k.push(t);k.length;){g=k[0];h=g.length;D=!0;for(m=0;m<h;m++)if(t=m,A=m<h-1?m+1:m+1-h,n=m<h-2?m+2:m+2-h,x=g[t],s=g[A],n=g[n],n=x.x*s.y+s.x*n.y+n.x*x.y-x.y*s.x-s.y*n.x-n.y*x.x,0>n){D=!1;w=Number.MAX_VALUE;for(q=0;q<h;q++)if(q!=t&&q!=A){m=q;n=q<h-1?q+1:0;p=g[m];u=g[n];r=x.x;y=x.y;var F=s.x,G=s.y;v=p.x;p=p.y;var H=u.x;u=u.y;var B=F-r,C=G-y,I=H-v,J=u-p,E=void 0,E=(I*(p-y)-J*(v-r))/(C*I-B*J),B=r+E*B,C=y+E*C;r=a(F,G,r,y,B,C);v=a(B,C,v,p,H,u);if(v=
r&&v?new Box2D.Common.Math.b2Vec2(B,C):null)r=s.x-v.x,y=s.y-v.y,r=r*r+y*y,r<w&&(l=m,j=n,z=v,w=r)}w==Number.MAX_VALUE&&b();q=[];w=[];m=l;n=j;p=g[m];u=g[n];d(z.x,z.y,u.x,u.y)||q.push(z);d(z.x,z.y,p.x,p.y)||w.push(z);l=-1;for(j=t;;){if(j!=n)q.push(g[j]);else{(0>l||l>=h)&&b();a(u.x,u.y,g[l].x,g[l].y,x.x,x.y)||q.push(g[j]);break}l=j;0>j-1?j=h-1:j--}q=q.reverse();l=-1;for(j=A;;){if(j!=m)w.push(g[j]);else{(0>l||l>=h)&&b();j==m&&!a(p.x,p.y,g[l].x,g[l].y,s.x,s.y)&&w.push(g[j]);break}l=j;j+1>h-1?j=0:j++}k.push(q,
w);k.shift();break}D&&e.push(k.shift())}h=e.length;for(g=0;g<h;g++){k=[];t=e[g];l=t.length;for(j=0;j<l;j++)k.push(new Box2D.Common.Math.b2Vec2(t[j].x,t[j].y));j=new Box2D.Collision.Shapes.b2PolygonShape;j.SetAsArray(k);c.shape=j;f.CreateFixture(c)}},Validate:function(b){var c,d=b.length,e,g,h,j,l,t=0,m,q=!1;for(c=0;c<d;c++){h=c<d-1?c+1:0;j=0<c?c-1:d-1;m=!1;for(e=0;e<d;e++)if(e!=c&&e!=h&&(m||(l=b[c].x*b[h].y+b[h].x*b[e].y+b[e].x*b[c].y-b[c].y*b[h].x-b[h].y*b[e].x-b[e].y*b[c].x,0<l&&(m=!0)),e!=j)){g=
e<d-1?e+1:0;var n=b[c].x,r=b[c].y,y=b[h].x,w=b[h].y;l=b[e].x;var A=b[e].y,x=b[g].x;g=b[g].y;var s=y-n,p=w-r,u=x-l,v=g-A,z=void 0,z=(u*(A-r)-v*(l-n))/(p*u-s*v),s=n+z*s,p=r+z*p,n=a(s,p,n,r,y,w);l=a(s,p,l,A,x,g);l=n&&l?new Box2D.Common.Math.b2Vec2(s,p):null;l&&(t=1)}m||(q=!0)}q&&(t=1==t?3:2);return t}}})(Box2D.Ext);boxledjs=boxledjs||{};
(function(l){function a(){}a.prototype=new Box2D.Dynamics.b2ContactListener;var d=a.prototype;d.BeginContact=function(b){var d=b.GetFixtureA(),c=b.GetFixtureB();this.__BeginContactOrdered(d,c,b);this.__BeginContactOrdered(c,d,b)};d.__BeginContactOrdered=function(b,d,c){var a=b.GetBody().GetUserData(),e=d.GetBody().GetUserData();a&&a.objectData&&(a=objectData);e&&e.objectData&&(e=objectData);this.__applyForceField(b,d,a,e,1,1,c);this.__applyImpulse(b,d,a,e,c);this.__handleCustomEvents(b,d,a,e,c,"beginContact")};
d.EndContact=function(b){var d=b.GetFixtureA();b=b.GetFixtureB();this.__EndContactOrdered(d,b);this.__EndContactOrdered(b,d)};d.__EndContactOrdered=function(b,d,c){var a=b.GetBody().GetUserData(),e=d.GetBody().GetUserData();a&&a.objectData&&(a=objectData);e&&e.objectData&&(e=objectData);this.__applyForceField(b,d,a,e,-1,0,c);this.__handleCustomEvents(b,d,a,e,c,"endContact")};d.__applyForceField=function(b,d,c,a,e,g){if(c&&c.properties&&(c.properties.forceX||c.properties.forceY))if((c.properties.forceX||
c.properties.forceY)&&!d.IsSensor()){a=parseFloat(c.properties.forceX)||0;var h=parseFloat(c.properties.forceY)||0,j=d.GetBody();j.o_fieldForceX=j.o_fieldForceX+a*e||a*(g||0);j.o_fieldForceY=j.o_fieldForceY+h*e||h*(g||0)}if(c&&c.properties&&(c.properties.force||void 0!=c.properties.gravityFactor)&&!d.IsSensor())j=d.GetBody(),j.o_dynamicForceFields=j.o_dynamicForceFields||[],1==e?j.o_dynamicForceFields.push(b.GetBody()):j.o_dynamicForceFields.splice(j.o_dynamicForceFields.indexOf(b.GetBody()),1)};
d.__applyImpulse=function(b,d,c,a,e){if(c&&c.properties&&(c.properties.impulseX||c.properties.impulseY||c.properties.impulse)){if((c.properties.impulseX||c.properties.impulseY)&&!d.IsSensor()){a=parseFloat(c.properties.impulseX)||0;var g=parseFloat(c.properties.impulseY)||0,h=d.GetBody();h.ApplyImpulse(new Box2D.Common.Math.b2Vec2(a||0,g||0),h.GetWorldCenter())}c.properties.impulse&&!d.IsSensor()&&(c=parseFloat(c.properties.impulse)||0,b=b.GetBody(),d=d.GetBody(),a=new Box2D.Common.Math.b2Vec2(d.GetWorldCenter().x,
d.GetWorldCenter().y),a.Subtract(b.GetWorldCenter()),a.Normalize(),a.Multiply(c),d.ApplyImpulse(a,d.GetWorldPoint(e.GetManifold().m_localPoint)))}};d.__handleCustomEvents=function(b,d,c,a,e,g){c&&(c.properties&&c.properties.event)&&(b={type:c.properties.event,detail:{status:g,targetFixture:b,triggeringFixture:d}},c.eventsToDispatch=c.eventsToDispatch||[],c.eventsToDispatch.push(b))};d.PreSolve=function(){};l.BoxledJSContactListener=a})(boxledjs);boxledjs=boxledjs||{};
(function(l){function a(){}a.prototype=new boxledjs.BoxledJSContactListener;var d=a.prototype;d.super_BeginContact=d.BeginContact;d.BeginContact=function(b){this.super_BeginContact(b);this.__HandleContact(b,1)};d.super_EndContact=d.EndContact;d.EndContact=function(b){this.super_EndContact(b);this.__HandleContact(b,-1)};d.__HandleContact=function(b,d){var c=b.GetFixtureA(),a=b.GetFixtureB(),e=c.IsSensor()?c:a.IsSensor()?a:null;if(e&&(c=c!=e?c:a,(a=c.GetBody().GetUserData())&&a.objectData&&(a=objectData),
e.GetUserData()&&e.GetUserData().sensorPosition)){var g=e.GetUserData().sensorPosition;a&&a.properties&&a.properties.noBottomCollision&&("left"==g||"right"==g)||c.IsSensor()||(obj=e.GetBody().GetUserData())&&(obj.bxd&&obj.bxd.sensors)&&(obj.bxd.sensors[g]+=d)}};d.super_PreSolve=d.PreSolve;d.PreSolve=function(b,d){this.super_PreSolve(b,d);var c=b.GetFixtureA(),a=b.GetFixtureB(),e,g,h;e=c.GetBody().GetUserData();g=a.GetBody().GetUserData();e&&e.objectData&&(e=objectData);g&&g.objectData&&(g=objectData);
if(e&&e.properties&&e.properties.noBottomCollision||g&&g.properties&&g.properties.noBottomCollision)c.GetBody().GetDefinition().type==Box2D.Dynamics.b2Body.b2_staticBody?(g=a.GetBody().m_linearVelocity.y,h=a.GetBody().m_invMass,e=a.GetAABB(),c=c.GetAABB()):(g=c.GetBody().m_linearVelocity.y,h=c.GetBody().m_invMass,e=c.GetAABB(),c=a.GetAABB()),a=Math.abs(c.lowerBound.y-c.upperBound.y),g=g*h/Box2D.Dynamics.b2World.s_timestep2.velocityIterations,(e.upperBound.y-g>c.upperBound.y&&e.upperBound.y>c.upperBound.y||
e.upperBound.y-g>c.lowerBound.y+a/25&&e.upperBound.y>c.lowerBound.y+a/25)&&b.SetEnabled(!1)};l.PlatformerContactListener=a})(boxledjs);boxledjs=boxledjs||{};
(function(l){function a(d,b){this.initialize(d,b)}a.prototype=new createjs.Container;a.prototype.Container_init=a.prototype.initialize;a.prototype.initialize=function(d,b){this.Container_init();this.data=d;this.properties=d.properties;this.objects={};this.map=b;this.reset()};a.prototype.reset=function(){this.initObjects()};a.prototype.initObjects=function(){var d,b,a,c;d=0;for(b=this.data.objects.length;d<b;d++){a=this.data.objects[d];c=a.type&&""!=a.type?this.makeObjectFromData(a):boxledjs.Box2DUtils.makeB2DBodyFromData(a,
this.map.b2dWorld);try{c.isVisible&&this.addChild(c)}catch(k){}try{if(c.bxd){var e=this.map.b2dWorld.CreateBody(c.bxd.bodyDef);e.CreateFixture(c.bxd.fixDef);e.CreateFixture(c.bxd.sensorsDef.bottom).SetUserData({sensorPosition:"bottom"});e.CreateFixture(c.bxd.sensorsDef.top).SetUserData({sensorPosition:"top"});e.CreateFixture(c.bxd.sensorsDef.right).SetUserData({sensorPosition:"right"});e.CreateFixture(c.bxd.sensorsDef.left).SetUserData({sensorPosition:"left"});e.SetPositionAndAngle(new Box2D.Common.Math.b2Vec2(c.x/
boxledjs.Const.scale,c.y/boxledjs.Const.scale),c.rotation*Math.PI/180);c.bxd.sensorsDef=void 0;c.bxd.body=e;e.SetUserData(c);if(c.bxd.onBodyCreated)c.bxd.onBodyCreated(e)}}catch(g){console.log(a.name)}a.name&&""!=a.name&&(this.objects[a.name]=c,this.map.objects[a.name]=c)}};a.prototype.makeObjectFromData=function(d){var b,a,c,k=d.properties;b=boxledjs.Utils.getDefinitionByName(d.type||k.classDefinition);k.parameter&&""!=k.parameter&&(a=JSON.parse(k.parameter),"object"==typeof a&&(c=boxledjs.Utils.applyConstruct(b,
a)));c=c||new b;for(var e in k)"classDefinition"!=e&&"parameter"!=e&&(c[e]=k[e]);c.x=d.x;c.y=d.y;c.rotation=d.rotation;return c};l.ObjectLayer=a})(boxledjs);boxledjs=boxledjs||{};
(function(l){function a(d,b){this.initialize(d,b)}a.prototype=new createjs.Container;a.prototype.Container_init=a.prototype.initialize;a.prototype.initialize=function(d,b){this.Container_init();this.data=d;this.properties=d.properties;this.map=b;this.reset()};a.prototype.reset=function(){this.x=this.data.x;this.y=this.data.y;this.visible=this.data.visible;this.numTilesX=this.data.width;this.numTilesY=this.data.height;if(this.isCollisionLayer=this.properties&&this.properties.collisionLayer&&"false"!=
this.properties.collisionLayer)this.colTilesToCheck=[],this.colTileGroups=[];this.drawTiles();this.cache(0,0,this.map.data.tilewidth*this.numTilesX,this.map.data.tileheight*this.numTilesY);this.isCollisionLayer&&this.calculateCollisionShapes()};a.prototype.drawTiles=function(){var d=this.data.data,b,a,c,k,e,g;for(a=0;a<this.numTilesY;a++)for(b=0;b<this.numTilesX;b++)c=a*this.numTilesX+b,k=d[c],0!=k&&(e=this.map.getTileById(k),g=new createjs.Bitmap(e.image),g.sourceRect=e.rect,g.x=b*this.map.data.tilewidth,
g.y=a*this.map.data.tileheight,this.addChild(g)),this.isCollisionLayer&&(this.colTilesToCheck[c]=k)};a.prototype.calculateCollisionShapes=function(){var d,b,a,c,k=this.map.data.tilewidth,e=this.map.data.tileheight;for(a=0;a<this.numTilesY;a++)for(b=0;b<this.numTilesX;b++)d=a*this.numTilesX+b,d=this.colTilesToCheck[d],void 0!=d&&0!=d&&(this.colTileGroups.push({tiles:[]}),this.findNextCollisionShapeTile(b,a));d=0;for(c=this.colTileGroups.length;d<c;d++){var g=this.colTileGroups[d],h=g.tiles;b=h[0].x;
a=h[0].y;h=h[h.length-1].x-b+1;g=this.map.getTileProperties(g.tileid)||{};boxledjs.Box2DUtils.makeB2DBodyFromData({x:b*k,y:a*e,width:h*k,height:1*e,properties:g},this.map.b2dWorld)}};a.prototype.findNextCollisionShapeTile=function(a,b){a=a||0;b=b||0;var f,c,k;f=b*this.numTilesX+a;c=this.colTilesToCheck[f];void 0!=c&&0!=c&&(k=this.colTileGroups[this.colTileGroups.length-1],k.tileid=k.tileid||c,Object.equals(this.map.getTileProperties(c),this.map.getTileProperties(k.tileid))&&(k.tiles.push({x:a,y:b,
tileid:c}),this.colTilesToCheck[f]=void 0,this.findNextCollisionShapeTile(a+1,b)))};l.TileLayer=a})(boxledjs);boxledjs=boxledjs||{};boxledjs.Const={};boxledjs.Const.scale=32;
(function(l){function a(a,b){this.initialize(a,b)}a.prototype=new createjs.Container;a.prototype.Container_init=a.prototype.initialize;a.prototype.initialize=function(a,b){this.Container_init();this.b2dWorld=b;this.data=a;this.reset()};a.prototype.reset=function(){this.viewPort={};this.layers={};this.objects={};if(!this.b2dWorld){boxledjs.Const.scale=parseFloat(this.data.properties.box2dScale)||boxledjs.Const.scale;this.b2dWorld=new Box2D.Dynamics.b2World(new Box2D.Common.Math.b2Vec2(parseFloat(this.data.properties.forceX)||0,
parseFloat(this.data.properties.forceY)||20),!0);var a=new boxledjs.PlatformerContactListener;this.b2dWorld.SetContactListener(a)}this.firstTick=!1;this.generateTileSets();this.setupLayers()};a.prototype.onTick=function(){!this._firstTick&&this._onFirstTick();this.centerObject&&this.centerTo(this.centerObject)};a.prototype._onFirstTick=function(){var a=boxledjs.Utils.getStage(this).canvas;void 0==this.viewPort.width&&(this.viewPort.width=a.width);void 0==this.viewPort.height&&(this.viewPort.height=
a.height);!this.b2dDebugDraw&&this.setupDebugDraw(a);this._firstTick=!0};a.prototype.setupDebugDraw=function(a){this.b2dDebugDraw=new Box2D.Dynamics.b2DebugDraw;this.b2dDebugDraw.SetSprite(a.getContext("2d"));this.b2dDebugDraw.SetDrawScale(boxledjs.Const.scale);this.b2dDebugDraw.SetFillAlpha(0.35);this.b2dDebugDraw.SetFlags(Box2D.Dynamics.b2DebugDraw.e_shapeBit|Box2D.Dynamics.b2DebugDraw.e_jointBit);this.b2dWorld.SetDebugDraw(this.b2dDebugDraw);return this.b2dDebugDraw};a.prototype.update=function(a){for(var b=
this.b2dWorld.GetBodyList();b;){var f=b.GetUserData(),c=f?f.properties:{};if(f&&f.eventsToDispatch)for(;f.eventsToDispatch.length;){var k=f.eventsToDispatch.pop();this.dispatchEvent(k)}if(!c||!0!=c.ignoreForces){if(b.o_fieldForceX||b.o_fieldForceY)b.ApplyForce(new Box2D.Common.Math.b2Vec2((b.o_fieldForceX||0)*b.GetMass(),(b.o_fieldForceY||0)*b.GetMass()),b.GetWorldCenter());if(b.o_dynamicForceFields&&b.o_dynamicForceFields.length){for(var f=[],e,c=0,k=b.o_dynamicForceFields.length;c<k;c++){var g=
b.o_dynamicForceFields[c],h=parseFloat(g.GetUserData().properties.force)||0,j=new Box2D.Common.Math.b2Vec2(b.GetWorldCenter().x,b.GetWorldCenter().y);j.Subtract(g.GetWorldCenter());j.Normalize();j.Multiply(h);j.Multiply(b.GetMass());!isNaN(j.x)&&!isNaN(j.y)&&b.ApplyForce(j,b.GetWorldCenter());void 0!=g.GetUserData().properties.gravityFactor&&f.push(parseFloat(g.GetUserData().properties.gravityFactor))}c=0;for(k=f.length;c<k;c++)e=e+f[c]||f[c];isNaN(e)||(c=this.b2dWorld.GetGravity().GetNegative(),
c.Multiply(1-e/f.length),c.Multiply(b.GetMass()),b.ApplyForce(c,b.GetWorldCenter()))}}b=b.GetNext()}this.b2dWorld.Step((a||30)/1E3,10,10);this.b2dWorld.ClearForces()};a.prototype.drawDebugData=function(a){a=a||1;this.b2dDebugDraw.SetFillAlpha(0.35*a);this.b2dDebugDraw.SetAlpha(1*a);this.b2dDebugDraw.GetSprite().save();this.b2dDebugDraw.GetSprite().scale(this.scaleX,this.scaleY);this.b2dDebugDraw.GetSprite().translate(-this.regX+this.x/this.scaleX,-this.regY+this.y/this.scaleY);this.b2dWorld.DrawDebugData();
this.b2dDebugDraw.GetSprite().restore()};a.prototype.setupLayers=function(){var a,b,f,c;a=0;for(b=this.data.layers.length;a<b;a++)f=this.data.layers[a],"tilelayer"==f.type?(c=new boxledjs.TileLayer(f,this),this.addChild(c)):"objectgroup"==f.type&&(c=new boxledjs.ObjectLayer(f,this),this.addChild(c)),f.name&&""!=f.name&&(this.layers[f.name]=c)};a.prototype.centerTo=function(a){"string"==typeof a&&(a=this.objects[a]);if(a&&void 0!=a){var b,f;a.GetPosition?(f=a.GetPosition(),b=f.x*boxledjs.Const.scale,
f=f.y*boxledjs.Const.scale):void 0!=a.x&&void 0!=a.y&&(b=a.x,f=a.y);if(!(void 0==b||void 0==f)){a=this.viewPort.width||0;var c=this.viewPort.height||0;this.regX=b;this.regY=f;this.x=a/2;this.y=c/2}}};a.prototype.generateTileSets=function(){this.tilesets=[];this.tileproperties={};for(var d=0,b=this.data.tilesets.length;d<b;d++){var f=a.convertTileSetToSpriteSheet(this.data.tilesets[d]);this.tilesets.push(f);for(var c in f.tileproperties)this.tileproperties[c]=f.tileproperties[c]}};a.prototype.getTileById=
function(a){a-=1;return this.getSpriteSheetByTileId(a).getFrame(a)};a.prototype.getSpriteSheetByTileId=function(a){a=a||1;var b=this.tilesets,f,c,k,e;f=0;for(c=b.length;f<c;f++)k=b[f],k.firstgid<=a&&0<k.firstgid&&(e=k);return e};a.prototype.getTileProperties=function(a){return this.tileproperties[a-1]};a.convertTileSetToSpriteSheet=function(a){var b={};b.images=[a.image];b.frames={width:a.tilewidth,height:a.tileheight};b=new createjs.SpriteSheet(b);b.firstgid=a.firstgid;b.tileproperties=a.tileproperties;
return b};l.Map=a})(boxledjs);
