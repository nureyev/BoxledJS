var astar={init:function(c){for(var b=0,a=c.length;b<a;b++)for(var g=0,e=c[b].length;g<e;g++){var d=c[b][g];d.f=0;d.g=0;d.h=0;d.cost=d.type;d.visited=!1;d.closed=!1;d.parent=null}},heap:function(){return new BinaryHeap(function(c){return c.f})},search:function(c,b,a,g,e){astar.init(c);e=e||astar.manhattan;g=!!g;var d=astar.heap();for(d.push(b);0<d.size();){b=d.pop();if(b===a){c=b;for(a=[];c.parent;)a.push(c),c=c.parent;return a.reverse()}b.closed=!0;for(var f=astar.neighbors(c,b,g),l=0,h=f.length;l<
h;l++){var k=f[l];if(!k.closed&&!k.isWall()){var j=b.g+k.cost,m=k.visited;if(!m||j<k.g)k.visited=!0,k.parent=b,k.h=k.h||e(k.pos,a.pos),k.g=j,k.f=k.g+k.h,m?d.rescoreElement(k):d.push(k)}}}return[]},manhattan:function(c,b){var a=Math.abs(b.x-c.x),g=Math.abs(b.y-c.y);return a+g},neighbors:function(c,b,a){var g=[],e=b.x;b=b.y;c[e-1]&&c[e-1][b]&&g.push(c[e-1][b]);c[e+1]&&c[e+1][b]&&g.push(c[e+1][b]);c[e]&&c[e][b-1]&&g.push(c[e][b-1]);c[e]&&c[e][b+1]&&g.push(c[e][b+1]);a&&(c[e-1]&&c[e-1][b-1]&&g.push(c[e-
1][b-1]),c[e+1]&&c[e+1][b-1]&&g.push(c[e+1][b-1]),c[e-1]&&c[e-1][b+1]&&g.push(c[e-1][b+1]),c[e+1]&&c[e+1][b+1]&&g.push(c[e+1][b+1]));return g}};var GraphNodeType={OPEN:1,WALL:0};function Graph(c){for(var b=[],a=0;a<c.length;a++){b[a]=[];for(var g=0,e=c[a];g<e.length;g++)b[a][g]=new GraphNode(a,g,e[g])}this.input=c;this.nodes=b}Graph.prototype.toString=function(){for(var c="\n",b=this.nodes,a,g,e,d,f=0,l=b.length;f<l;f++){a="";g=b[f];e=0;for(d=g.length;e<d;e++)a+=g[e].type+" ";c=c+a+"\n"}return c};function GraphNode(c,b,a){this.data={};this.x=c;this.y=b;this.pos={x:c,y:b};this.type=a}
GraphNode.prototype.toString=function(){return"["+this.x+" "+this.y+"]"};GraphNode.prototype.isWall=function(){return this.type==GraphNodeType.WALL};function BinaryHeap(c){this.content=[];this.scoreFunction=c}
BinaryHeap.prototype={push:function(c){this.content.push(c);this.sinkDown(this.content.length-1)},pop:function(){var c=this.content[0],b=this.content.pop();0<this.content.length&&(this.content[0]=b,this.bubbleUp(0));return c},remove:function(c){var b=this.content.indexOf(c),a=this.content.pop();b!==this.content.length-1&&(this.content[b]=a,this.scoreFunction(a)<this.scoreFunction(c)?this.sinkDown(b):this.bubbleUp(b))},size:function(){return this.content.length},rescoreElement:function(c){this.sinkDown(this.content.indexOf(c))},
sinkDown:function(c){for(var b=this.content[c];0<c;){var a=(c+1>>1)-1,g=this.content[a];if(this.scoreFunction(b)<this.scoreFunction(g))this.content[a]=b,this.content[c]=g,c=a;else break}},bubbleUp:function(c){for(var b=this.content.length,a=this.content[c],g=this.scoreFunction(a);;){var e=c+1<<1,d=e-1,f=null;if(d<b){var l=this.scoreFunction(this.content[d]);l<g&&(f=d)}if(e<b&&this.scoreFunction(this.content[e])<(null===f?g:l))f=e;if(null!==f)this.content[c]=this.content[f],this.content[f]=a,c=f;else break}}};var boxledjs=boxledjs||{};
(function(c){Utils={getScreenWidth:function(){if("number"==typeof window.innerWidth)return window.innerWidth;if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight))return document.documentElement.clientWidth;if(document.body&&(document.body.clientWidth||document.body.clientHeight))return document.body.clientWidth},getScreenHeight:function(){if("number"==typeof window.innerWidth)return window.innerHeight;if(document.documentElement&&(document.documentElement.clientWidth||
document.documentElement.clientHeight))return document.documentElement.clientHeight;if(document.body&&(document.body.clientHeight||document.body.clientHeight))return document.body.clientHeight},getStage:function(b){return b.canvas?b:b.parent?b.parent.canvas?b.parent:c.getStage(b.parent):null},getDefinitionByName:function(b,a,g){a=a||window;g=g||b;b=b.split(".");var e=b.shift();if(a=a[e])return b.length?c.getDefinitionByName(b.join("."),a,g):a;throw Error("Could not find '"+e+"' of '"+g+"'");},applyConstruct:function(b,
a){function g(){function a(){}a.prototype=b.prototype;return new a}var e,d;"function"===typeof Object.create?e=Object.create(b.prototype):{}.__proto__?(e={},e.__proto__=b.prototype,e.__proto__!==b.prototype&&(e=g())):e=g();e.constructor=b;d=b.apply(e,a);"object"===typeof d&&(e=d);return e}};c.Utils=Utils})(boxledjs);boxledjs=boxledjs||{};
(function(c){function b(a,g){a=a.split(",");return{x:parseFloat(a[0])*g.width,y:parseFloat(a[1])*g.height}}Box2DUtils={RECT:"rect",CIRCLE:"circle",makeB2DBodyFromData:function(a,g){boxledjs.Const.scale=boxledjs.Const.scale||32;var e=a.properties,d=new Box2D.Dynamics.b2FixtureDef;d.density=void 0==e.density?1:parseFloat(e.density);d.friction=void 0==e.friction?0.5:parseFloat(e.friction);d.restitution=void 0==e.restitution?0.05:parseFloat(e.restitution);d.isSensor=!Box2DUtils.isTileCollideable(e);var f=
new Box2D.Dynamics.b2BodyDef;f.type=e.dynamic?Box2D.Dynamics.b2Body.b2_dynamicBody:Box2D.Dynamics.b2Body.b2_staticBody;var f=g.CreateBody(f),l=a.width/boxledjs.Const.scale/2,h=a.height/boxledjs.Const.scale/2;if(e.topLeft||e.topRight||e.bottomRight||e.bottomLeft)a.polygon=[],"none"!=e.topLeft&&a.polygon.push(b(e.topLeft||"0,0",a)),"none"!=e.topRight&&a.polygon.push(b(e.topRight||"1,0",a)),"none"!=e.bottomRight&&a.polygon.push(b(e.bottomRight||"1,1",a)),"none"!=e.bottomLeft&&a.polygon.push(b(e.bottomLeft||
"0,1",a));if(!0==a.ellipse)d.shape=new Box2D.Collision.Shapes.b2CircleShape(l),f.CreateFixture(d),a.x+=a.width/2,a.y+=a.height/2;else if(a.polygon&&1<a.polygon.length)Box2D.Ext.b2Separator.Separate(f,d,a.polygon,boxledjs.Const.scale);else if(a.polyline&&1<a.polyline.length)for(var c,l=0,h=a.polyline.length;l<h-1;l++)d.shape=new Box2D.Collision.Shapes.b2PolygonShape,c=a.polyline[l],e=new Box2D.Common.Math.b2Vec2(c.x/boxledjs.Const.scale,c.y/boxledjs.Const.scale),c=a.polyline[l+1],c=new Box2D.Common.Math.b2Vec2(c.x/
boxledjs.Const.scale,c.y/boxledjs.Const.scale),d.shape.SetAsEdge(e,c),f.CreateFixture(d);else d.shape=new Box2D.Collision.Shapes.b2PolygonShape,d.shape.SetAsBox(l,h),f.CreateFixture(d),a.x+=a.width/2,a.y+=a.height/2;f.SetPositionAndAngle(new Box2D.Common.Math.b2Vec2(a.x/boxledjs.Const.scale,a.y/boxledjs.Const.scale),(a.rotation||0)*Math.PI/180);f.SetUserData(a);return f},isTileCollideable:function(a,g){return 0!=g&&(!a||!(a.isSensor&&"false"!=a.isSensor||a.noCollision&&"false"!=a.noCollision||a.force||
a.forceX||a.forceY||void 0!=a.gravityFactor))},injectBox2d:function(a,g,e,d,f,b,h,c){void 0==c&&(c=!0);var j=boxledjs.Const.scale=boxledjs.Const.scale||32;a.bxd={};e*=0.5;d*=0.5;var m=new Box2D.Dynamics.b2FixtureDef;m.density=void 0==f?1:f;m.friction=void 0==b?0.5:b;m.restitution=void 0==h?0.05:h;if(g==Box2DUtils.RECT)m.shape=new Box2D.Collision.Shapes.b2PolygonShape,m.shape.SetAsBox(e/j,d/j),sensorsDef={},sensorsDef.bottom=Box2DUtils.makeSensorDef((e+2)/j,2/j,0,d/j),sensorsDef.top=Box2DUtils.makeSensorDef((e+
2)/j,2/j,0,-d/j),sensorsDef.right=Box2DUtils.makeSensorDef(2/j,(d-1)/j,e/j,0),sensorsDef.left=Box2DUtils.makeSensorDef(2/j,(d-1)/j,-e/j,0);else if(g==Box2DUtils.CIRCLE)m.shape=new Box2D.Collision.Shapes.b2CircleShape(2*e/j);else throw Error("Cannot resolve shape-type: "+g);a.bxd.fixDef=m;a.bxd.sensors={bottom:0,top:0,right:0,left:0};a.bxd.sensorsDef=sensorsDef;g=new Box2D.Dynamics.b2BodyDef;g.type=!c?Box2D.Dynamics.b2Body.b2_staticBody:Box2D.Dynamics.b2Body.b2_dynamicBody;a.bxd.bodyDef=g;a.onTick&&
(a.__onTick=a.onTick);a.onTick=function(a){this.__onTick&&this.__onTick(a);this.bxd.body&&(a=this.bxd.body.GetPosition(),this.x=a.x*j,this.y=a.y*j,this.rotation=180*(this.bxd.body.GetAngle()/Math.PI))}},makeSensorDef:function(a,g,e,d){var f=new Box2D.Dynamics.b2FixtureDef;f.isSensor=!0;var b=new Box2D.Collision.Shapes.b2PolygonShape;b.SetAsOrientedBox(a,g,new Box2D.Common.Math.b2Vec2(e,d),0);f.shape=b;return f}};c.Box2DUtils=Box2DUtils})(boxledjs);
Object.equals=function(c,b){if(c===b)return!0;if(!(c instanceof Object)||!(b instanceof Object)||c.constructor!==b.constructor)return!1;for(var a in c)if(c.hasOwnProperty(a)&&(!b.hasOwnProperty(a)||c[a]!==b[a]&&("object"!==typeof c[a]||!Object.equals(c[a],b[a]))))return!1;for(a in b)if(b.hasOwnProperty(a)&&!c.hasOwnProperty(a))return!1;return!0};var Box2D=Box2D||{};Box2D.Ext=Box2D.Ext||{};
(function(c){function b(a,d,g,b,c,k){var j;if(j=(g+0.1>=a&&a>=c-0.1||g-0.1<=a&&a<=c+0.1)&&(b+0.1>=d&&d>=k-0.1||b-0.1<=d&&d<=k+0.1))0.1<c-g||0.1<g-c?(a=(k-b)/(c-g)*(a-g)+b,j=0.1>(a>d?a-d:d-a)):j=0.1>a-g||0.1>g-a;return j}function a(a,d,g,b){return 0.1>(g>=a?g-a:a-g)&&0.1>(b>=d?b-d:d-b)}function g(){throw Error("A problem has occurred. Use the Validate() method to see where the problem is.");}c.b2Separator={Separate:function(e,d,f,l){l=l||32;var c,k=f.length,j,m,q=[];for(c=0;c<k;c++)q.push(new Box2D.Common.Math.b2Vec2(f[c].x/
l,f[c].y/l));var n,s,p,t,z,x,B,y,u,r,v,w,A,E;l=[];f=[];for(f.push(q);f.length;){c=f[0];k=c.length;E=!0;for(n=0;n<k;n++)if(q=n,B=n<k-1?n+1:n+1-k,p=n<k-2?n+2:n+2-k,y=c[q],u=c[B],p=c[p],p=y.x*u.y+u.x*p.y+p.x*y.y-y.y*u.x-u.y*p.x-p.y*y.x,0>p){E=!1;x=Number.MAX_VALUE;for(s=0;s<k;s++)if(s!=q&&s!=B){n=s;p=s<k-1?s+1:0;r=c[n];v=c[p];t=y.x;z=y.y;var G=u.x,H=u.y;w=r.x;r=r.y;var I=v.x;v=v.y;var C=G-t,D=H-z,J=I-w,K=v-r,F=void 0,F=(J*(r-z)-K*(w-t))/(D*J-C*K),C=t+F*C,D=z+F*D;t=b(G,H,t,z,C,D);w=b(C,D,w,r,I,v);if(w=
t&&w?new Box2D.Common.Math.b2Vec2(C,D):null)t=u.x-w.x,z=u.y-w.y,t=t*t+z*z,t<x&&(m=n,j=p,A=w,x=t)}x==Number.MAX_VALUE&&g();s=[];x=[];n=m;p=j;r=c[n];v=c[p];a(A.x,A.y,v.x,v.y)||s.push(A);a(A.x,A.y,r.x,r.y)||x.push(A);m=-1;for(j=q;;){if(j!=p)s.push(c[j]);else{(0>m||m>=k)&&g();b(v.x,v.y,c[m].x,c[m].y,y.x,y.y)||s.push(c[j]);break}m=j;0>j-1?j=k-1:j--}s=s.reverse();m=-1;for(j=B;;){if(j!=n)x.push(c[j]);else{(0>m||m>=k)&&g();j==n&&!b(r.x,r.y,c[m].x,c[m].y,u.x,u.y)&&x.push(c[j]);break}m=j;j+1>k-1?j=0:j++}f.push(s,
x);f.shift();break}E&&l.push(f.shift())}k=l.length;for(c=0;c<k;c++){f=[];q=l[c];m=q.length;for(j=0;j<m;j++)f.push(new Box2D.Common.Math.b2Vec2(q[j].x,q[j].y));j=new Box2D.Collision.Shapes.b2PolygonShape;j.SetAsArray(f);d.shape=j;e.CreateFixture(d)}},Validate:function(a){var d,g=a.length,c,h,k,j,m,q=0,n,s=!1;for(d=0;d<g;d++){k=d<g-1?d+1:0;j=0<d?d-1:g-1;n=!1;for(c=0;c<g;c++)if(c!=d&&c!=k&&(n||(m=a[d].x*a[k].y+a[k].x*a[c].y+a[c].x*a[d].y-a[d].y*a[k].x-a[k].y*a[c].x-a[c].y*a[d].x,0<m&&(n=!0)),c!=j)){h=
c<g-1?c+1:0;var p=a[d].x,t=a[d].y,z=a[k].x,x=a[k].y;m=a[c].x;var B=a[c].y,y=a[h].x;h=a[h].y;var u=z-p,r=x-t,v=y-m,w=h-B,A=void 0,A=(v*(B-t)-w*(m-p))/(r*v-u*w),u=p+A*u,r=t+A*r,p=b(u,r,p,t,z,x);m=b(u,r,m,B,y,h);m=p&&m?new Box2D.Common.Math.b2Vec2(u,r):null;m&&(q=1)}n||(s=!0)}s&&(q=1==q?3:2);return q}}})(Box2D.Ext);boxledjs=boxledjs||{};
(function(c){function b(){}b.prototype=new Box2D.Dynamics.b2ContactListener;var a=b.prototype;a.BeginContact=function(a){var e=a.GetFixtureA(),d=a.GetFixtureB();this.__BeginContactOrdered(e,d,a);this.__BeginContactOrdered(d,e,a)};a.__BeginContactOrdered=function(a,e,d){var b=a.GetBody().GetUserData(),c=e.GetBody().GetUserData();b&&b.objectData&&(b=objectData);c&&c.objectData&&(c=objectData);this.__applyForceField(a,e,b,c,1,1,d);this.__applyImpulse(a,e,b,c,d);this.__handleCustomEvents(a,e,b,c,d,"beginContact")};
a.EndContact=function(a){var e=a.GetFixtureA();a=a.GetFixtureB();this.__EndContactOrdered(e,a);this.__EndContactOrdered(a,e)};a.__EndContactOrdered=function(a,e,d){var b=a.GetBody().GetUserData(),c=e.GetBody().GetUserData();b&&b.objectData&&(b=objectData);c&&c.objectData&&(c=objectData);this.__applyForceField(a,e,b,c,-1,0,d);this.__handleCustomEvents(a,e,b,c,d,"endContact")};a.__applyForceField=function(a,e,d,b,c,h){if(d&&d.properties&&(d.properties.forceX||d.properties.forceY))if((d.properties.forceX||
d.properties.forceY)&&!e.IsSensor()){b=parseFloat(d.properties.forceX)||0;var k=parseFloat(d.properties.forceY)||0,j=e.GetBody();j.o_fieldForceX=j.o_fieldForceX+b*c||b*(h||0);j.o_fieldForceY=j.o_fieldForceY+k*c||k*(h||0)}if(d&&d.properties&&(d.properties.force||void 0!=d.properties.gravityFactor)&&!e.IsSensor())j=e.GetBody(),j.o_dynamicForceFields=j.o_dynamicForceFields||[],1==c?j.o_dynamicForceFields.push(a.GetBody()):j.o_dynamicForceFields.splice(j.o_dynamicForceFields.indexOf(a.GetBody()),1)};
a.__applyImpulse=function(a,e,d,b,c){if(d&&d.properties&&(d.properties.impulseX||d.properties.impulseY||d.properties.impulse)){if((d.properties.impulseX||d.properties.impulseY)&&!e.IsSensor()){b=parseFloat(d.properties.impulseX)||0;var h=parseFloat(d.properties.impulseY)||0,k=e.GetBody();k.ApplyImpulse(new Box2D.Common.Math.b2Vec2(b||0,h||0),k.GetWorldCenter())}d.properties.impulse&&!e.IsSensor()&&(d=parseFloat(d.properties.impulse)||0,a=a.GetBody(),e=e.GetBody(),b=new Box2D.Common.Math.b2Vec2(e.GetWorldCenter().x,
e.GetWorldCenter().y),b.Subtract(a.GetWorldCenter()),b.Normalize(),b.Multiply(d),e.ApplyImpulse(b,e.GetWorldPoint(c.GetManifold().m_localPoint)))}};a.__handleCustomEvents=function(a,e,d,b,c,h){d&&(d.properties&&d.properties.event)&&(a={type:d.properties.event,detail:{status:h,targetFixture:a,triggeringFixture:e}},d.eventsToDispatch=d.eventsToDispatch||[],d.eventsToDispatch.push(a))};a.PreSolve=function(){};c.BoxledJSContactListener=b})(boxledjs);boxledjs=boxledjs||{};
(function(c){function b(){}b.prototype=new boxledjs.BoxledJSContactListener;var a=b.prototype;a.super_BeginContact=a.BeginContact;a.BeginContact=function(a){this.super_BeginContact(a);this.__HandleContact(a,1)};a.super_EndContact=a.EndContact;a.EndContact=function(a){this.super_EndContact(a);this.__HandleContact(a,-1)};a.__HandleContact=function(a,e){var d=a.GetFixtureA(),b=a.GetFixtureB(),c=d.IsSensor()?d:b.IsSensor()?b:null;if(c){var d=d!=c?d:b,h=d.GetBody().GetUserData();h&&h.objectData&&(h=objectData);
if(c.GetUserData()&&c.GetUserData().sensorPosition&&(b=c.GetUserData().sensorPosition,!(h&&h.properties&&h.properties.noBottomCollision&&("left"==b||"right"==b)||d.IsSensor())))if((c=c.GetBody().GetUserData())&&(c.bxd&&c.bxd.sensors)&&(c.bxd.sensors[b]+=e),(d=d.GetBody().GetUserData())&&d.onContact)d.onContact(c)}};a.super_PreSolve=a.PreSolve;a.PreSolve=function(a,e){this.super_PreSolve(a,e);var d=a.GetFixtureA(),b=a.GetFixtureB(),c,h,k;c=d.GetBody().GetUserData();h=b.GetBody().GetUserData();c&&c.objectData&&
(c=objectData);h&&h.objectData&&(h=objectData);if(c&&c.properties&&c.properties.noBottomCollision||h&&h.properties&&h.properties.noBottomCollision)d.GetBody().GetDefinition().type==Box2D.Dynamics.b2Body.b2_staticBody?(h=b.GetBody().m_linearVelocity.y,k=b.GetBody().m_invMass,c=b.GetAABB(),d=d.GetAABB()):(h=d.GetBody().m_linearVelocity.y,k=d.GetBody().m_invMass,c=d.GetAABB(),d=b.GetAABB()),b=Math.abs(d.lowerBound.y-d.upperBound.y),h=h*k/Box2D.Dynamics.b2World.s_timestep2.velocityIterations,(c.upperBound.y-
h>d.upperBound.y&&c.upperBound.y>d.upperBound.y||c.upperBound.y-h>d.lowerBound.y+b/25&&c.upperBound.y>d.lowerBound.y+b/25)&&a.SetEnabled(!1)};c.PlatformerContactListener=b})(boxledjs);boxledjs=boxledjs||{};
(function(c){function b(a,b){this.initialize(a,b)}b.prototype=new createjs.Container;b.prototype.Container_init=b.prototype.initialize;b.prototype.initialize=function(a,b){this.Container_init();this.data=a;this.properties=a.properties;this.objects={};this.map=b;this.reset()};b.prototype.reset=function(){this.initObjects()};b.prototype.onTick=function(){!1!==this.zSorting&&this.sortChildren(this.compareChildY)};b.prototype.compareChildY=function(a,b){return a.y<b.y?-1:a.y>b.y?1:0};b.prototype.initObjects=
function(){var a,c,e,d;a=0;for(c=this.data.objects.length;a<c;a++){e=this.data.objects[a];if(e.type&&""!=e.type)d=b.makeObjectFromData(e);else if(this.map.b2dWorld)d=boxledjs.Box2DUtils.makeB2DBodyFromData(e,this.map.b2dWorld);else{d="Couldn't create b2Body from objectData, because map.b2dWorld is "+this.map.b2dWorld;console.warn&&console.warn(d,e);continue}try{d.isVisible&&this.addChild(d)}catch(f){}try{if(d.bxd){var l=this.map.b2dWorld.CreateBody(d.bxd.bodyDef);l.CreateFixture(d.bxd.fixDef);l.CreateFixture(d.bxd.sensorsDef.bottom).SetUserData({sensorPosition:"bottom"});
l.CreateFixture(d.bxd.sensorsDef.top).SetUserData({sensorPosition:"top"});l.CreateFixture(d.bxd.sensorsDef.right).SetUserData({sensorPosition:"right"});l.CreateFixture(d.bxd.sensorsDef.left).SetUserData({sensorPosition:"left"});l.SetPositionAndAngle(new Box2D.Common.Math.b2Vec2(d.x/boxledjs.Const.scale,d.y/boxledjs.Const.scale),d.rotation*Math.PI/180);d.bxd.sensorsDef=void 0;d.bxd.body=l;l.SetUserData(d);if(d.bxd.onBodyCreated)d.bxd.onBodyCreated(l)}}catch(h){}e.name&&""!=e.name&&(this.objects[e.name]=
d,this.map.objects[e.name]=d)}};b.makeObjectFromData=function(a){var b,c,d,f=a.properties;b=boxledjs.Utils.getDefinitionByName(a.type||f.type||f.classDefinition);f.parameter&&""!=f.parameter&&(c=JSON.parse(f.parameter),"object"==typeof c&&(d=boxledjs.Utils.applyConstruct(b,c)));d=d||new b;for(var l in f)"classDefinition"!=l&&"parameter"!=l&&(d[l]=f[l]);d.x=a.x;d.y=a.y;if(void 0!=a.scaleX||void 0!=f.scaleX)d.scaleX=a.scaleX||f.scaleX;if(void 0!=a.scaleY||void 0!=f.scaleY)d.scaleY=a.scaleY||f.scaleY;
d.rotation=a.rotation;return d};c.ObjectLayer=b})(boxledjs);boxledjs=boxledjs||{};
(function(c){function b(a,b){this.initialize(a,b)}b.prototype=new createjs.Container;b.prototype.Container_init=b.prototype.initialize;b.prototype.initialize=function(a,b){this.Container_init();this.data=a;this.properties=a.properties;this.map=b;this.reset()};b.prototype.reset=function(){this.x=this.data.x;this.y=this.data.y;this.visible=this.data.visible;this.alpha=void 0!=this.data.opacity?parseFloat(this.data.opacity):1;this.numTilesX=this.data.width;this.numTilesY=this.data.height;if(this.isCollisionLayer=
this.properties&&this.properties.collisionLayer&&"false"!=this.properties.collisionLayer)this.colTilesToCheck=[],this.colTileGroups=[];this.pathfinding={};this.drawTiles();"false"!==this.data.properties.cached&&this.cache(0,0,this.map.data.tilewidth*this.numTilesX,this.map.data.tileheight*this.numTilesY);this.isCollisionLayer&&this.map.b2dWorld&&this.calculateCollisionShapes()};b.prototype.drawTiles=function(){var a=this.data.data,b,c,d,f,l,h,k,j=[],m;this.tileObjects=[];for(b=0;b<this.numTilesY;b++){m=
[];for(c=0;c<this.numTilesX;c++)d=c*this.numTilesX+b,f=a[d],k=this.map.getTileProperties(f),0!=f&&(k.type&&""!=k.type?(l={},l.properties=k,l.x=b,l.y=c,h=boxledjs.ObjectLayer.makeObjectFromData(l)):(l=this.map.getTileById(f),h=new createjs.Bitmap(l.image),h.sourceRect=l.rect),h.x=b*this.map.data.tilewidth,h.y=c*this.map.data.tileheight,this.addChild(h),this.tileObjects[d]=h),this.isCollisionLayer?(this.colTilesToCheck[d]=f,d=!Box2DUtils.isTileCollideable(k,f)):d=!k||"false"!=k.passable,m.push(d?GraphNodeType.OPEN:
GraphNodeType.WALL);j.push(m)}this.pathfinding.graph=new Graph(j)};b.prototype.calculateCollisionShapes=function(){var a,b,c,d,f=this.map.data.tilewidth,l=this.map.data.tileheight;for(c=0;c<this.numTilesY;c++)for(b=0;b<this.numTilesX;b++)a=c*this.numTilesX+b,a=this.colTilesToCheck[a],void 0!=a&&0!=a&&(this.colTileGroups.push({tiles:[]}),this.findNextCollisionShapeTile(b,c));a=0;for(d=this.colTileGroups.length;a<d;a++){var h=this.colTileGroups[a],k=h.tiles;b=k[0].x;c=k[0].y;k=k[k.length-1].x-b+1;h=
this.map.getTileProperties(h.tileid)||{};boxledjs.Box2DUtils.makeB2DBodyFromData({x:b*f,y:c*l,width:k*f,height:1*l,properties:h},this.map.b2dWorld).SetUserData(this.tileObjects[c*this.numTilesX+b])}};b.prototype.findNextCollisionShapeTile=function(a,b){a=a||0;b=b||0;var c,d,f;c=b*this.numTilesX+a;d=this.colTilesToCheck[c];void 0!=d&&0!=d&&(f=this.colTileGroups[this.colTileGroups.length-1],f.tileid=f.tileid||d,Object.equals(this.map.getTileProperties(d),this.map.getTileProperties(f.tileid))&&(f.tiles.push({x:a,
y:b,tileid:d}),this.colTilesToCheck[c]=void 0,this.findNextCollisionShapeTile(a+1,b)))};c.TileLayer=b})(boxledjs);boxledjs=boxledjs||{};boxledjs.Const={};boxledjs.Const.scale=32;
(function(c){function b(a,b){this.initialize(a,b)}b.prototype=new createjs.Container;b.prototype.Container_init=b.prototype.initialize;b.prototype.initialize=function(a,b){this.Container_init();this.b2dWorld=b;this.data=a;this.reset()};b.prototype.reset=function(){this.viewPort={};this.layers={};this.objects={};if(!1!==this.b2dWorld&&void 0===this.b2dWorld){boxledjs.Const.scale=parseFloat(this.data.properties.box2dScale)||boxledjs.Const.scale;this.b2dWorld=new Box2D.Dynamics.b2World(new Box2D.Common.Math.b2Vec2(parseFloat(this.data.properties.forceX)||
0,parseFloat(this.data.properties.forceY)||20),!0);var a=new boxledjs.PlatformerContactListener;this.b2dWorld.SetContactListener(a)}this.firstTick=!1;this.generateTileSets();this.pathfinding={};this.setupLayers()};b.prototype.onTick=function(){!this._firstTick&&this._onFirstTick();this.centerObject&&this.centerTo(this.centerObject)};b.prototype._onFirstTick=function(){var a=boxledjs.Utils.getStage(this).canvas;void 0==this.viewPort.width&&(this.viewPort.width=a.width);void 0==this.viewPort.height&&
(this.viewPort.height=a.height);!this.b2dDebugDraw&&this.setupDebugDraw(a);this._firstTick=!0};b.prototype.update=function(a){if(!1!==this.b2dWorld&&void 0!==this.b2dWorld){for(var b=this.b2dWorld.GetBodyList();b;){var c=b.GetUserData(),d=c?c.properties:{};if(c&&c.eventsToDispatch)for(;c.eventsToDispatch.length;){var f=c.eventsToDispatch.pop();this.dispatchEvent(f)}if(!d||!0!=d.ignoreForces){if(b.o_fieldForceX||b.o_fieldForceY)b.ApplyForce(new Box2D.Common.Math.b2Vec2((b.o_fieldForceX||0)*b.GetMass(),
(b.o_fieldForceY||0)*b.GetMass()),b.GetWorldCenter());if(b.o_dynamicForceFields&&b.o_dynamicForceFields.length){for(var c=[],l,d=0,f=b.o_dynamicForceFields.length;d<f;d++){var h=b.o_dynamicForceFields[d],k=parseFloat(h.GetUserData().properties.force)||0,j=new Box2D.Common.Math.b2Vec2(b.GetWorldCenter().x,b.GetWorldCenter().y);j.Subtract(h.GetWorldCenter());j.Normalize();j.Multiply(k);j.Multiply(b.GetMass());!isNaN(j.x)&&!isNaN(j.y)&&b.ApplyForce(j,b.GetWorldCenter());void 0!=h.GetUserData().properties.gravityFactor&&
c.push(parseFloat(h.GetUserData().properties.gravityFactor))}d=0;for(f=c.length;d<f;d++)l=l+c[d]||c[d];isNaN(l)||(d=this.b2dWorld.GetGravity().GetNegative(),d.Multiply(1-l/c.length),d.Multiply(b.GetMass()),b.ApplyForce(d,b.GetWorldCenter()))}}b=b.GetNext()}this.b2dWorld.Step((a||30)/1E3,10,10);this.b2dWorld.ClearForces()}};b.prototype.setupDebugDraw=function(a){if(!this.b2dWorld)return null;this.b2dDebugDraw=new Box2D.Dynamics.b2DebugDraw;this.b2dDebugDraw.SetSprite(a.getContext("2d"));this.b2dDebugDraw.SetDrawScale(boxledjs.Const.scale);
this.b2dDebugDraw.SetFillAlpha(0.35);this.b2dDebugDraw.SetFlags(Box2D.Dynamics.b2DebugDraw.e_shapeBit|Box2D.Dynamics.b2DebugDraw.e_jointBit);this.b2dWorld.SetDebugDraw(this.b2dDebugDraw);return this.b2dDebugDraw};b.prototype.drawDebugData=function(a){this.b2dWorld&&(a=a||1,this.b2dDebugDraw.SetFillAlpha(0.35*a),this.b2dDebugDraw.SetAlpha(1*a),this.b2dDebugDraw.GetSprite().save(),this.b2dDebugDraw.GetSprite().scale(this.scaleX,this.scaleY),this.b2dDebugDraw.GetSprite().translate(-this.regX+this.x/
this.scaleX,-this.regY+this.y/this.scaleY),this.b2dWorld.DrawDebugData(),this.b2dDebugDraw.GetSprite().restore())};b.prototype.setupLayers=function(){var a,b,c,d,f=[];a=0;for(b=this.data.layers.length;a<b;a++){c=this.data.layers[a];if("tilelayer"==c.type){d=new boxledjs.TileLayer(c,this);this.addChild(d);for(var l=d.pathfinding.graph.input,h=0,k=l.length;h<k;h++){var j=l[h],m=f[h]||[];f[h]=m;for(var q=0,n=j.length;q<n;q++)m[q]=(m[q]||1)&j[q]}}else"objectgroup"==c.type&&(d=new boxledjs.ObjectLayer(c,
this),this.addChild(d));c.name&&""!=c.name&&(this.layers[c.name]=d)}this.pathfinding.graph=new Graph(f)};b.prototype.centerTo=function(a){"string"==typeof a&&(a=this.objects[a]);if(a&&void 0!=a){var b,c;a.GetPosition?(c=a.GetPosition(),b=c.x*boxledjs.Const.scale,c=c.y*boxledjs.Const.scale):void 0!=a.x&&void 0!=a.y&&(b=a.x,c=a.y);if(!(void 0==b||void 0==c)){a=this.viewPort.width||0;var d=this.viewPort.height||0;this.regX=b;this.regY=c;this.x=a/2;this.y=d/2}}};b.prototype.calculatePath=function(a,b,
c,d){var f=this.pathfinding.graph.nodes;a=f[a.x][a.y];b=f[b.x][b.y];if((a=astar.search(f,a,b,c))&&a.length&&!0===d){d=!1;for(var l,h=0;h<a.length-2;h++)for(d=!1;!d&&a[h+2];)b=a[h].x-a[h+1].x,c=a[h].y-a[h+1].y,f=a[h].x-a[h+2].x,l=a[h].y-a[h+2].y,0==f&&0==b||0==l&&0==c?a.splice(h+1,1):d=!0}return a};b.prototype.generateTileSets=function(){this.tilesets=[];this.tileproperties={};for(var a=0,c=this.data.tilesets.length;a<c;a++){var e=b.convertTileSetToSpriteSheet(this.data.tilesets[a]);this.tilesets.push(e);
for(var d in e.tileproperties)this.tileproperties[d]=e.tileproperties[d]}};b.prototype.getTileById=function(a){a-=1;return this.getSpriteSheetByTileId(a).getFrame(a)};b.prototype.getSpriteSheetByTileId=function(a){a=a||1;var b=this.tilesets,c,d,f,l;c=0;for(d=b.length;c<d;c++)f=b[c],f.firstgid<=a&&0<f.firstgid&&(l=f);return l};b.prototype.getTileProperties=function(a){return this.tileproperties[a-1]};b.convertTileSetToSpriteSheet=function(a){var b={};b.images=[a.image];b.frames={width:a.tilewidth,
height:a.tileheight};b=new createjs.SpriteSheet(b);b.firstgid=a.firstgid;b.tileproperties=a.tileproperties;return b};c.Map=b})(boxledjs);
