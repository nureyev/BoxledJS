var boxledjs=boxledjs||{};
(function(l){Utils={getScreenWidth:function(){if("number"==typeof window.innerWidth)return window.innerWidth;if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight))return document.documentElement.clientWidth;if(document.body&&(document.body.clientWidth||document.body.clientHeight))return document.body.clientWidth},getScreenHeight:function(){if("number"==typeof window.innerWidth)return window.innerHeight;if(document.documentElement&&(document.documentElement.clientWidth||
document.documentElement.clientHeight))return document.documentElement.clientHeight;if(document.body&&(document.body.clientHeight||document.body.clientHeight))return document.body.clientHeight},getStage:function(a){return a.canvas?a:a.parent?a.parent.canvas?a.parent:l.getStage(a.parent):null},getDefinitionByName:function(a,d,c){d=d||window;c=c||a;a=a.split(".");var b=a.shift();if(d=d[b])return a.length?l.getDefinitionByName(a.join("."),d,c):d;throw Error("Could not find '"+b+"' of '"+c+"'");},applyConstruct:function(a,
d){function c(){function b(){}b.prototype=a.prototype;return new b}var b,h;"function"===typeof Object.create?b=Object.create(a.prototype):{}.__proto__?(b={},b.__proto__=a.prototype,b.__proto__!==a.prototype&&(b=c())):b=c();b.constructor=a;h=a.apply(b,d);"object"===typeof h&&(b=h);return b}};l.Utils=Utils})(boxledjs);boxledjs=boxledjs||{};
(function(l){Box2DUtils={RECT:"rect",CIRCLE:"circle",makeB2DBodyFromData:function(a,d){boxledjs.Const.scale=boxledjs.Const.scale||32;var c=a.properties,b=new Box2D.Dynamics.b2FixtureDef;b.density=void 0==c.density?1:parseFloat(c.density);b.friction=void 0==c.friction?0.5:parseFloat(c.friction);b.restitution=void 0==c.restitution?0.05:parseFloat(c.restitution);b.isSensor=c.isSensor&&"false"!=c.isSensor||c.noCollision&&"false"!=c.noCollision||c.force||c.forceX||c.forceY||void 0!=c.gravityFactor;var h=
new Box2D.Dynamics.b2BodyDef;h.type=c.dynamic?Box2D.Dynamics.b2Body.b2_dynamicBody:Box2D.Dynamics.b2Body.b2_staticBody;var c=d.CreateBody(h),h=a.width/boxledjs.Const.scale/2,f=a.height/boxledjs.Const.scale/2;if(!0==a.ellipse)b.shape=new Box2D.Collision.Shapes.b2CircleShape(h),c.CreateFixture(b),a.x+=a.width/2,a.y+=a.height/2;else if(a.polygon&&1<a.polygon.length)Box2D.Ext.b2Separator.Separate(c,b,a.polygon,boxledjs.Const.scale);else if(a.polyline&&1<a.polyline.length){var e,g,f=0;for(g=a.polyline.length;f<
g-1;f++)b.shape=new Box2D.Collision.Shapes.b2PolygonShape,e=a.polyline[f],h=new Box2D.Common.Math.b2Vec2(e.x/boxledjs.Const.scale,e.y/boxledjs.Const.scale),e=a.polyline[f+1],e=new Box2D.Common.Math.b2Vec2(e.x/boxledjs.Const.scale,e.y/boxledjs.Const.scale),b.shape.SetAsEdge(h,e),c.CreateFixture(b)}else b.shape=new Box2D.Collision.Shapes.b2PolygonShape,b.shape.SetAsBox(h,f),c.CreateFixture(b),a.x+=a.width/2,a.y+=a.height/2;c.SetPositionAndAngle(new Box2D.Common.Math.b2Vec2(a.x/boxledjs.Const.scale,
a.y/boxledjs.Const.scale),(a.rotation||0)*Math.PI/180);c.SetUserData(a);return c},injectBox2d:function(a,d,c,b,h,f,e,g){void 0==g&&(g=!0);var j=boxledjs.Const.scale=boxledjs.Const.scale||32;a.bxd={};c*=0.5;b*=0.5;var k=new Box2D.Dynamics.b2FixtureDef;k.density=void 0==h?1:h;k.friction=void 0==f?0.5:f;k.restitution=void 0==e?0.05:e;if(d==Box2DUtils.RECT)k.shape=new Box2D.Collision.Shapes.b2PolygonShape,k.shape.SetAsBox(c/j,b/j),sensorsDef={},sensorsDef.bottom=Box2DUtils.makeSensorDef((c-1)/j,2/j,0,
b/j),sensorsDef.top=Box2DUtils.makeSensorDef((c-1)/j,2/j,0,-b/j),sensorsDef.right=Box2DUtils.makeSensorDef(2/j,(b-1)/j,c/j,0),sensorsDef.left=Box2DUtils.makeSensorDef(2/j,(b-1)/j,-c/j,0);else if(d==Box2DUtils.CIRCLE)k.shape=new Box2D.Collision.Shapes.b2CircleShape(2*c/j);else throw Error("Cannot resolve shape-type: "+d);a.bxd.fixDef=k;a.bxd.sensors={bottom:0,top:0,right:0,left:0};a.bxd.sensorsDef=sensorsDef;d=new Box2D.Dynamics.b2BodyDef;d.type=!g?Box2D.Dynamics.b2Body.b2_staticBody:Box2D.Dynamics.b2Body.b2_dynamicBody;
a.bxd.bodyDef=d;a.onTick&&(a.__onTick=a.onTick);a.onTick=function(b){this.__onTick&&this.__onTick(b);this.bxd.body&&(b=this.bxd.body.GetPosition(),this.x=b.x*j,this.y=b.y*j,this.rotation=180*(this.bxd.body.GetAngle()/Math.PI))}},makeSensorDef:function(a,d,c,b){var h=new Box2D.Dynamics.b2FixtureDef;h.isSensor=!0;var f=new Box2D.Collision.Shapes.b2PolygonShape;f.SetAsOrientedBox(a,d,new Box2D.Common.Math.b2Vec2(c,b),0);h.shape=f;return h}};l.Box2DUtils=Box2DUtils})(boxledjs);
Object.equals=function(l,a){if(l===a)return!0;if(!(l instanceof Object)||!(a instanceof Object)||l.constructor!==a.constructor)return!1;for(var d in l)if(l.hasOwnProperty(d)&&(!a.hasOwnProperty(d)||l[d]!==a[d]&&("object"!==typeof l[d]||!Object.equals(l[d],a[d]))))return!1;for(d in a)if(a.hasOwnProperty(d)&&!l.hasOwnProperty(d))return!1;return!0};var Box2D=Box2D||{};Box2D.Ext=Box2D.Ext||{};
(function(l){function a(b,c,d,a,g,j){var k;if(k=(d+0.1>=b&&b>=g-0.1||d-0.1<=b&&b<=g+0.1)&&(a+0.1>=c&&c>=j-0.1||a-0.1<=c&&c<=j+0.1))0.1<g-d||0.1<d-g?(b=(j-a)/(g-d)*(b-d)+a,k=0.1>(b>c?b-c:c-b)):k=0.1>b-d||0.1>d-b;return k}function d(b,c,d,a){return 0.1>(d>=b?d-b:b-d)&&0.1>(a>=c?a-c:c-a)}function c(){throw Error("A problem has occurred. Use the Validate() method to see where the problem is.");}l.b2Separator={Separate:function(b,h,f,e){e=e||32;var g,j=f.length,k,l,t=[];for(g=0;g<j;g++)t.push(new Box2D.Common.Math.b2Vec2(f[g].x/
e,f[g].y/e));var m,q,n,r,y,w,A,x,s,p,u,v,z,D;e=[];f=[];for(f.push(t);f.length;){g=f[0];j=g.length;D=!0;for(m=0;m<j;m++)if(t=m,A=m<j-1?m+1:m+1-j,n=m<j-2?m+2:m+2-j,x=g[t],s=g[A],n=g[n],n=x.x*s.y+s.x*n.y+n.x*x.y-x.y*s.x-s.y*n.x-n.y*x.x,0>n){D=!1;w=Number.MAX_VALUE;for(q=0;q<j;q++)if(q!=t&&q!=A){m=q;n=q<j-1?q+1:0;p=g[m];u=g[n];r=x.x;y=x.y;var F=s.x,G=s.y;v=p.x;p=p.y;var H=u.x;u=u.y;var B=F-r,C=G-y,I=H-v,J=u-p,E=void 0,E=(I*(p-y)-J*(v-r))/(C*I-B*J),B=r+E*B,C=y+E*C;r=a(F,G,r,y,B,C);v=a(B,C,v,p,H,u);if(v=
r&&v?new Box2D.Common.Math.b2Vec2(B,C):null)r=s.x-v.x,y=s.y-v.y,r=r*r+y*y,r<w&&(l=m,k=n,z=v,w=r)}w==Number.MAX_VALUE&&c();q=[];w=[];m=l;n=k;p=g[m];u=g[n];d(z.x,z.y,u.x,u.y)||q.push(z);d(z.x,z.y,p.x,p.y)||w.push(z);l=-1;for(k=t;;){if(k!=n)q.push(g[k]);else{(0>l||l>=j)&&c();a(u.x,u.y,g[l].x,g[l].y,x.x,x.y)||q.push(g[k]);break}l=k;0>k-1?k=j-1:k--}q=q.reverse();l=-1;for(k=A;;){if(k!=m)w.push(g[k]);else{(0>l||l>=j)&&c();k==m&&!a(p.x,p.y,g[l].x,g[l].y,s.x,s.y)&&w.push(g[k]);break}l=k;k+1>j-1?k=0:k++}f.push(q,
w);f.shift();break}D&&e.push(f.shift())}j=e.length;for(g=0;g<j;g++){f=[];t=e[g];l=t.length;for(k=0;k<l;k++)f.push(new Box2D.Common.Math.b2Vec2(t[k].x,t[k].y));k=new Box2D.Collision.Shapes.b2PolygonShape;k.SetAsArray(f);h.shape=k;b.CreateFixture(h)}},Validate:function(b){var c,d=b.length,e,g,j,k,l,t=0,m,q=!1;for(c=0;c<d;c++){j=c<d-1?c+1:0;k=0<c?c-1:d-1;m=!1;for(e=0;e<d;e++)if(e!=c&&e!=j&&(m||(l=b[c].x*b[j].y+b[j].x*b[e].y+b[e].x*b[c].y-b[c].y*b[j].x-b[j].y*b[e].x-b[e].y*b[c].x,0<l&&(m=!0)),e!=k)){g=
e<d-1?e+1:0;var n=b[c].x,r=b[c].y,y=b[j].x,w=b[j].y;l=b[e].x;var A=b[e].y,x=b[g].x;g=b[g].y;var s=y-n,p=w-r,u=x-l,v=g-A,z=void 0,z=(u*(A-r)-v*(l-n))/(p*u-s*v),s=n+z*s,p=r+z*p,n=a(s,p,n,r,y,w);l=a(s,p,l,A,x,g);l=n&&l?new Box2D.Common.Math.b2Vec2(s,p):null;l&&(t=1)}m||(q=!0)}q&&(t=1==t?3:2);return t}}})(Box2D.Ext);boxledjs=boxledjs||{};
(function(l){function a(){}a.prototype=new Box2D.Dynamics.b2ContactListener;var d=a.prototype;d.BeginContact=function(c){var b=c.GetFixtureA(),d=c.GetFixtureB();this.__BeginContactOrdered(b,d,c);this.__BeginContactOrdered(d,b,c)};d.__BeginContactOrdered=function(c,b,d){var a=c.GetBody().GetUserData(),e=b.GetBody().GetUserData();a&&a.objectData&&(a=objectData);e&&e.objectData&&(e=objectData);this.__applyForceField(c,b,a,e,1,1,d);this.__applyImpulse(c,b,a,e,d)};d.EndContact=function(c){var b=c.GetFixtureA();
c=c.GetFixtureB();this.__EndContactOrdered(b,c);this.__EndContactOrdered(c,b)};d.__EndContactOrdered=function(c,b,d){var a=c.GetBody().GetUserData(),e=b.GetBody().GetUserData();a&&a.objectData&&(a=objectData);e&&e.objectData&&(e=objectData);this.__applyForceField(c,b,a,e,-1,0,d)};d.__applyForceField=function(c,b,d,a,e,g){if(d&&d.properties&&(d.properties.forceX||d.properties.forceY))if((d.properties.forceX||d.properties.forceY)&&!b.IsSensor()){a=parseFloat(d.properties.forceX)||0;var j=parseFloat(d.properties.forceY)||
0,k=b.GetBody();k.o_fieldForceX=k.o_fieldForceX+a*e||a*(g||0);k.o_fieldForceY=k.o_fieldForceY+j*e||j*(g||0)}if(d&&d.properties&&(d.properties.force||void 0!=d.properties.gravityFactor)&&!b.IsSensor())k=b.GetBody(),k.o_dynamicForceFields=k.o_dynamicForceFields||[],1==e?k.o_dynamicForceFields.push(c.GetBody()):k.o_dynamicForceFields.splice(k.o_dynamicForceFields.indexOf(c.GetBody()),1)};d.__applyImpulse=function(c,d,a,f,e){if(a&&a.properties&&(a.properties.impulseX||a.properties.impulseY||a.properties.impulse)){if((a.properties.impulseX||
a.properties.impulseY)&&!d.IsSensor()){f=parseFloat(a.properties.impulseX)||0;var g=parseFloat(a.properties.impulseY)||0,j=d.GetBody();j.ApplyImpulse(new Box2D.Common.Math.b2Vec2(f||0,g||0),j.GetWorldCenter())}a.properties.impulse&&!d.IsSensor()&&(a=parseFloat(a.properties.impulse)||0,c=c.GetBody(),d=d.GetBody(),f=new Box2D.Common.Math.b2Vec2(d.GetWorldCenter().x,d.GetWorldCenter().y),f.Subtract(c.GetWorldCenter()),f.Normalize(),f.Multiply(a),d.ApplyImpulse(f,d.GetWorldPoint(e.GetManifold().m_localPoint)))}};
d.PreSolve=function(){};l.BoxledJSContactListener=a})(boxledjs);boxledjs=boxledjs||{};
(function(l){function a(){}a.prototype=new boxledjs.BoxledJSContactListener;var d=a.prototype;d.super_BeginContact=d.BeginContact;d.BeginContact=function(d){this.super_BeginContact(d);this.__HandleContact(d,1)};d.super_EndContact=d.EndContact;d.EndContact=function(d){this.super_EndContact(d);this.__HandleContact(d,-1)};d.__HandleContact=function(d,b){var a=d.GetFixtureA(),f=d.GetFixtureB(),e=a.IsSensor()?a:f.IsSensor()?f:null;if(e&&(a=a!=e?a:f,(f=a.GetBody().GetUserData())&&f.objectData&&(f=objectData),
e.GetUserData()&&e.GetUserData().sensorPosition)){var g=e.GetUserData().sensorPosition;f&&f.properties&&f.properties.noBottomCollision&&("left"==g||"right"==g)||a.IsSensor()||(obj=e.GetBody().GetUserData())&&(obj.bxd&&obj.bxd.sensors)&&(obj.bxd.sensors[g]+=b)}};d.super_PreSolve=d.PreSolve;d.PreSolve=function(d,b){this.super_PreSolve(d,b);var a=d.GetFixtureA(),f=d.GetFixtureB(),e,g,j;e=a.GetBody().GetUserData();g=f.GetBody().GetUserData();e&&e.objectData&&(e=objectData);g&&g.objectData&&(g=objectData);
if(e&&e.properties&&e.properties.noBottomCollision||g&&g.properties&&g.properties.noBottomCollision)a.GetBody().GetDefinition().type==Box2D.Dynamics.b2Body.b2_staticBody?(g=f.GetBody().m_linearVelocity.y,j=f.GetBody().m_invMass,e=f.GetAABB(),a=a.GetAABB()):(g=a.GetBody().m_linearVelocity.y,j=a.GetBody().m_invMass,e=a.GetAABB(),a=f.GetAABB()),f=Math.abs(a.lowerBound.y-a.upperBound.y),g=g*j/Box2D.Dynamics.b2World.s_timestep2.velocityIterations,(e.upperBound.y-g>a.upperBound.y&&e.upperBound.y>a.upperBound.y||
e.upperBound.y-g>a.lowerBound.y+f/25&&e.upperBound.y>a.lowerBound.y+f/25)&&d.SetEnabled(!1)};l.PlatformerContactListener=a})(boxledjs);boxledjs=boxledjs||{};
(function(l){function a(d,a){this.initialize(d,a)}a.prototype=new createjs.Container;a.prototype.Container_init=a.prototype.initialize;a.prototype.initialize=function(d,a){this.Container_init();this.data=d;this.properties=d.properties;this.objects={};this.map=a;this.reset()};a.prototype.reset=function(){this.initObjects()};a.prototype.initObjects=function(){var d,a,b,h;d=0;for(a=this.data.objects.length;d<a;d++){b=this.data.objects[d];h=b.type&&""!=b.type?this.makeObjectFromData(b):boxledjs.Box2DUtils.makeB2DBodyFromData(b,
this.map.b2dWorld);try{h.isVisible&&this.addChild(h)}catch(f){}try{if(h.bxd){var e=this.map.b2dWorld.CreateBody(h.bxd.bodyDef);e.CreateFixture(h.bxd.fixDef);e.CreateFixture(h.bxd.sensorsDef.bottom).SetUserData({sensorPosition:"bottom"});e.CreateFixture(h.bxd.sensorsDef.top).SetUserData({sensorPosition:"top"});e.CreateFixture(h.bxd.sensorsDef.right).SetUserData({sensorPosition:"right"});e.CreateFixture(h.bxd.sensorsDef.left).SetUserData({sensorPosition:"left"});e.SetPositionAndAngle(new Box2D.Common.Math.b2Vec2(h.x/
boxledjs.Const.scale,h.y/boxledjs.Const.scale),h.rotation*Math.PI/180);h.bxd.sensorsDef=void 0;h.bxd.body=e;e.SetUserData(h);if(h.bxd.onBodyCreated)h.bxd.onBodyCreated(e)}}catch(g){console.log(b.name)}b.name&&""!=b.name&&(this.objects[b.name]=h,this.map.objects[b.name]=h)}};a.prototype.makeObjectFromData=function(d){var a,b,h,f=d.properties;a=boxledjs.Utils.getDefinitionByName(d.type||f.classDefinition);f.parameter&&""!=f.parameter&&(b=JSON.parse(f.parameter),"object"==typeof b&&(h=boxledjs.Utils.applyConstruct(a,
b)));h=h||new a;for(var e in f)"classDefinition"!=e&&"parameter"!=e&&(h[e]=f[e]);h.x=d.x;h.y=d.y;h.rotation=d.rotation;return h};l.ObjectLayer=a})(boxledjs);boxledjs=boxledjs||{};
(function(l){function a(d,a){this.initialize(d,a)}a.prototype=new createjs.Container;a.prototype.Container_init=a.prototype.initialize;a.prototype.initialize=function(d,a){this.Container_init();this.data=d;this.properties=d.properties;this.map=a;this.reset()};a.prototype.reset=function(){this.x=this.data.x;this.y=this.data.y;this.visible=this.data.visible;this.numTilesX=this.data.width;this.numTilesY=this.data.height;if(this.isCollisionLayer=this.properties&&this.properties.collisionLayer&&"false"!=
this.properties.collisionLayer)this.colTilesToCheck=[],this.colTileGroups=[];this.drawTiles();this.cache(0,0,this.map.data.tilewidth*this.numTilesX,this.map.data.tileheight*this.numTilesY);this.isCollisionLayer&&this.calculateCollisionShapes()};a.prototype.drawTiles=function(){var d=this.data.data,a,b,h,f,e,g;for(b=0;b<this.numTilesY;b++)for(a=0;a<this.numTilesX;a++)h=b*this.numTilesX+a,f=d[h],0!=f&&(e=this.map.getTileById(f),g=new createjs.Bitmap(e.image),g.sourceRect=e.rect,g.x=a*this.map.data.tilewidth,
g.y=b*this.map.data.tileheight,this.addChild(g)),this.isCollisionLayer&&(this.colTilesToCheck[h]=f)};a.prototype.calculateCollisionShapes=function(){var d,a,b,h,f=this.map.data.tilewidth,e=this.map.data.tileheight;for(b=0;b<this.numTilesY;b++)for(a=0;a<this.numTilesX;a++)d=b*this.numTilesX+a,d=this.colTilesToCheck[d],void 0!=d&&0!=d&&(this.colTileGroups.push({tiles:[]}),this.findNextCollisionShapeTile(a,b));d=0;for(h=this.colTileGroups.length;d<h;d++){var g=this.colTileGroups[d],j=g.tiles;a=j[0].x;
b=j[0].y;j=j[j.length-1].x-a+1;g=this.map.getTileProperties(g.tileid)||{};boxledjs.Box2DUtils.makeB2DBodyFromData({x:a*f,y:b*e,width:j*f,height:1*e,properties:g},this.map.b2dWorld)}};a.prototype.findNextCollisionShapeTile=function(a,c){a=a||0;c=c||0;var b,h,f;b=c*this.numTilesX+a;h=this.colTilesToCheck[b];void 0!=h&&0!=h&&(f=this.colTileGroups[this.colTileGroups.length-1],f.tileid=f.tileid||h,Object.equals(this.map.getTileProperties(h),this.map.getTileProperties(f.tileid))&&(f.tiles.push({x:a,y:c,
tileid:h}),this.colTilesToCheck[b]=void 0,this.findNextCollisionShapeTile(a+1,c)))};l.TileLayer=a})(boxledjs);boxledjs=boxledjs||{};boxledjs.Const={};boxledjs.Const.scale=32;
(function(l){function a(a,c){this.initialize(a,c)}a.prototype=new createjs.Container;a.prototype.Container_init=a.prototype.initialize;a.prototype.initialize=function(a,c){this.Container_init();this.b2dWorld=c;this.data=a;this.reset()};a.prototype.reset=function(){this.viewPort={};this.layers={};this.objects={};if(!this.b2dWorld){boxledjs.Const.scale=parseFloat(this.data.properties.box2dScale)||boxledjs.Const.scale;this.b2dWorld=new Box2D.Dynamics.b2World(new Box2D.Common.Math.b2Vec2(parseFloat(this.data.properties.forceX)||0,
parseFloat(this.data.properties.forceY)||20),!0);var a=new boxledjs.PlatformerContactListener;this.b2dWorld.SetContactListener(a)}this.firstTick=!1;this.generateTileSets();this.setupLayers()};a.prototype.onTick=function(){!this._firstTick&&this._onFirstTick();this.centerObject&&this.centerTo(this.centerObject)};a.prototype._onFirstTick=function(){var a=boxledjs.Utils.getStage(this).canvas;void 0==this.viewPort.width&&(this.viewPort.width=a.width);void 0==this.viewPort.height&&(this.viewPort.height=
a.height);!this.b2dDebugDraw&&this.setupDebugDraw(a);this._firstTick=!0};a.prototype.setupDebugDraw=function(a){this.b2dDebugDraw=new Box2D.Dynamics.b2DebugDraw;this.b2dDebugDraw.SetSprite(a.getContext("2d"));this.b2dDebugDraw.SetDrawScale(boxledjs.Const.scale);this.b2dDebugDraw.SetFillAlpha(0.35);this.b2dDebugDraw.SetFlags(Box2D.Dynamics.b2DebugDraw.e_shapeBit|Box2D.Dynamics.b2DebugDraw.e_jointBit);this.b2dWorld.SetDebugDraw(this.b2dDebugDraw);return this.b2dDebugDraw};a.prototype.update=function(a){for(var c=
this.b2dWorld.GetBodyList();c;){var b=c.GetUserData(),b=b?b.properties:{};if(!b||!0!=b.ignoreForces){if(c.o_fieldForceX||c.o_fieldForceY)c.ApplyForce(new Box2D.Common.Math.b2Vec2((c.o_fieldForceX||0)*c.GetMass(),(c.o_fieldForceY||0)*c.GetMass()),c.GetWorldCenter());if(c.o_dynamicForceFields&&c.o_dynamicForceFields.length){for(var b=[],h,f=0,e=c.o_dynamicForceFields.length;f<e;f++){var g=c.o_dynamicForceFields[f],j=parseFloat(g.GetUserData().properties.force)||0,k=new Box2D.Common.Math.b2Vec2(c.GetWorldCenter().x,
c.GetWorldCenter().y);k.Subtract(g.GetWorldCenter());k.Normalize();k.Multiply(j);k.Multiply(c.GetMass());c.ApplyForce(k,c.GetWorldCenter());void 0!=g.GetUserData().properties.gravityFactor&&b.push(parseFloat(g.GetUserData().properties.gravityFactor))}f=0;for(e=b.length;f<e;f++)h=h+b[f]||b[f];f=this.b2dWorld.GetGravity().GetNegative();f.Multiply(1-h/b.length);f.Multiply(c.GetMass());c.ApplyForce(f,c.GetWorldCenter())}}c=c.GetNext()}this.b2dWorld.Step((a||30)/1E3,10,10);this.b2dWorld.ClearForces()};
a.prototype.drawDebugData=function(a){a=a||1;this.b2dDebugDraw.SetFillAlpha(0.35*a);this.b2dDebugDraw.SetAlpha(1*a);this.b2dDebugDraw.GetSprite().save();this.b2dDebugDraw.GetSprite().scale(this.scaleX,this.scaleY);this.b2dDebugDraw.GetSprite().translate(-this.regX+this.x/this.scaleX,-this.regY+this.y/this.scaleY);this.b2dWorld.DrawDebugData();this.b2dDebugDraw.GetSprite().restore()};a.prototype.setupLayers=function(){var a,c,b,h;a=0;for(c=this.data.layers.length;a<c;a++)b=this.data.layers[a],"tilelayer"==
b.type?(h=new boxledjs.TileLayer(b,this),this.addChild(h)):"objectgroup"==b.type&&(h=new boxledjs.ObjectLayer(b,this),this.addChild(h)),b.name&&""!=b.name&&(this.layers[b.name]=h)};a.prototype.centerTo=function(a){"string"==typeof a&&(a=this.objects[a]);if(a&&void 0!=a){var c,b;a.GetPosition?(b=a.GetPosition(),c=b.x*boxledjs.Const.scale,b=b.y*boxledjs.Const.scale):void 0!=a.x&&void 0!=a.y&&(c=a.x,b=a.y);if(!(void 0==c||void 0==b)){a=this.viewPort.width||0;var h=this.viewPort.height||0;this.regX=c;
this.regY=b;this.x=a/2;this.y=h/2}}};a.prototype.generateTileSets=function(){this.tilesets=[];this.tileproperties={};for(var d=0,c=this.data.tilesets.length;d<c;d++){var b=a.convertTileSetToSpriteSheet(this.data.tilesets[d]);this.tilesets.push(b);for(var h in b.tileproperties)this.tileproperties[h]=b.tileproperties[h]}};a.prototype.getTileById=function(a){a-=1;return this.getSpriteSheetByTileId(a).getFrame(a)};a.prototype.getSpriteSheetByTileId=function(a){a=a||1;var c=this.tilesets,b,h,f,e;b=0;for(h=
c.length;b<h;b++)f=c[b],f.firstgid<=a&&0<f.firstgid&&(e=f);return e};a.prototype.getTileProperties=function(a){return this.tileproperties[a-1]};a.convertTileSetToSpriteSheet=function(a){var c={};c.images=[a.image];c.frames={width:a.tilewidth,height:a.tileheight};c=new createjs.SpriteSheet(c);c.firstgid=a.firstgid;c.tileproperties=a.tileproperties;return c};l.Map=a})(boxledjs);
