var astar={init:function(c){for(var b=0,a=c.length;b<a;b++)for(var f=0,e=c[b].length;f<e;f++){var d=c[b][f];d.f=0;d.g=0;d.h=0;d.cost=d.type;d.visited=!1;d.closed=!1;d.parent=null}},heap:function(){return new BinaryHeap(function(c){return c.f})},search:function(c,b,a,f,e){astar.init(c);e=e||astar.manhattan;f=!!f;var d=astar.heap();for(d.push(b);0<d.size();){b=d.pop();if(b===a){c=b;for(a=[];c.parent;)a.push(c),c=c.parent;return a.reverse()}b.closed=!0;for(var j=astar.neighbors(c,b,f),k=0,l=j.length;k<
l;k++){var g=j[k];if(!g.closed&&!g.isWall()){var h=b.g+g.cost,m=g.visited;if(!m||h<g.g)g.visited=!0,g.parent=b,g.h=g.h||e(g.pos,a.pos),g.g=h,g.f=g.g+g.h,m?d.rescoreElement(g):d.push(g)}}}return[]},manhattan:function(c,b){var a=Math.abs(b.x-c.x),f=Math.abs(b.y-c.y);return a+f},neighbors:function(c,b,a){var f=[],e=b.x;b=b.y;c[e-1]&&c[e-1][b]&&f.push(c[e-1][b]);c[e+1]&&c[e+1][b]&&f.push(c[e+1][b]);c[e]&&c[e][b-1]&&f.push(c[e][b-1]);c[e]&&c[e][b+1]&&f.push(c[e][b+1]);a&&(c[e-1]&&c[e-1][b-1]&&f.push(c[e-
1][b-1]),c[e+1]&&c[e+1][b-1]&&f.push(c[e+1][b-1]),c[e-1]&&c[e-1][b+1]&&f.push(c[e-1][b+1]),c[e+1]&&c[e+1][b+1]&&f.push(c[e+1][b+1]));return f}};var GraphNodeType={OPEN:1,WALL:0};function Graph(c){for(var b=[],a=0;a<c.length;a++){b[a]=[];for(var f=0,e=c[a];f<e.length;f++)b[a][f]=new GraphNode(a,f,e[f])}this.input=c;this.nodes=b}Graph.prototype.toString=function(){for(var c="\n",b=this.nodes,a,f,e,d,j=0,k=b.length;j<k;j++){a="";f=b[j];e=0;for(d=f.length;e<d;e++)a+=f[e].type+" ";c=c+a+"\n"}return c};function GraphNode(c,b,a){this.data={};this.x=c;this.y=b;this.pos={x:c,y:b};this.type=a}
GraphNode.prototype.toString=function(){return"["+this.x+" "+this.y+"]"};GraphNode.prototype.isWall=function(){return this.type==GraphNodeType.WALL};function BinaryHeap(c){this.content=[];this.scoreFunction=c}
BinaryHeap.prototype={push:function(c){this.content.push(c);this.sinkDown(this.content.length-1)},pop:function(){var c=this.content[0],b=this.content.pop();0<this.content.length&&(this.content[0]=b,this.bubbleUp(0));return c},remove:function(c){var b=this.content.indexOf(c),a=this.content.pop();b!==this.content.length-1&&(this.content[b]=a,this.scoreFunction(a)<this.scoreFunction(c)?this.sinkDown(b):this.bubbleUp(b))},size:function(){return this.content.length},rescoreElement:function(c){this.sinkDown(this.content.indexOf(c))},
sinkDown:function(c){for(var b=this.content[c];0<c;){var a=(c+1>>1)-1,f=this.content[a];if(this.scoreFunction(b)<this.scoreFunction(f))this.content[a]=b,this.content[c]=f,c=a;else break}},bubbleUp:function(c){for(var b=this.content.length,a=this.content[c],f=this.scoreFunction(a);;){var e=c+1<<1,d=e-1,j=null;if(d<b){var k=this.scoreFunction(this.content[d]);k<f&&(j=d)}if(e<b&&this.scoreFunction(this.content[e])<(null===j?f:k))j=e;if(null!==j)this.content[c]=this.content[j],this.content[j]=a,c=j;else break}}};var boxledjs=boxledjs||{};
(function(c){Utils={getScreenWidth:function(){if("number"==typeof window.innerWidth)return window.innerWidth;if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight))return document.documentElement.clientWidth;if(document.body&&(document.body.clientWidth||document.body.clientHeight))return document.body.clientWidth},getScreenHeight:function(){if("number"==typeof window.innerWidth)return window.innerHeight;if(document.documentElement&&(document.documentElement.clientWidth||
document.documentElement.clientHeight))return document.documentElement.clientHeight;if(document.body&&(document.body.clientHeight||document.body.clientHeight))return document.body.clientHeight},getStage:function(b){return b.canvas?b:b.parent?b.parent.canvas?b.parent:c.getStage(b.parent):null},getDefinitionByName:function(b,a,f){a=a||window;f=f||b;b=b.split(".");var e=b.shift();if(a=a[e])return b.length?c.getDefinitionByName(b.join("."),a,f):a;throw Error("Could not find '"+e+"' of '"+f+"'");},applyConstruct:function(b,
a){function f(){function a(){}a.prototype=b.prototype;return new a}var e,d;"function"===typeof Object.create?e=Object.create(b.prototype):{}.__proto__?(e={},e.__proto__=b.prototype,e.__proto__!==b.prototype&&(e=f())):e=f();e.constructor=b;d=b.apply(e,a);"object"===typeof d&&(e=d);return e}};c.Utils=Utils})(boxledjs);boxledjs=boxledjs||{};
(function(c){function b(a,f){a=a.split(",");return{x:parseFloat(a[0])*f.width,y:parseFloat(a[1])*f.height}}Box2DUtils={RECT:"rect",CIRCLE:"circle",makeB2DBodyFromData:function(a,f){boxledjs.Const.scale=boxledjs.Const.scale||32;var e=a.properties,d=new Box2D.Dynamics.b2FixtureDef;d.density=void 0==e.density?1:parseFloat(e.density);d.friction=void 0==e.friction?0.5:parseFloat(e.friction);d.restitution=void 0==e.restitution?0.05:parseFloat(e.restitution);d.isSensor=!Box2DUtils.isTileCollideable(e);var j=
new Box2D.Dynamics.b2BodyDef;j.type=e.dynamic?Box2D.Dynamics.b2Body.b2_dynamicBody:Box2D.Dynamics.b2Body.b2_staticBody;var j=f.CreateBody(j),k=a.width/boxledjs.Const.scale/2,c=a.height/boxledjs.Const.scale/2;if(e.topLeft||e.topRight||e.bottomRight||e.bottomLeft)a.polygon=[],"none"!=e.topLeft&&a.polygon.push(b(e.topLeft||"0,0",a)),"none"!=e.topRight&&a.polygon.push(b(e.topRight||"1,0",a)),"none"!=e.bottomRight&&a.polygon.push(b(e.bottomRight||"1,1",a)),"none"!=e.bottomLeft&&a.polygon.push(b(e.bottomLeft||
"0,1",a));if(!0==a.ellipse)d.shape=new Box2D.Collision.Shapes.b2CircleShape(k),j.CreateFixture(d),a.x+=a.width/2,a.y+=a.height/2;else if(a.polygon&&1<a.polygon.length)Box2D.Ext.b2Separator.Separate(j,d,a.polygon,boxledjs.Const.scale);else if(a.polyline&&1<a.polyline.length)for(var g,k=0,c=a.polyline.length;k<c-1;k++)d.shape=new Box2D.Collision.Shapes.b2PolygonShape,g=a.polyline[k],e=new Box2D.Common.Math.b2Vec2(g.x/boxledjs.Const.scale,g.y/boxledjs.Const.scale),g=a.polyline[k+1],g=new Box2D.Common.Math.b2Vec2(g.x/
boxledjs.Const.scale,g.y/boxledjs.Const.scale),d.shape.SetAsEdge(e,g),j.CreateFixture(d);else d.shape=new Box2D.Collision.Shapes.b2PolygonShape,d.shape.SetAsBox(k,c),j.CreateFixture(d),a.x+=a.width/2,a.y+=a.height/2;j.SetPositionAndAngle(new Box2D.Common.Math.b2Vec2(a.x/boxledjs.Const.scale,a.y/boxledjs.Const.scale),(a.rotation||0)*Math.PI/180);j.SetUserData(a);return j},isTileCollideable:function(a,f){return 0!=f&&(!a||!(a.isSensor&&"false"!=a.isSensor||a.noCollision&&"false"!=a.noCollision||a.force||
a.forceX||a.forceY||void 0!=a.gravityFactor))},injectBox2d:function(a,f,e,d,b,k,c,g){void 0==g&&(g=!0);var h=boxledjs.Const.scale=boxledjs.Const.scale||32;a.bxd={};e*=0.5;d*=0.5;var m=new Box2D.Dynamics.b2FixtureDef;m.density=void 0==b?1:b;m.friction=void 0==k?0.5:k;m.restitution=void 0==c?0.05:c;if(f==Box2DUtils.RECT)m.shape=new Box2D.Collision.Shapes.b2PolygonShape,m.shape.SetAsBox(e/h,d/h),sensorsDef={},sensorsDef.bottom=Box2DUtils.makeSensorDef((e+2)/h,2/h,0,d/h),sensorsDef.top=Box2DUtils.makeSensorDef((e+
2)/h,2/h,0,-d/h),sensorsDef.right=Box2DUtils.makeSensorDef(2/h,(d-1)/h,e/h,0),sensorsDef.left=Box2DUtils.makeSensorDef(2/h,(d-1)/h,-e/h,0);else if(f==Box2DUtils.CIRCLE)m.shape=new Box2D.Collision.Shapes.b2CircleShape(2*e/h);else throw Error("Cannot resolve shape-type: "+f);a.bxd.fixDef=m;a.bxd.sensors={bottom:0,top:0,right:0,left:0};a.bxd.sensorsDef=sensorsDef;f=new Box2D.Dynamics.b2BodyDef;f.type=!g?Box2D.Dynamics.b2Body.b2_staticBody:Box2D.Dynamics.b2Body.b2_dynamicBody;a.bxd.bodyDef=f;a.onTick&&
(a.__onTick=a.onTick);a.onTick=function(a){this.__onTick&&this.__onTick(a);this.bxd.body&&(a=this.bxd.body.GetPosition(),this.x=a.x*h,this.y=a.y*h,this.rotation=180*(this.bxd.body.GetAngle()/Math.PI))}},makeSensorDef:function(a,f,e,d){var b=new Box2D.Dynamics.b2FixtureDef;b.isSensor=!0;var k=new Box2D.Collision.Shapes.b2PolygonShape;k.SetAsOrientedBox(a,f,new Box2D.Common.Math.b2Vec2(e,d),0);b.shape=k;return b}};c.Box2DUtils=Box2DUtils})(boxledjs);
Object.equals=function(c,b){if(c===b)return!0;if(!(c instanceof Object)||!(b instanceof Object)||c.constructor!==b.constructor)return!1;for(var a in c)if(c.hasOwnProperty(a)&&(!b.hasOwnProperty(a)||c[a]!==b[a]&&("object"!==typeof c[a]||!Object.equals(c[a],b[a]))))return!1;for(a in b)if(b.hasOwnProperty(a)&&!c.hasOwnProperty(a))return!1;return!0};var Box2D=Box2D||{};Box2D.Ext=Box2D.Ext||{};
(function(c){function b(a,d,f,b,c,g){var h;if(h=(f+0.1>=a&&a>=c-0.1||f-0.1<=a&&a<=c+0.1)&&(b+0.1>=d&&d>=g-0.1||b-0.1<=d&&d<=g+0.1))0.1<c-f||0.1<f-c?(a=(g-b)/(c-f)*(a-f)+b,h=0.1>(a>d?a-d:d-a)):h=0.1>a-f||0.1>f-a;return h}function a(a,d,f,b){return 0.1>(f>=a?f-a:a-f)&&0.1>(b>=d?b-d:d-b)}function f(){throw Error("A problem has occurred. Use the Validate() method to see where the problem is.");}c.b2Separator={Separate:function(e,d,j,k){k=k||32;var c,g=j.length,h,m,q=[];for(c=0;c<g;c++)q.push(new Box2D.Common.Math.b2Vec2(j[c].x/
k,j[c].y/k));var n,s,p,t,z,x,B,y,u,r,v,w,A,E;k=[];j=[];for(j.push(q);j.length;){c=j[0];g=c.length;E=!0;for(n=0;n<g;n++)if(q=n,B=n<g-1?n+1:n+1-g,p=n<g-2?n+2:n+2-g,y=c[q],u=c[B],p=c[p],p=y.x*u.y+u.x*p.y+p.x*y.y-y.y*u.x-u.y*p.x-p.y*y.x,0>p){E=!1;x=Number.MAX_VALUE;for(s=0;s<g;s++)if(s!=q&&s!=B){n=s;p=s<g-1?s+1:0;r=c[n];v=c[p];t=y.x;z=y.y;var G=u.x,H=u.y;w=r.x;r=r.y;var I=v.x;v=v.y;var C=G-t,D=H-z,J=I-w,K=v-r,F=void 0,F=(J*(r-z)-K*(w-t))/(D*J-C*K),C=t+F*C,D=z+F*D;t=b(G,H,t,z,C,D);w=b(C,D,w,r,I,v);if(w=
t&&w?new Box2D.Common.Math.b2Vec2(C,D):null)t=u.x-w.x,z=u.y-w.y,t=t*t+z*z,t<x&&(m=n,h=p,A=w,x=t)}x==Number.MAX_VALUE&&f();s=[];x=[];n=m;p=h;r=c[n];v=c[p];a(A.x,A.y,v.x,v.y)||s.push(A);a(A.x,A.y,r.x,r.y)||x.push(A);m=-1;for(h=q;;){if(h!=p)s.push(c[h]);else{(0>m||m>=g)&&f();b(v.x,v.y,c[m].x,c[m].y,y.x,y.y)||s.push(c[h]);break}m=h;0>h-1?h=g-1:h--}s=s.reverse();m=-1;for(h=B;;){if(h!=n)x.push(c[h]);else{(0>m||m>=g)&&f();h==n&&!b(r.x,r.y,c[m].x,c[m].y,u.x,u.y)&&x.push(c[h]);break}m=h;h+1>g-1?h=0:h++}j.push(s,
x);j.shift();break}E&&k.push(j.shift())}g=k.length;for(c=0;c<g;c++){j=[];q=k[c];m=q.length;for(h=0;h<m;h++)j.push(new Box2D.Common.Math.b2Vec2(q[h].x,q[h].y));h=new Box2D.Collision.Shapes.b2PolygonShape;h.SetAsArray(j);d.shape=h;e.CreateFixture(d)}},Validate:function(a){var d,f=a.length,c,l,g,h,m,q=0,n,s=!1;for(d=0;d<f;d++){g=d<f-1?d+1:0;h=0<d?d-1:f-1;n=!1;for(c=0;c<f;c++)if(c!=d&&c!=g&&(n||(m=a[d].x*a[g].y+a[g].x*a[c].y+a[c].x*a[d].y-a[d].y*a[g].x-a[g].y*a[c].x-a[c].y*a[d].x,0<m&&(n=!0)),c!=h)){l=
c<f-1?c+1:0;var p=a[d].x,t=a[d].y,z=a[g].x,x=a[g].y;m=a[c].x;var B=a[c].y,y=a[l].x;l=a[l].y;var u=z-p,r=x-t,v=y-m,w=l-B,A=void 0,A=(v*(B-t)-w*(m-p))/(r*v-u*w),u=p+A*u,r=t+A*r,p=b(u,r,p,t,z,x);m=b(u,r,m,B,y,l);m=p&&m?new Box2D.Common.Math.b2Vec2(u,r):null;m&&(q=1)}n||(s=!0)}s&&(q=1==q?3:2);return q}}})(Box2D.Ext);boxledjs=boxledjs||{};
(function(c){function b(){}b.prototype=new Box2D.Dynamics.b2ContactListener;var a=b.prototype;a.BeginContact=function(a){var e=a.GetFixtureA(),d=a.GetFixtureB();this.__BeginContactOrdered(e,d,a);this.__BeginContactOrdered(d,e,a)};a.__BeginContactOrdered=function(a,e,d){var b=a.GetBody().GetUserData(),c=e.GetBody().GetUserData();b&&b.objectData&&(b=objectData);c&&c.objectData&&(c=objectData);this.__applyForceField(a,e,b,c,1,1,d);this.__applyImpulse(a,e,b,c,d);this.__handleCustomEvents(a,e,b,c,d,"beginContact")};
a.EndContact=function(a){var e=a.GetFixtureA();a=a.GetFixtureB();this.__EndContactOrdered(e,a);this.__EndContactOrdered(a,e)};a.__EndContactOrdered=function(a,e,d){var b=a.GetBody().GetUserData(),c=e.GetBody().GetUserData();b&&b.objectData&&(b=objectData);c&&c.objectData&&(c=objectData);this.__applyForceField(a,e,b,c,-1,0,d);this.__handleCustomEvents(a,e,b,c,d,"endContact")};a.__applyForceField=function(a,e,d,b,c,l){if(d&&d.properties&&(d.properties.forceX||d.properties.forceY))if((d.properties.forceX||
d.properties.forceY)&&!e.IsSensor()){b=parseFloat(d.properties.forceX)||0;var g=parseFloat(d.properties.forceY)||0,h=e.GetBody();h.o_fieldForceX=h.o_fieldForceX+b*c||b*(l||0);h.o_fieldForceY=h.o_fieldForceY+g*c||g*(l||0)}if(d&&d.properties&&(d.properties.force||void 0!=d.properties.gravityFactor)&&!e.IsSensor())h=e.GetBody(),h.o_dynamicForceFields=h.o_dynamicForceFields||[],1==c?h.o_dynamicForceFields.push(a.GetBody()):h.o_dynamicForceFields.splice(h.o_dynamicForceFields.indexOf(a.GetBody()),1)};
a.__applyImpulse=function(a,e,d,b,c){if(d&&d.properties&&(d.properties.impulseX||d.properties.impulseY||d.properties.impulse)){if((d.properties.impulseX||d.properties.impulseY)&&!e.IsSensor()){b=parseFloat(d.properties.impulseX)||0;var l=parseFloat(d.properties.impulseY)||0,g=e.GetBody();g.ApplyImpulse(new Box2D.Common.Math.b2Vec2(b||0,l||0),g.GetWorldCenter())}d.properties.impulse&&!e.IsSensor()&&(d=parseFloat(d.properties.impulse)||0,a=a.GetBody(),e=e.GetBody(),b=new Box2D.Common.Math.b2Vec2(e.GetWorldCenter().x,
e.GetWorldCenter().y),b.Subtract(a.GetWorldCenter()),b.Normalize(),b.Multiply(d),e.ApplyImpulse(b,e.GetWorldPoint(c.GetManifold().m_localPoint)))}};a.__handleCustomEvents=function(a,e,d,b,c,l){d&&(d.properties&&d.properties.event)&&(a={type:d.properties.event,detail:{status:l,targetFixture:a,triggeringFixture:e}},d.eventsToDispatch=d.eventsToDispatch||[],d.eventsToDispatch.push(a))};a.PreSolve=function(){};c.BoxledJSContactListener=b})(boxledjs);boxledjs=boxledjs||{};
(function(c){function b(){}b.prototype=new boxledjs.BoxledJSContactListener;var a=b.prototype;a.super_BeginContact=a.BeginContact;a.BeginContact=function(a){this.super_BeginContact(a);this.__HandleContact(a,1)};a.super_EndContact=a.EndContact;a.EndContact=function(a){this.super_EndContact(a);this.__HandleContact(a,-1)};a.__HandleContact=function(a,e){var d=a.GetFixtureA(),b=a.GetFixtureB(),c=d.IsSensor()?d:b.IsSensor()?b:null;if(c&&(d=d!=c?d:b,(b=d.GetBody().GetUserData())&&b.objectData&&(b=objectData),
c.GetUserData()&&c.GetUserData().sensorPosition)){var l=c.GetUserData().sensorPosition;b&&b.properties&&b.properties.noBottomCollision&&("left"==l||"right"==l)||d.IsSensor()||(obj=c.GetBody().GetUserData())&&(obj.bxd&&obj.bxd.sensors)&&(obj.bxd.sensors[l]+=e)}};a.super_PreSolve=a.PreSolve;a.PreSolve=function(a,e){this.super_PreSolve(a,e);var d=a.GetFixtureA(),b=a.GetFixtureB(),c,l,g;c=d.GetBody().GetUserData();l=b.GetBody().GetUserData();c&&c.objectData&&(c=objectData);l&&l.objectData&&(l=objectData);
if(c&&c.properties&&c.properties.noBottomCollision||l&&l.properties&&l.properties.noBottomCollision)d.GetBody().GetDefinition().type==Box2D.Dynamics.b2Body.b2_staticBody?(l=b.GetBody().m_linearVelocity.y,g=b.GetBody().m_invMass,c=b.GetAABB(),d=d.GetAABB()):(l=d.GetBody().m_linearVelocity.y,g=d.GetBody().m_invMass,c=d.GetAABB(),d=b.GetAABB()),b=Math.abs(d.lowerBound.y-d.upperBound.y),l=l*g/Box2D.Dynamics.b2World.s_timestep2.velocityIterations,(c.upperBound.y-l>d.upperBound.y&&c.upperBound.y>d.upperBound.y||
c.upperBound.y-l>d.lowerBound.y+b/25&&c.upperBound.y>d.lowerBound.y+b/25)&&a.SetEnabled(!1)};c.PlatformerContactListener=b})(boxledjs);boxledjs=boxledjs||{};
(function(c){function b(a,b){this.initialize(a,b)}b.prototype=new createjs.Container;b.prototype.Container_init=b.prototype.initialize;b.prototype.initialize=function(a,b){this.Container_init();this.data=a;this.properties=a.properties;this.objects={};this.map=b;this.reset()};b.prototype.reset=function(){this.initObjects()};b.prototype.initObjects=function(){var a,b,e,d;a=0;for(b=this.data.objects.length;a<b;a++){e=this.data.objects[a];if(e.type&&""!=e.type)d=this.makeObjectFromData(e);else if(this.map.b2dWorld)d=
boxledjs.Box2DUtils.makeB2DBodyFromData(e,this.map.b2dWorld);else{d="Couldn't create b2Body from objectData, because map.b2dWorld is "+this.map.b2dWorld;console.warn&&console.warn(d,e);continue}try{d.isVisible&&this.addChild(d)}catch(c){}try{if(d.bxd){var k=this.map.b2dWorld.CreateBody(d.bxd.bodyDef);k.CreateFixture(d.bxd.fixDef);k.CreateFixture(d.bxd.sensorsDef.bottom).SetUserData({sensorPosition:"bottom"});k.CreateFixture(d.bxd.sensorsDef.top).SetUserData({sensorPosition:"top"});k.CreateFixture(d.bxd.sensorsDef.right).SetUserData({sensorPosition:"right"});
k.CreateFixture(d.bxd.sensorsDef.left).SetUserData({sensorPosition:"left"});k.SetPositionAndAngle(new Box2D.Common.Math.b2Vec2(d.x/boxledjs.Const.scale,d.y/boxledjs.Const.scale),d.rotation*Math.PI/180);d.bxd.sensorsDef=void 0;d.bxd.body=k;k.SetUserData(d);if(d.bxd.onBodyCreated)d.bxd.onBodyCreated(k)}}catch(l){}e.name&&""!=e.name&&(this.objects[e.name]=d,this.map.objects[e.name]=d)}};b.prototype.makeObjectFromData=function(a){var b,e,d,c=a.properties;b=boxledjs.Utils.getDefinitionByName(a.type||c.classDefinition);
c.parameter&&""!=c.parameter&&(e=JSON.parse(c.parameter),"object"==typeof e&&(d=boxledjs.Utils.applyConstruct(b,e)));d=d||new b;for(var k in c)"classDefinition"!=k&&"parameter"!=k&&(d[k]=c[k]);d.x=a.x;d.y=a.y;d.rotation=a.rotation;return d};c.ObjectLayer=b})(boxledjs);boxledjs=boxledjs||{};
(function(c){function b(a,b){this.initialize(a,b)}b.prototype=new createjs.Container;b.prototype.Container_init=b.prototype.initialize;b.prototype.initialize=function(a,b){this.Container_init();this.data=a;this.properties=a.properties;this.map=b;this.reset()};b.prototype.reset=function(){this.x=this.data.x;this.y=this.data.y;this.visible=this.data.visible;this.alpha=void 0!=this.data.opacity?parseFloat(this.data.opacity):1;this.numTilesX=this.data.width;this.numTilesY=this.data.height;if(this.isCollisionLayer=
this.properties&&this.properties.collisionLayer&&"false"!=this.properties.collisionLayer)this.colTilesToCheck=[],this.colTileGroups=[];this.pathfinding={};this.drawTiles();this.cache(0,0,this.map.data.tilewidth*this.numTilesX,this.map.data.tileheight*this.numTilesY);this.isCollisionLayer&&this.map.b2dWorld&&this.calculateCollisionShapes()};b.prototype.drawTiles=function(){var a=this.data.data,b,c,d,j,k,l,g=[],h;for(b=0;b<this.numTilesY;b++){h=[];for(c=0;c<this.numTilesX;c++)d=c*this.numTilesX+b,j=
a[d],0!=j&&(k=this.map.getTileById(j),l=new createjs.Bitmap(k.image),l.sourceRect=k.rect,l.x=b*this.map.data.tilewidth,l.y=c*this.map.data.tileheight,this.addChild(l)),k=this.map.getTileProperties(j),this.isCollisionLayer?(this.colTilesToCheck[d]=j,d=!Box2DUtils.isTileCollideable(k,j)):d=!k||"false"!=k.passable,h.push(d?GraphNodeType.OPEN:GraphNodeType.WALL);g.push(h)}this.pathfinding.graph=new Graph(g)};b.prototype.calculateCollisionShapes=function(){var a,b,c,d,j=this.map.data.tilewidth,k=this.map.data.tileheight;
for(c=0;c<this.numTilesY;c++)for(b=0;b<this.numTilesX;b++)a=c*this.numTilesX+b,a=this.colTilesToCheck[a],void 0!=a&&0!=a&&(this.colTileGroups.push({tiles:[]}),this.findNextCollisionShapeTile(b,c));a=0;for(d=this.colTileGroups.length;a<d;a++){var l=this.colTileGroups[a],g=l.tiles;b=g[0].x;c=g[0].y;g=g[g.length-1].x-b+1;l=this.map.getTileProperties(l.tileid)||{};boxledjs.Box2DUtils.makeB2DBodyFromData({x:b*j,y:c*k,width:g*j,height:1*k,properties:l},this.map.b2dWorld)}};b.prototype.findNextCollisionShapeTile=
function(a,b){a=a||0;b=b||0;var c,d,j;c=b*this.numTilesX+a;d=this.colTilesToCheck[c];void 0!=d&&0!=d&&(j=this.colTileGroups[this.colTileGroups.length-1],j.tileid=j.tileid||d,Object.equals(this.map.getTileProperties(d),this.map.getTileProperties(j.tileid))&&(j.tiles.push({x:a,y:b,tileid:d}),this.colTilesToCheck[c]=void 0,this.findNextCollisionShapeTile(a+1,b)))};c.TileLayer=b})(boxledjs);boxledjs=boxledjs||{};boxledjs.Const={};boxledjs.Const.scale=32;
(function(c){function b(a,b){this.initialize(a,b)}b.prototype=new createjs.Container;b.prototype.Container_init=b.prototype.initialize;b.prototype.initialize=function(a,b){this.Container_init();this.b2dWorld=b;this.data=a;this.reset()};b.prototype.reset=function(){this.viewPort={};this.layers={};this.objects={};if(!1!==this.b2dWorld&&void 0===this.b2dWorld){boxledjs.Const.scale=parseFloat(this.data.properties.box2dScale)||boxledjs.Const.scale;this.b2dWorld=new Box2D.Dynamics.b2World(new Box2D.Common.Math.b2Vec2(parseFloat(this.data.properties.forceX)||
0,parseFloat(this.data.properties.forceY)||20),!0);var a=new boxledjs.PlatformerContactListener;this.b2dWorld.SetContactListener(a)}this.firstTick=!1;this.generateTileSets();this.pathfinding={};this.setupLayers()};b.prototype.onTick=function(){!this._firstTick&&this._onFirstTick();this.centerObject&&this.centerTo(this.centerObject)};b.prototype._onFirstTick=function(){var a=boxledjs.Utils.getStage(this).canvas;void 0==this.viewPort.width&&(this.viewPort.width=a.width);void 0==this.viewPort.height&&
(this.viewPort.height=a.height);!this.b2dDebugDraw&&this.setupDebugDraw(a);this._firstTick=!0};b.prototype.update=function(a){if(!1!==this.b2dWorld&&void 0!==this.b2dWorld){for(var b=this.b2dWorld.GetBodyList();b;){var c=b.GetUserData(),d=c?c.properties:{};if(c&&c.eventsToDispatch)for(;c.eventsToDispatch.length;){var j=c.eventsToDispatch.pop();this.dispatchEvent(j)}if(!d||!0!=d.ignoreForces){if(b.o_fieldForceX||b.o_fieldForceY)b.ApplyForce(new Box2D.Common.Math.b2Vec2((b.o_fieldForceX||0)*b.GetMass(),
(b.o_fieldForceY||0)*b.GetMass()),b.GetWorldCenter());if(b.o_dynamicForceFields&&b.o_dynamicForceFields.length){for(var c=[],k,d=0,j=b.o_dynamicForceFields.length;d<j;d++){var l=b.o_dynamicForceFields[d],g=parseFloat(l.GetUserData().properties.force)||0,h=new Box2D.Common.Math.b2Vec2(b.GetWorldCenter().x,b.GetWorldCenter().y);h.Subtract(l.GetWorldCenter());h.Normalize();h.Multiply(g);h.Multiply(b.GetMass());!isNaN(h.x)&&!isNaN(h.y)&&b.ApplyForce(h,b.GetWorldCenter());void 0!=l.GetUserData().properties.gravityFactor&&
c.push(parseFloat(l.GetUserData().properties.gravityFactor))}d=0;for(j=c.length;d<j;d++)k=k+c[d]||c[d];isNaN(k)||(d=this.b2dWorld.GetGravity().GetNegative(),d.Multiply(1-k/c.length),d.Multiply(b.GetMass()),b.ApplyForce(d,b.GetWorldCenter()))}}b=b.GetNext()}this.b2dWorld.Step((a||30)/1E3,10,10);this.b2dWorld.ClearForces()}};b.prototype.setupDebugDraw=function(a){if(!this.b2dWorld)return null;this.b2dDebugDraw=new Box2D.Dynamics.b2DebugDraw;this.b2dDebugDraw.SetSprite(a.getContext("2d"));this.b2dDebugDraw.SetDrawScale(boxledjs.Const.scale);
this.b2dDebugDraw.SetFillAlpha(0.35);this.b2dDebugDraw.SetFlags(Box2D.Dynamics.b2DebugDraw.e_shapeBit|Box2D.Dynamics.b2DebugDraw.e_jointBit);this.b2dWorld.SetDebugDraw(this.b2dDebugDraw);return this.b2dDebugDraw};b.prototype.drawDebugData=function(a){this.b2dWorld&&(a=a||1,this.b2dDebugDraw.SetFillAlpha(0.35*a),this.b2dDebugDraw.SetAlpha(1*a),this.b2dDebugDraw.GetSprite().save(),this.b2dDebugDraw.GetSprite().scale(this.scaleX,this.scaleY),this.b2dDebugDraw.GetSprite().translate(-this.regX+this.x/
this.scaleX,-this.regY+this.y/this.scaleY),this.b2dWorld.DrawDebugData(),this.b2dDebugDraw.GetSprite().restore())};b.prototype.setupLayers=function(){var a,b,c,d,j=[];a=0;for(b=this.data.layers.length;a<b;a++){c=this.data.layers[a];if("tilelayer"==c.type){d=new boxledjs.TileLayer(c,this);this.addChild(d);for(var k=d.pathfinding.graph.input,l=0,g=k.length;l<g;l++){var h=k[l],m=j[l]||[];j[l]=m;for(var q=0,n=h.length;q<n;q++)m[q]=(m[q]||1)&h[q]}}else"objectgroup"==c.type&&(d=new boxledjs.ObjectLayer(c,
this),this.addChild(d));c.name&&""!=c.name&&(this.layers[c.name]=d)}this.pathfinding.graph=new Graph(j)};b.prototype.centerTo=function(a){"string"==typeof a&&(a=this.objects[a]);if(a&&void 0!=a){var b,c;a.GetPosition?(c=a.GetPosition(),b=c.x*boxledjs.Const.scale,c=c.y*boxledjs.Const.scale):void 0!=a.x&&void 0!=a.y&&(b=a.x,c=a.y);if(!(void 0==b||void 0==c)){a=this.viewPort.width||0;var d=this.viewPort.height||0;this.regX=b;this.regY=c;this.x=a/2;this.y=d/2}}};b.prototype.calculatePath=function(a,b,
c){var d=this.pathfinding.graph.nodes;a=d[a.x][a.y];b=d[b.x][b.y];return astar.search(d,a,b,c)};b.prototype.generateTileSets=function(){this.tilesets=[];this.tileproperties={};for(var a=0,c=this.data.tilesets.length;a<c;a++){var e=b.convertTileSetToSpriteSheet(this.data.tilesets[a]);this.tilesets.push(e);for(var d in e.tileproperties)this.tileproperties[d]=e.tileproperties[d]}};b.prototype.getTileById=function(a){a-=1;return this.getSpriteSheetByTileId(a).getFrame(a)};b.prototype.getSpriteSheetByTileId=
function(a){a=a||1;var b=this.tilesets,c,d,j,k;c=0;for(d=b.length;c<d;c++)j=b[c],j.firstgid<=a&&0<j.firstgid&&(k=j);return k};b.prototype.getTileProperties=function(a){return this.tileproperties[a-1]};b.convertTileSetToSpriteSheet=function(a){var b={};b.images=[a.image];b.frames={width:a.tilewidth,height:a.tileheight};b=new createjs.SpriteSheet(b);b.firstgid=a.firstgid;b.tileproperties=a.tileproperties;return b};c.Map=b})(boxledjs);
