/*
* BoxledJS
*
* Copyright (c) 2013 Olaf Horstmann, indiegamr.com.
* 
* Distributed under the terms of the MIT license.
* http://www.opensource.org/licenses/mit-license.html
*
* This notice shall be included in all copies or substantial portions of the Software.
*/
var boxledjs=boxledjs||{};
(function(l){Utils={};Math.seed=0;Math.seededRandom=function(a,b){b=b||0;Math.seed=(9301*Math.seed+49297)%233280;return b+Math.seed/233280*((a||1)-b)};Utils.snapValue=function(a,b){return(a/b+(0<a?0.5:-0.5)|0)*b};Utils.getScreenWidth=function(){if("number"==typeof window.innerWidth)return window.innerWidth;if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight))return document.documentElement.clientWidth;if(document.body&&(document.body.clientWidth||
document.body.clientHeight))return document.body.clientWidth};Utils.getScreenHeight=function(){if("number"==typeof window.innerWidth)return window.innerHeight;if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight))return document.documentElement.clientHeight;if(document.body&&(document.body.clientHeight||document.body.clientHeight))return document.body.clientHeight};Utils.getStage=function(a){return a.canvas?a:a.parent?a.parent.canvas?a.parent:l.getStage(a.parent):
null};Utils.getDefinitionByName=function(a,b,d){b=b||window;d=d||a;a=a.split(".");var c=a.shift();if(b=b[c])return a.length?l.getDefinitionByName(a.join("."),b,d):b;throw Error("Could not find '"+c+"' of '"+d+"'");};Utils.applyConstruct=function(a,b){function d(){function c(){}c.prototype=a.prototype;return new c}var c,e;"function"===typeof Object.create?c=Object.create(a.prototype):{}.__proto__?(c={},c.__proto__=a.prototype,c.__proto__!==a.prototype&&(c=d())):c=d();c.constructor=a;e=a.apply(c,b);
"object"===typeof e&&(c=e);return c};l.Utils=Utils})(boxledjs);boxledjs=boxledjs||{};
(function(l){Box2DUtils={RECT:"rect",CIRCLE:"circle",makeB2DBodyFromData:function(a,b){boxledjs.Const.scale=boxledjs.Const.scale||32;var d=a.properties,c=new Box2D.Dynamics.b2FixtureDef;c.density=void 0==d.density?1:parseFloat(d.density);c.friction=void 0==d.friction?0.5:parseFloat(d.friction);c.restitution=void 0==d.restitution?0.05:parseFloat(d.restitution);c.isSensor=d.isSensor&&"false"!=d.isSensor||d.noCollision&&"false"!=d.noCollision||d.force||d.forceX||d.forceY||void 0!=d.gravityFactor;var e=
new Box2D.Dynamics.b2BodyDef;e.type=d.dynamic?Box2D.Dynamics.b2Body.b2_dynamicBody:Box2D.Dynamics.b2Body.b2_staticBody;var d=b.CreateBody(e),e=a.width/boxledjs.Const.scale/2,g=a.height/boxledjs.Const.scale/2;if(!0==a.ellipse)c.shape=new Box2D.Collision.Shapes.b2CircleShape(e),d.CreateFixture(c),a.x+=a.width/2,a.y+=a.height/2;else if(a.polygon&&1<a.polygon.length)Box2D.Ext.b2Separator.Separate(d,c,a.polygon,boxledjs.Const.scale);else if(a.polyline&&1<a.polyline.length){var f,h,g=0;for(h=a.polyline.length;g<
h-1;g++)c.shape=new Box2D.Collision.Shapes.b2PolygonShape,f=a.polyline[g],e=new Box2D.Common.Math.b2Vec2(f.x/boxledjs.Const.scale,f.y/boxledjs.Const.scale),f=a.polyline[g+1],f=new Box2D.Common.Math.b2Vec2(f.x/boxledjs.Const.scale,f.y/boxledjs.Const.scale),c.shape.SetAsEdge(e,f),d.CreateFixture(c)}else c.shape=new Box2D.Collision.Shapes.b2PolygonShape,c.shape.SetAsBox(e,g),d.CreateFixture(c),a.x+=a.width/2,a.y+=a.height/2;d.SetPositionAndAngle(new Box2D.Common.Math.b2Vec2(a.x/boxledjs.Const.scale,
a.y/boxledjs.Const.scale),(a.rotation||0)*Math.PI/180);d.SetUserData(a);return d},injectBox2d:function(a,b,d,c,e,g,f,h){h=h||!0;var j=boxledjs.Const.scale=boxledjs.Const.scale||32;a.bxd={};d*=0.5;c*=0.5;var k=new Box2D.Dynamics.b2FixtureDef;k.density=void 0==e?1:e;k.friction=void 0==g?0.5:g;k.restitution=void 0==f?0.05:f;if(b==Box2DUtils.RECT)k.shape=new Box2D.Collision.Shapes.b2PolygonShape,k.shape.SetAsBox(d/j,c/j),sensorsDef={},sensorsDef.bottom=Box2DUtils.makeSensorDef((d-1)/j,2/j,0,c/j),sensorsDef.top=
Box2DUtils.makeSensorDef((d-1)/j,2/j,0,-c/j),sensorsDef.right=Box2DUtils.makeSensorDef(2/j,(c-1)/j,d/j,0),sensorsDef.left=Box2DUtils.makeSensorDef(2/j,(c-1)/j,-d/j,0);else if(b==Box2DUtils.CIRCLE)k.shape=new Box2D.Collision.Shapes.b2CircleShape(2*d/j);else throw Error("Cannot resolve shape-type: "+b);a.bxd.fixDef=k;a.bxd.sensors={bottom:0,top:0,right:0,left:0};a.bxd.sensorsDef=sensorsDef;b=new Box2D.Dynamics.b2BodyDef;b.type=!h?Box2D.Dynamics.b2Body.b2_staticBody:Box2D.Dynamics.b2Body.b2_dynamicBody;
a.bxd.bodyDef=b;a.onTick&&(a.__onTick=a.onTick);a.onTick=function(c){this.__onTick&&this.__onTick(c);this.bxd.body&&(c=this.bxd.body.GetPosition(),this.x=c.x*j,this.y=c.y*j,this.rotation=180*(this.bxd.body.GetAngle()/Math.PI))}},makeSensorDef:function(a,b,d,c){var e=new Box2D.Dynamics.b2FixtureDef;e.isSensor=!0;var g=new Box2D.Collision.Shapes.b2PolygonShape;g.SetAsOrientedBox(a,b,new Box2D.Common.Math.b2Vec2(d,c),0);e.shape=g;return e}};l.Box2DUtils=Box2DUtils})(boxledjs);
Object.equals=function(l,a){if(l===a)return!0;if(!(l instanceof Object)||!(a instanceof Object)||l.constructor!==a.constructor)return!1;for(var b in l)if(l.hasOwnProperty(b)&&(!a.hasOwnProperty(b)||l[b]!==a[b]&&("object"!==typeof l[b]||!Object.equals(l[b],a[b]))))return!1;for(b in a)if(a.hasOwnProperty(b)&&!l.hasOwnProperty(b))return!1;return!0};var Box2D=Box2D||{};Box2D.Ext=Box2D.Ext||{};
(function(l){function a(c,d,b,a,h,j){var k;if(k=(b+0.1>=c&&c>=h-0.1||b-0.1<=c&&c<=h+0.1)&&(a+0.1>=d&&d>=j-0.1||a-0.1<=d&&d<=j+0.1))0.1<h-b||0.1<b-h?(c=(j-a)/(h-b)*(c-b)+a,k=0.1>(c>d?c-d:d-c)):k=0.1>c-b||0.1>b-c;return k}function b(c,d,b,a){return 0.1>(b>=c?b-c:c-b)&&0.1>(a>=d?a-d:d-a)}function d(){throw Error("A problem has occurred. Use the Validate() method to see where the problem is.");}l.b2Separator={Separate:function(c,e,g,f){f=f||32;var h,j=g.length,k,l,t=[];for(h=0;h<j;h++)t.push(new Box2D.Common.Math.b2Vec2(g[h].x/
f,g[h].y/f));var m,q,n,r,y,w,A,x,s,p,u,v,z,D;f=[];g=[];for(g.push(t);g.length;){h=g[0];j=h.length;D=!0;for(m=0;m<j;m++)if(t=m,A=m<j-1?m+1:m+1-j,n=m<j-2?m+2:m+2-j,x=h[t],s=h[A],n=h[n],n=x.x*s.y+s.x*n.y+n.x*x.y-x.y*s.x-s.y*n.x-n.y*x.x,0>n){D=!1;w=Number.MAX_VALUE;for(q=0;q<j;q++)if(q!=t&&q!=A){m=q;n=q<j-1?q+1:0;p=h[m];u=h[n];r=x.x;y=x.y;var F=s.x,G=s.y;v=p.x;p=p.y;var H=u.x;u=u.y;var B=F-r,C=G-y,I=H-v,J=u-p,E=void 0,E=(I*(p-y)-J*(v-r))/(C*I-B*J),B=r+E*B,C=y+E*C;r=a(F,G,r,y,B,C);v=a(B,C,v,p,H,u);if(v=
r&&v?new Box2D.Common.Math.b2Vec2(B,C):null)r=s.x-v.x,y=s.y-v.y,r=r*r+y*y,r<w&&(l=m,k=n,z=v,w=r)}w==Number.MAX_VALUE&&d();q=[];w=[];m=l;n=k;p=h[m];u=h[n];b(z.x,z.y,u.x,u.y)||q.push(z);b(z.x,z.y,p.x,p.y)||w.push(z);l=-1;for(k=t;;){if(k!=n)q.push(h[k]);else{(0>l||l>=j)&&d();a(u.x,u.y,h[l].x,h[l].y,x.x,x.y)||q.push(h[k]);break}l=k;0>k-1?k=j-1:k--}q=q.reverse();l=-1;for(k=A;;){if(k!=m)w.push(h[k]);else{(0>l||l>=j)&&d();k==m&&!a(p.x,p.y,h[l].x,h[l].y,s.x,s.y)&&w.push(h[k]);break}l=k;k+1>j-1?k=0:k++}g.push(q,
w);g.shift();break}D&&f.push(g.shift())}j=f.length;for(h=0;h<j;h++){g=[];t=f[h];l=t.length;for(k=0;k<l;k++)g.push(new Box2D.Common.Math.b2Vec2(t[k].x,t[k].y));k=new Box2D.Collision.Shapes.b2PolygonShape;k.SetAsArray(g);e.shape=k;c.CreateFixture(e)}},Validate:function(c){var d,b=c.length,f,h,j,k,l,t=0,m,q=!1;for(d=0;d<b;d++){j=d<b-1?d+1:0;k=0<d?d-1:b-1;m=!1;for(f=0;f<b;f++)if(f!=d&&f!=j&&(m||(l=c[d].x*c[j].y+c[j].x*c[f].y+c[f].x*c[d].y-c[d].y*c[j].x-c[j].y*c[f].x-c[f].y*c[d].x,0<l&&(m=!0)),f!=k)){h=
f<b-1?f+1:0;var n=c[d].x,r=c[d].y,y=c[j].x,w=c[j].y;l=c[f].x;var A=c[f].y,x=c[h].x;h=c[h].y;var s=y-n,p=w-r,u=x-l,v=h-A,z=void 0,z=(u*(A-r)-v*(l-n))/(p*u-s*v),s=n+z*s,p=r+z*p,n=a(s,p,n,r,y,w);l=a(s,p,l,A,x,h);l=n&&l?new Box2D.Common.Math.b2Vec2(s,p):null;l&&(t=1)}m||(q=!0)}q&&(t=1==t?3:2);return t}}})(Box2D.Ext);boxledjs=boxledjs||{};
(function(l){function a(){}a.prototype=new Box2D.Dynamics.b2ContactListener;var b=a.prototype;b.BeginContact=function(d){var c=d.GetFixtureA(),b=d.GetFixtureB();this.__BeginContactOrdered(c,b,d);this.__BeginContactOrdered(b,c,d)};b.__BeginContactOrdered=function(d,c,b){var a=d.GetBody().GetUserData(),f=c.GetBody().GetUserData();a&&a.objectData&&(a=objectData);f&&f.objectData&&(f=objectData);this.__applyForceField(d,c,a,f,1,1,b);this.__applyImpulse(d,c,a,f,b)};b.EndContact=function(d){var c=d.GetFixtureA();
d=d.GetFixtureB();this.__EndContactOrdered(c,d);this.__EndContactOrdered(d,c)};b.__EndContactOrdered=function(d,c,b){var a=d.GetBody().GetUserData(),f=c.GetBody().GetUserData();a&&a.objectData&&(a=objectData);f&&f.objectData&&(f=objectData);this.__applyForceField(d,c,a,f,-1,0,b)};b.__applyForceField=function(d,b,a,g,f,h){if(a&&a.properties&&(a.properties.forceX||a.properties.forceY))if((a.properties.forceX||a.properties.forceY)&&!b.IsSensor()){g=parseFloat(a.properties.forceX)||0;var j=parseFloat(a.properties.forceY)||
0,k=b.GetBody();k.o_fieldForceX=k.o_fieldForceX+g*f||g*(h||0);k.o_fieldForceY=k.o_fieldForceY+j*f||j*(h||0)}if(a&&a.properties&&(a.properties.force||void 0!=a.properties.gravityFactor)&&!b.IsSensor())k=b.GetBody(),k.o_dynamicForceFields=k.o_dynamicForceFields||[],1==f?k.o_dynamicForceFields.push(d.GetBody()):k.o_dynamicForceFields.splice(k.o_dynamicForceFields.indexOf(d.GetBody()),1)};b.__applyImpulse=function(d,b,a,g,f){if(a&&a.properties&&(a.properties.impulseX||a.properties.impulseY||a.properties.impulse)){if((a.properties.impulseX||
a.properties.impulseY)&&!b.IsSensor()){g=parseFloat(a.properties.impulseX)||0;var h=parseFloat(a.properties.impulseY)||0,j=b.GetBody();j.ApplyImpulse(new Box2D.Common.Math.b2Vec2(g||0,h||0),j.GetWorldCenter())}a.properties.impulse&&!b.IsSensor()&&(a=parseFloat(a.properties.impulse)||0,d=d.GetBody(),b=b.GetBody(),g=new Box2D.Common.Math.b2Vec2(b.GetWorldCenter().x,b.GetWorldCenter().y),g.Subtract(d.GetWorldCenter()),g.Normalize(),g.Multiply(a),b.ApplyImpulse(g,b.GetWorldPoint(f.GetManifold().m_localPoint)))}};
b.PreSolve=function(){};l.BoxledJSContactListener=a})(boxledjs);boxledjs=boxledjs||{};
(function(l){function a(){}a.prototype=new boxledjs.BoxledJSContactListener;var b=a.prototype;b.super_BeginContact=b.BeginContact;b.BeginContact=function(b){this.super_BeginContact(b);this.__HandleContact(b,1)};b.super_EndContact=b.EndContact;b.EndContact=function(b){this.super_EndContact(b);this.__HandleContact(b,-1)};b.__HandleContact=function(b,a){var e=b.GetFixtureA(),g=b.GetFixtureB(),f=e.IsSensor()?e:g.IsSensor()?g:null;if(f&&(e=e!=f?e:g,(g=e.GetBody().GetUserData())&&g.objectData&&(g=objectData),
f.GetUserData()&&f.GetUserData().sensorPosition)){var h=f.GetUserData().sensorPosition;g&&g.properties&&g.properties.noBottomCollision&&("left"==h||"right"==h)||e.IsSensor()||(obj=f.GetBody().GetUserData())&&(obj.bxd&&obj.bxd.sensors)&&(obj.bxd.sensors[h]+=a)}};b.super_PreSolve=b.PreSolve;b.PreSolve=function(b,a){this.super_PreSolve(b,a);var e=b.GetFixtureA(),g=b.GetFixtureB(),f,h,j;f=e.GetBody().GetUserData();h=g.GetBody().GetUserData();f&&f.objectData&&(f=objectData);h&&h.objectData&&(h=objectData);
if(f&&f.properties&&f.properties.noBottomCollision||h&&h.properties&&h.properties.noBottomCollision)e.GetBody().GetDefinition().type==Box2D.Dynamics.b2Body.b2_staticBody?(h=g.GetBody().m_linearVelocity.y,j=g.GetBody().m_invMass,f=g.GetAABB(),e=e.GetAABB()):(h=e.GetBody().m_linearVelocity.y,j=e.GetBody().m_invMass,f=e.GetAABB(),e=g.GetAABB()),g=Math.abs(e.lowerBound.y-e.upperBound.y),h=h*j/Box2D.Dynamics.b2World.s_timestep2.velocityIterations,(f.upperBound.y-h>e.upperBound.y&&f.upperBound.y>e.upperBound.y||
f.upperBound.y-h>e.lowerBound.y+g/25&&f.upperBound.y>e.lowerBound.y+g/25)&&b.SetEnabled(!1)};l.PlatformerContactListener=a})(boxledjs);boxledjs=boxledjs||{};
(function(l){function a(b,d){this.initialize(b,d)}a.prototype=new createjs.Container;a.prototype.Container_init=a.prototype.initialize;a.prototype.initialize=function(b,d){this.Container_init();this.data=b;this.properties=b.properties;this.objects={};this.map=d;this.reset()};a.prototype.reset=function(){(this.isCollisionLayer=this.properties&&this.properties.collisionLayer&&"false"!=this.properties.collisionLayer)?this.initObjectsAsB2dBodies():this.initObjects()};a.prototype.initObjects=function(){var b,
d,a,e;b=0;for(d=this.data.objects.length;b<d;b++){a=this.data.objects[b];e=this.makeObjectFromData(a);try{e.isVisible&&this.addChild(e)}catch(g){}try{if(e.bxd){var f=this.map.b2dWorld.CreateBody(e.bxd.bodyDef);f.CreateFixture(e.bxd.fixDef);f.CreateFixture(e.bxd.sensorsDef.bottom).SetUserData({sensorPosition:"bottom"});f.CreateFixture(e.bxd.sensorsDef.top).SetUserData({sensorPosition:"top"});f.CreateFixture(e.bxd.sensorsDef.right).SetUserData({sensorPosition:"right"});f.CreateFixture(e.bxd.sensorsDef.left).SetUserData({sensorPosition:"left"});
f.SetPositionAndAngle(new Box2D.Common.Math.b2Vec2(e.x/boxledjs.Const.scale,e.y/boxledjs.Const.scale),e.rotation*Math.PI/180);e.bxd.sensorsDef=void 0;e.bxd.body=f;f.SetUserData(e);if(e.bxd.onBodyCreated)e.bxd.onBodyCreated(f)}}catch(h){console.log(a.name)}a.name&&""!=a.name&&(this.objects[a.name]=e,this.map.objects[a.name]=e)}};a.prototype.initObjectsAsB2dBodies=function(){var b,a,c,e;b=0;for(a=this.data.objects.length;b<a;b++)c=this.data.objects[b],e=boxledjs.Box2DUtils.makeB2DBodyFromData(c,this.map.b2dWorld);
c.name&&""!=c.name&&(this.objects[c.name]=e,this.map.objects[c.name]=e)};a.prototype.makeObjectFromData=function(b){var a,c,e,g=b.properties;if(b.type&&""!=b.type||g.classDefinition&&""!=g.classDefinition)a=b.type||g.classDefinition,a=boxledjs.Utils.getDefinitionByName(a),g.parameter&&""!=g.parameter&&(c=JSON.parse(g.parameter),"object"==typeof c&&(e=boxledjs.Utils.applyConstruct(a,c))),e=e||new a;e=e||{};for(var f in g)"classDefinition"!=f&&"parameter"!=f&&(e[f]=g[f]);e.x=b.x;e.y=b.y;e.rotation=
b.rotation;return e};l.ObjectLayer=a})(boxledjs);boxledjs=boxledjs||{};
(function(l){function a(b,a){this.initialize(b,a)}a.prototype=new createjs.Container;a.prototype.Container_init=a.prototype.initialize;a.prototype.initialize=function(b,a){this.Container_init();this.data=b;this.properties=b.properties;this.map=a;this.reset()};a.prototype.reset=function(){this.x=this.data.x;this.y=this.data.y;this.visible=this.data.visible;this.numTilesX=this.data.width;this.numTilesY=this.data.height;if(this.isCollisionLayer=this.properties&&this.properties.collisionLayer&&"false"!=
this.properties.collisionLayer)this.colTilesToCheck=[],this.colTileGroups=[];this.drawTiles();this.cache(0,0,this.map.data.tilewidth*this.numTilesX,this.map.data.tileheight*this.numTilesY);this.isCollisionLayer&&this.calculateCollisionShapes()};a.prototype.drawTiles=function(){var b=this.data.data,a,c,e,g,f,h;for(c=0;c<this.numTilesY;c++)for(a=0;a<this.numTilesX;a++)e=c*this.numTilesX+a,g=b[e],0!=g&&(f=this.map.getTileById(g),h=new createjs.Bitmap(f.image),h.sourceRect=f.rect,h.x=a*this.map.data.tilewidth,
h.y=c*this.map.data.tileheight,this.addChild(h)),this.isCollisionLayer&&(this.colTilesToCheck[e]=g)};a.prototype.calculateCollisionShapes=function(){var b,a,c,e,g=this.map.data.tilewidth,f=this.map.data.tileheight;for(c=0;c<this.numTilesY;c++)for(a=0;a<this.numTilesX;a++)b=c*this.numTilesX+a,b=this.colTilesToCheck[b],void 0!=b&&0!=b&&(this.colTileGroups.push({tiles:[]}),this.findNextCollisionShapeTile(a,c));b=0;for(e=this.colTileGroups.length;b<e;b++){var h=this.colTileGroups[b],j=h.tiles;a=j[0].x;
c=j[0].y;j=j[j.length-1].x-a+1;h=this.map.getTileProperties(h.tileid)||{};boxledjs.Box2DUtils.makeB2DBodyFromData({x:a*g,y:c*f,width:j*g,height:1*f,properties:h},this.map.b2dWorld)}};a.prototype.findNextCollisionShapeTile=function(b,a){b=b||0;a=a||0;var c,e,g;c=a*this.numTilesX+b;e=this.colTilesToCheck[c];void 0!=e&&0!=e&&(g=this.colTileGroups[this.colTileGroups.length-1],g.tileid=g.tileid||e,Object.equals(this.map.getTileProperties(e),this.map.getTileProperties(g.tileid))&&(g.tiles.push({x:b,y:a,
tileid:e}),this.colTilesToCheck[c]=void 0,this.findNextCollisionShapeTile(b+1,a)))};l.TileLayer=a})(boxledjs);boxledjs=boxledjs||{};boxledjs.Const={};boxledjs.Const.scale=32;
(function(l){function a(a,d){this.initialize(a,d)}a.prototype=new createjs.Container;a.prototype.Container_init=a.prototype.initialize;a.prototype.initialize=function(a,d){this.Container_init();this.b2dWorld=d;this.data=a;this.reset()};a.prototype.reset=function(){this.viewPort={};this.layers={};this.objects={};if(!this.b2dWorld){boxledjs.Const.scale=parseFloat(this.data.properties.box2dScale)||boxledjs.Const.scale;this.b2dWorld=new Box2D.Dynamics.b2World(new Box2D.Common.Math.b2Vec2(parseFloat(this.data.properties.forceX)||0,
parseFloat(this.data.properties.forceY)||20),!0);var a=new boxledjs.PlatformerContactListener;this.b2dWorld.SetContactListener(a)}this.firstTick=!1;this.generateTileSets();this.setupLayers()};a.prototype.onTick=function(){!this._firstTick&&this._onFirstTick();this.centerObject&&this.centerTo(this.centerObject)};a.prototype._onFirstTick=function(){var a=boxledjs.Utils.getStage(this).canvas;void 0==this.viewPort.width&&(this.viewPort.width=a.width);void 0==this.viewPort.height&&(this.viewPort.height=
a.height);!this.b2dDebugDraw&&this.setupDebugDraw(a);this._firstTick=!0};a.prototype.setupDebugDraw=function(a){this.b2dDebugDraw=new Box2D.Dynamics.b2DebugDraw;this.b2dDebugDraw.SetSprite(a.getContext("2d"));this.b2dDebugDraw.SetDrawScale(boxledjs.Const.scale);this.b2dDebugDraw.SetFillAlpha(0.35);this.b2dDebugDraw.SetFlags(Box2D.Dynamics.b2DebugDraw.e_shapeBit|Box2D.Dynamics.b2DebugDraw.e_jointBit);this.b2dWorld.SetDebugDraw(this.b2dDebugDraw);return this.b2dDebugDraw};a.prototype.update=function(a){for(var d=
this.b2dWorld.GetBodyList();d;){var c=d.GetUserData(),c=c?c.properties:{};if(!c||!0!=c.ignoreForces){if(d.o_fieldForceX||d.o_fieldForceY)d.ApplyForce(new Box2D.Common.Math.b2Vec2((d.o_fieldForceX||0)*d.GetMass(),(d.o_fieldForceY||0)*d.GetMass()),d.GetWorldCenter());if(d.o_dynamicForceFields&&d.o_dynamicForceFields.length){for(var c=[],e,g=0,f=d.o_dynamicForceFields.length;g<f;g++){var h=d.o_dynamicForceFields[g],j=parseFloat(h.GetUserData().properties.force)||0,k=new Box2D.Common.Math.b2Vec2(d.GetWorldCenter().x,
d.GetWorldCenter().y);k.Subtract(h.GetWorldCenter());k.Normalize();k.Multiply(j);k.Multiply(d.GetMass());d.ApplyForce(k,d.GetWorldCenter());void 0!=h.GetUserData().properties.gravityFactor&&c.push(parseFloat(h.GetUserData().properties.gravityFactor))}g=0;for(f=c.length;g<f;g++)e=e+c[g]||c[g];g=this.b2dWorld.GetGravity().GetNegative();g.Multiply(1-e/c.length);g.Multiply(d.GetMass());d.ApplyForce(g,d.GetWorldCenter())}}d=d.GetNext()}this.b2dWorld.Step((a||30)/1E3,10,10);this.b2dWorld.ClearForces()};
a.prototype.drawDebugData=function(a){a=a||1;this.b2dDebugDraw.SetFillAlpha(0.35*a);this.b2dDebugDraw.SetAlpha(1*a);this.b2dDebugDraw.GetSprite().save();this.b2dDebugDraw.GetSprite().scale(this.scaleX,this.scaleY);this.b2dDebugDraw.GetSprite().translate(-this.regX+this.x/this.scaleX,-this.regY+this.y/this.scaleY);this.b2dWorld.DrawDebugData();this.b2dDebugDraw.GetSprite().restore()};a.prototype.setupLayers=function(){var a,d,c,e;a=0;for(d=this.data.layers.length;a<d;a++)c=this.data.layers[a],"tilelayer"==
c.type?(e=new boxledjs.TileLayer(c,this),this.addChild(e)):"objectgroup"==c.type&&(e=new boxledjs.ObjectLayer(c,this),this.addChild(e)),c.name&&""!=c.name&&(this.layers[c.name]=e)};a.prototype.centerTo=function(a){"string"==typeof a&&(a=this.objects[a]);if(a&&void 0!=a){var d,c;a.GetPosition?(c=a.GetPosition(),d=c.x*boxledjs.Const.scale,c=c.y*boxledjs.Const.scale):void 0!=a.x&&void 0!=a.y&&(d=a.x,c=a.y);if(!(void 0==d||void 0==c)){a=this.viewPort.width||0;var e=this.viewPort.height||0;this.regX=d;
this.regY=c;this.x=a/2;this.y=e/2}}};a.prototype.generateTileSets=function(){this.tilesets=[];this.tileproperties={};for(var b=0,d=this.data.tilesets.length;b<d;b++){var c=a.convertTileSetToSpriteSheet(this.data.tilesets[b]);this.tilesets.push(c);for(var e in c.tileproperties)this.tileproperties[e]=c.tileproperties[e]}};a.prototype.getTileById=function(a){a-=1;return this.getSpriteSheetByTileId(a).getFrame(a)};a.prototype.getSpriteSheetByTileId=function(a){a=a||1;var d=this.tilesets,c,e,g,f;c=0;for(e=
d.length;c<e;c++)g=d[c],g.firstgid<=a&&0<g.firstgid&&(f=g);return f};a.prototype.getTileProperties=function(a){return this.tileproperties[a-1]};a.convertTileSetToSpriteSheet=function(a){var d={};d.images=[a.image];d.frames={width:a.tilewidth,height:a.tileheight};d=new createjs.SpriteSheet(d);d.firstgid=a.firstgid;d.tileproperties=a.tileproperties;return d};l.Map=a})(boxledjs);
